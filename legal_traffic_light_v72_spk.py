"""
–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.2
–ê–û ¬´–°–ü–ö¬ª –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è v7.2:
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–≥–æ–≤–æ—Ä—ã
- –î–µ–º–æ-—Ä–µ–∂–∏–º –¥–ª—è –≤—Å–µ—Ö
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ò–õ–ò —Ç–µ–∫—Å—Ç (–Ω–µ –æ–±–∞)
- –ò—Å—Ç–æ—Ä–∏—è —Å –¥–∞—Ç–æ–π, –Ω–æ–º–µ—Ä–æ–º, –∑–æ–Ω–æ–π
- –í—Å—ë –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
"""

import streamlit as st
import re, json, hashlib, io, time
from datetime import datetime, date
from typing import Dict, List, Tuple, Optional, Any
from dataclasses import dataclass, field
from enum import Enum
import difflib

# ============================================================================
# –ü–†–û–í–ï–†–ö–ê –ë–ò–ë–õ–ò–û–¢–ï–ö
# ============================================================================

DOCX_AVAILABLE = False
PDF_AVAILABLE = False
REQUESTS_AVAILABLE = False

try:
    from docx import Document as DocxDocument
    DOCX_AVAILABLE = True
except ImportError:
    pass

try:
    from PyPDF2 import PdfReader
    PDF_AVAILABLE = True
except ImportError:
    pass

try:
    import requests
    REQUESTS_AVAILABLE = True
except ImportError:
    pass

# ============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´
# ============================================================================

st.set_page_config(
    page_title="–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.2 | –°–ü–ö",
    page_icon="üö¶",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================================
# –ö–û–ù–°–¢–ê–ù–¢–´ –ò –î–ê–ù–ù–´–ï –û–†–ì–ê–ù–ò–ó–ê–¶–ò–ò
# ============================================================================

DEFAULT_ORG_CONFIG = {
    "full_name": '–ê–∫—Ü–∏–æ–Ω–µ—Ä–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ ¬´–°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª',
    "short_name": '–ê–û ¬´–°–ü–ö¬ª',
    "inn": "7708654321",
    "director_name": "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á",
    "director_position": "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",
}

DEFAULT_THRESHOLDS = {
    "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": 100_000,
    "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": 50_000,
    "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": 5_000_000,
    "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": 3_000_000,
    "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": 100_000
}

DEFAULT_DEADLINES = {"—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": 5, "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": 10, "—Å—Ä–æ—á–Ω—ã–π": 1}

# ============================================================================
# ENUM –ù–ê –†–£–°–°–ö–û–ú
# ============================================================================

class –ó–æ–Ω–∞–†–∏—Å–∫–∞(Enum):
    –ó–ï–õ–Å–ù–ê–Ø = "–∑–µ–ª—ë–Ω–∞—è"
    –ñ–Å–õ–¢–ê–Ø = "–∂—ë–ª—Ç–∞—è"
    –ö–†–ê–°–ù–ê–Ø = "–∫—Ä–∞—Å–Ω–∞—è"

class –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞(Enum):
    –¢–ò–ü–û–í–ê–Ø = "—Ç–∏–ø–æ–≤–∞—è"
    –ö–û–ù–¢–†–ê–ì–ï–ù–¢–ê = "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞"
    –°–í–û–ë–û–î–ù–ê–Ø = "—Å–≤–æ–±–æ–¥–Ω–∞—è"
    –¢–§_–°_–ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò = "—Ç—Ñ_—Å_–∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏"

class –°—Ç–∞—Ç—É—Å–Æ–î(Enum):
    –ù–ï_–ü–û–°–¢–£–ü–ê–õ = "–Ω–µ_–ø–æ—Å—Ç—É–ø–∞–ª"
    –ü–û–°–¢–£–ü–ò–õ = "–ø–æ—Å—Ç—É–ø–∏–ª"
    –°–û–ì–õ–ê–°–û–í–ê–ù = "—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω"
    –û–¢–ö–õ–û–ù–Å–ù = "–æ—Ç–∫–ª–æ–Ω—ë–Ω"
    –ù–ê_–†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò = "–Ω–∞_—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏"

class –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(Enum):
    –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ = "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
    –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† = "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"

# –ú–µ—Ç–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
–ú–ï–¢–ö–ò_–°–¢–ê–¢–£–°–ê_–Æ–î = {
    "–Ω–µ_–ø–æ—Å—Ç—É–ø–∞–ª": "üî¥ –ù–µ –ø–æ—Å—Ç—É–ø–∞–ª –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
    "–ø–æ—Å—Ç—É–ø–∏–ª": "üü° –ü–æ—Å—Ç—É–ø–∞–ª –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
    "—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω": "üü¢ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω –Æ–î",
    "–æ—Ç–∫–ª–æ–Ω—ë–Ω": "üî¥ –û—Ç–∫–ª–æ–Ω—ë–Ω",
    "–Ω–∞_—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏": "üü° –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏",
}

–ú–ï–¢–ö–ò_–§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê = {
    "—Ç–∏–ø–æ–≤–∞—è": "üìã –¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–¢–§)",
    "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞": "üìÑ –§–æ—Ä–º–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞",
    "—Å–≤–æ–±–æ–¥–Ω–∞—è": "üìù –°–≤–æ–±–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞",
    "—Ç—Ñ_—Å_–∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏": "‚úèÔ∏è –¢–§ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏",
}

–ú–ï–¢–ö–ò_–ó–û–ù = {
    "–∑–µ–ª—ë–Ω–∞—è": "üü¢ –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê",
    "–∂—ë–ª—Ç–∞—è": "üü° –ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê",
    "–∫—Ä–∞—Å–Ω–∞—è": "üî¥ –ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê",
}

def –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_—Å—Ç–∞—Ç—É—Å–∞(—Å—Ç–∞—Ç—É—Å) -> str:
    if isinstance(—Å—Ç–∞—Ç—É—Å, –°—Ç–∞—Ç—É—Å–Æ–î):
        return –ú–ï–¢–ö–ò_–°–¢–ê–¢–£–°–ê_–Æ–î.get(—Å—Ç–∞—Ç—É—Å.value, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
    return –ú–ï–¢–ö–ò_–°–¢–ê–¢–£–°–ê_–Æ–î.get(—Å—Ç–∞—Ç—É—Å, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")

def –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_—Ñ–æ—Ä–º—ã(—Ñ–æ—Ä–º–∞) -> str:
    if isinstance(—Ñ–æ—Ä–º–∞, –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞):
        return –ú–ï–¢–ö–ò_–§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê.get(—Ñ–æ—Ä–º–∞.value, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
    return –ú–ï–¢–ö–ò_–§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê.get(—Ñ–æ—Ä–º–∞, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")

def –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_–∑–æ–Ω—ã(–∑–æ–Ω–∞) -> str:
    if isinstance(–∑–æ–Ω–∞, –ó–æ–Ω–∞–†–∏—Å–∫–∞):
        return –ú–ï–¢–ö–ò_–ó–û–ù.get(–∑–æ–Ω–∞.value, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
    return –ú–ï–¢–ö–ò_–ó–û–ù.get(–∑–æ–Ω–∞, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")

–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø = [
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–∑–æ–∫",
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ–¥–≤–∏–∂–Ω–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞",
    "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑–∞–∫—É–ø–æ–∫", "–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
    "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤",
]

–î–û–õ–ñ–ù–û–°–¢–ò = [
    "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–í–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞", "–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
]

–ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê = [
    "–ê—Ä–µ–Ω–¥–∞ –≤–∞–≥–æ–Ω–æ–≤", "–õ–∏–∑–∏–Ω–≥ –≤–∞–≥–æ–Ω–æ–≤", "–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –≤–∞–≥–æ–Ω–æ–≤",
    "–ê—Ä–µ–Ω–¥–∞ –ª–æ–∫–æ–º–æ—Ç–∏–≤–æ–≤", "–î–æ–≥–æ–≤–æ—Ä —Å –û–ê–û ¬´–†–ñ–î¬ª", "–í–≠–î/–í–∞–ª—é—Ç–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã",
    "–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–π–º–∞", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–ª–æ–≥–∞",
    "–ê—Ä–µ–Ω–¥–∞/–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û",
]

–ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´ = [
    "–î–æ–≥–æ–≤–æ—Ä –¢–≠–û", "–†–∞–º–æ—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –≥—Ä—É–∑–∞",
    "–ó–∞–∫—É–ø–∫–∞ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
]

–¢–ò–ü–´_–î–û–ì–û–í–û–†–û–í = [
    "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)", "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏", "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
    "–î–æ–≥–æ–≤–æ—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (–∞–≤—Ç–æ)", "–î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã –≤–∞–≥–æ–Ω–æ–≤", "–î–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞",
    "–ê–≥–µ–Ω—Ç—Å–∫–∏–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "–î—Ä—É–≥–æ–π",
]

# ============================================================================
# AI –ü–†–û–í–ê–ô–î–ï–†–´
# ============================================================================

AI_–ü–†–û–í–ê–ô–î–ï–†–´ = {
    "openai": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "OpenAI GPT-4", "url": "https://api.openai.com/v1/chat/completions", "–º–æ–¥–µ–ª—å": "gpt-4o-mini"},
    "anthropic": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Anthropic Claude", "url": "https://api.anthropic.com/v1/messages", "–º–æ–¥–µ–ª—å": "claude-3-haiku-20240307"},
    "gigachat": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "GigaChat (–°–±–µ—Ä)", "url": "https://gigachat.devices.sberbank.ru/api/v1/chat/completions", "–º–æ–¥–µ–ª—å": "GigaChat"},
    "yandexgpt": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "YandexGPT", "url": "https://llm.api.cloud.yandex.net/foundationModels/v1/completion", "–º–æ–¥–µ–ª—å": "yandexgpt-lite"},
}

# ============================================================================
# –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò - –ò–°–ü–†–ê–í–õ–ï–ù–û
# ============================================================================

# –ü–∞—Ä–æ–ª–∏: admin123 –∏ user123
–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò = {
    "admin": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("admin123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†,
        "–∏–º—è": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    },
    "user": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("user123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨,
        "–∏–º—è": "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    }
}

# ============================================================================
# –¢–ò–ü–û–í–´–ï –§–û–†–ú–´
# ============================================================================

–í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´ = {
    "–ø–æ—Å—Ç–∞–≤–∫–∞": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ (—Å –≠–î–û)",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–ü–û–°-001",
        "–≤–µ—Ä—Å–∏—è": "2024.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å", "—Ç–æ–≤–∞—Ä", "–ø–æ—Å—Ç–∞–≤–∫–∞", "–∑–∞–ø–∞—Å–Ω—ã–µ —á–∞—Å—Ç–∏", "—Ç–æ—Ä–≥-12"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è—Ç—å", "—Ç–æ–≤–∞—Ä"]},
            "–°–†–û–ö–ò –ü–û–°–¢–ê–í–ö–ò": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏", "–¥–∞—Ç–∞", "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"]},
            "–ö–ê–ß–ï–°–¢–í–û": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–∫–∞—á–µ—Å—Ç–≤–æ", "–≥–æ—Å—Ç", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"]},
            "–¶–ï–ù–ê –ò –†–ê–°–ß–Å–¢–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ü–µ–Ω–∞", "–æ–ø–ª–∞—Ç–∞", "—Ä–∞—Å—á—ë—Ç", "—Å—á—ë—Ç", "–Ω–¥—Å"]},
            "–ü–†–ò–Å–ú–ö–ê –¢–û–í–ê–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∏—ë–º–∫–∞", "–ø-6", "–ø-7"]},
            "–ì–ê–†–ê–ù–¢–ò–Ø": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–≥–∞—Ä–∞–Ω—Ç–∏—è", "–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫"]},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–Ω–µ—É—Å—Ç–æ–π–∫–∞", "—à—Ç—Ä–∞—Ñ"]},
            "–§–û–†–°-–ú–ê–ñ–û–†": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä", "–Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–∞—è —Å–∏–ª–∞"]},
            "–°–ü–û–†–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.0, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å–ø–æ—Ä—ã", "–∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Å—É–¥"]},
            "–†–ï–ö–í–ò–ó–ò–¢–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.3, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ä–µ–∫–≤–∏–∑–∏—Ç—ã", "–ø–æ–¥–ø–∏—Å–∏", "–∏–Ω–Ω"]},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–Ω–µ—É—Å—Ç–æ–π–∫\w*.*?–ø–æ–∫—É–ø–∞—Ç–µ–ª\w*.*?(?:0[,.]?[3-9]|[1-9])\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –¥–ª—è –Ω–∞—Å –≤—ã—à–µ 0.2%/–¥–µ–Ω—å"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"(?:–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω|–∑–∞—Ä—É–±–µ–∂–Ω)\w*.*?(?:—Å—É–¥|–∞—Ä–±–∏—Ç—Ä–∞–∂)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —Å—É–¥"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω\w+.*?–∏–∑–º–µ–Ω–µ–Ω\w+.*?—Ü–µ–Ω", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã"},
        ]
    },
    "—Ö—Ä–∞–Ω–µ–Ω–∏–µ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–•–†–ù-001",
        "–≤–µ—Ä—Å–∏—è": "2024.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å",
        "–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å", "—Ö—Ä–∞–Ω–µ–Ω–∏–µ", "–∏–º—É—â–µ—Å—Ç–≤–æ", "–º—Ö-1"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å", "—Ö—Ä–∞–Ω–µ–Ω–∏–µ"]},
            "–û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò –°–¢–û–†–û–ù": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "–º—Ö-1", "–º—Ö-3"]},
            "–í–û–ó–ù–ê–ì–†–ê–ñ–î–ï–ù–ò–ï": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ", "–æ–ø–ª–∞—Ç–∞"]},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—É—Ç—Ä–∞—Ç–∞", "—É—â–µ—Ä–±"]},
            "–°–ü–û–†–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å–ø–æ—Ä—ã", "—Å—É–¥"]},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—Ö—Ä–∞–Ω–∏—Ç–µ–ª\w+.*?–Ω–µ\s+(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–•—Ä–∞–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
        ]
    },
    "—É—Å–ª—É–≥–∏_—Ç—ç–æ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–£–°–õ-001",
        "–≤–µ—Ä—Å–∏—è": "2025.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ó–∞–∫–∞–∑—á–∏–∫",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏", "–≤–∞–≥–æ–Ω—ã", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "—Ç—ç–æ", "–µ–ª—Å", "—Ä–∂–¥"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–û–ù–Ø–¢–ò–Ø –ò –¢–ï–†–ú–ò–ù–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–≤–∞–≥–æ–Ω—ã", "–≥—Ä—É–∑", "–∑–∞—è–≤–∫–∞", "–µ–ª—Å"]},
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏"]},
            "–ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∞–≤–∞", "–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "–∑–∞—è–≤–∫–∞"]},
            "–°–¢–û–ò–ú–û–°–¢–¨ –ò –†–ê–°–ß–Å–¢–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ç–æ–∏–º–æ—Å—Ç—å", "–æ–ø–ª–∞—Ç–∞", "–∞–∫—Ç"]},
            "–ü–†–ò–Å–ú–ö–ê –£–°–õ–£–ì": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∏—ë–º–∫–∞", "–∞–∫—Ç", "–ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—à—Ç—Ä–∞—Ñ", "–Ω–µ—É—Å—Ç–æ–π–∫–∞", "–ø—Ä–æ—Å—Ç–æ–π"]},
            "–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å", "—Ç–∞–π–Ω–∞"]},
            "–°–ü–û–†–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å–ø–æ—Ä—ã", "–ø—Ä–µ—Ç–µ–Ω–∑–∏—è", "–∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π"]},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–∑–∞–∫–∞–∑—á–∏–∫.*?(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç).*?(?:–≤—Å–µ|–ª—é–±—ã–µ).*?—Ä–∏—Å–∫", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–í—Å–µ —Ä–∏—Å–∫–∏ –≤–æ–∑–ª–æ–∂–µ–Ω—ã –Ω–∞ –Ω–∞—Å"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–Ω–µ—É—Å—Ç–æ–π–∫\w*.*?–∑–∞–∫–∞–∑—á–∏–∫\w*.*?(?:0[,.]?[3-9]|[1-9])\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –¥–ª—è –Ω–∞—Å –≤—ã—à–µ 0.2%/–¥–µ–Ω—å"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—à—Ç—Ä–∞—Ñ.*?–ø—Ä–æ—Å—Ç–æ–π.*?(?:[3-9]\d{3}|[1-9]\d{4})", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π –±–æ–ª–µ–µ 2500 —Ä—É–±/—Å—É—Ç–∫–∏"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—à—Ç—Ä–∞—Ñ.*?–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç.*?(?:[5-9]|[1-9]\d)\s*(?:000\s*000|–º–ª–Ω)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–®—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –±–æ–ª–µ–µ 5 –º–ª–Ω"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω\w+.*?–∏–∑–º–µ–Ω–µ–Ω\w+.*?(?:—Ü–µ–Ω|—Ç–∞—Ä–∏—Ñ)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–ø–ª–∞—Ç–∞.*?(?:1|2|3)\s*(?:—Ä–∞–±–æ—á|–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω)", "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã –º–µ–Ω–µ–µ 5 –¥–Ω–µ–π"},
        ]
    },
    "–ø–µ—Ä–µ–≤–æ–∑–∫–∞_–∞–≤—Ç–æ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (–∞–≤—Ç–æ)",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–ê–í–¢-001",
        "–≤–µ—Ä—Å–∏—è": "2023.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ó–∞–∫–∞–∑—á–∏–∫",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫", "–∑–∞–∫–∞–∑—á–∏–∫", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "–∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–≥—Ä—É–∑"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "–≥—Ä—É–∑"]},
            "–ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∞–≤–∞", "–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "–∑–∞—è–≤–∫–∞"]},
            "–°–¢–û–ò–ú–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 1.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ç–æ–∏–º–æ—Å—Ç—å", "–æ–ø–ª–∞—Ç–∞"]},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 2.0, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—É—Ç—Ä–∞—Ç–∞", "—É—â–µ—Ä–±"]},
            "–°–ü–û–†–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–≤–µ—Å": 0.5, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å–ø–æ—Ä—ã", "–∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π"]},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫.*?–Ω–µ\s+(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü–µ—Ä–µ–≤–æ–∑—á–∏–∫ –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≥—Ä—É–∑"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
        ]
    }
}

# ============================================================================
# –î–ï–ú–û –î–û–ì–û–í–û–†
# ============================================================================

–î–ï–ú–û_–î–û–ì–û–í–û–† = """–î–û–ì–û–í–û–† –û–ö–ê–ó–ê–ù–ò–Ø –£–°–õ–£–ì ‚Ññ 2025/–¢–≠–û-001

–≥. –ú–æ—Å–∫–≤–∞                                                     ¬´15¬ª —è–Ω–≤–∞—Ä—è 2025 –≥.

–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª (–ò–ù–ù 7707123456), –∏–º–µ–Ω—É–µ–º–æ–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º ¬´–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å¬ª, –≤ –ª–∏—Ü–µ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –°–∏–¥–æ—Ä–æ–≤–∞ –°.–°., –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –£—Å—Ç–∞–≤–∞, —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∏
–ê–∫—Ü–∏–æ–Ω–µ—Ä–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ ¬´–°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª (–ê–û ¬´–°–ü–ö¬ª), –∏–º–µ–Ω—É–µ–º–æ–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º ¬´–ó–∞–∫–∞–∑—á–∏–∫¬ª, –≤ –ª–∏—Ü–µ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ü–µ—Ç—Ä–æ–≤–∞ –ü.–ü., –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –£—Å—Ç–∞–≤–∞, —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã,
—Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏–º–µ–Ω—É–µ–º—ã–µ ¬´–°—Ç–æ—Ä–æ–Ω—ã¬ª, –∑–∞–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –î–æ–≥–æ–≤–æ—Ä:

–ü–û–ù–Ø–¢–ò–Ø –ò –¢–ï–†–ú–ò–ù–´

¬´–í–∞–≥–æ–Ω—ã¬ª - –∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –ø–æ–¥–≤–∏–∂–Ω–æ–π —Å–æ—Å—Ç–∞–≤ (–ø–æ–ª—É–≤–∞–≥–æ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ).
¬´–ì—Ä—É–∑¬ª - —Ç–æ–≤–∞—Ä, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –∫ –ø–µ—Ä–µ–≤–æ–∑–∫–µ.
¬´–ó–∞—è–≤–∫–∞¬ª - —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–≤–æ–∑–∫–∏.
¬´–ï–õ–°¬ª - –µ–¥–∏–Ω—ã–π –ª–∏—Ü–µ–≤–æ–π —Å—á—ë—Ç.

1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê

1.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥–∏ –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∂/–¥ –≤–∞–≥–æ–Ω–æ–≤ –¥–ª—è –ø–µ—Ä–µ–≤–æ–∑–∫–∏ –≥—Ä—É–∑–æ–≤ –ó–∞–∫–∞–∑—á–∏–∫–∞, –∞ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –æ–∫–∞–∑–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏.

2. –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò –°–¢–û–†–û–ù

2.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –ø–æ–¥–∞—Ç—å –≤–∞–≥–æ–Ω—ã –ø–æ –ó–∞—è–≤–∫–µ –ó–∞–∫–∞–∑—á–∏–∫–∞.
2.2. –ó–∞–∫–∞–∑—á–∏–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–≥—Ä—É–∑–∫—É –∏ –≤—ã–≥—Ä—É–∑–∫—É –≤ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Ä–æ–∫–∏.
2.3. –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ—Å—ë—Ç –≤—Å–µ —Ä–∏—Å–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–∞–≥–æ–Ω–æ–≤.

3. –°–¢–û–ò–ú–û–°–¢–¨ –£–°–õ–£–ì –ò –ü–û–†–Ø–î–û–ö –†–ê–°–ß–Å–¢–û–í

3.1. –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥: 8 500 000 (–í–æ—Å–µ–º—å –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø—è—Ç—å—Å–æ—Ç —Ç—ã—Å—è—á) —Ä—É–±–ª–µ–π –≤ –≥–æ–¥.
3.2. –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ 50% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è.
3.3. –û–ø–ª–∞—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á—ë—Ç–∞.
3.4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ –∏–∑–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∑–∞ 10 –¥–Ω–µ–π.

4. –ü–û–†–Ø–î–û–ö –ü–†–ò–Å–ú–ö–ò –£–°–õ–£–ì

4.1. –ê–∫—Ç –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.
4.2. –ú–æ–ª—á–∞–Ω–∏–µ –ó–∞–∫–∞–∑—á–∏–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ–º.

5. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù

5.1. –ó–∞ —Å–≤–µ—Ä—Ö–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞–≥–æ–Ω–æ–≤ —à—Ç—Ä–∞—Ñ 5 000 —Ä—É–±–ª–µ–π –∑–∞ –≤–∞–≥–æ–Ω–æ-—Å—É—Ç–∫–∏.
5.2. –ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –æ–ø–ª–∞—Ç—ã –Ω–µ—É—Å—Ç–æ–π–∫–∞ 0,5% –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
5.3. –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ—Å—ë—Ç –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–∞–≥–æ–Ω–æ–≤.
5.4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –∏ —É–ø—É—â–µ–Ω–Ω—ã–µ —É–±—ã—Ç–∫–∏.

6. –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨

6.1. –°—Ä–æ–∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: –±–µ—Å—Å—Ä–æ—á–Ω–æ.
6.2. –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: 15 000 000 —Ä—É–±–ª–µ–π.

7. –§–û–†–°-–ú–ê–ñ–û–†

7.1. –°—Ç–æ—Ä–æ–Ω—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–π —Å–∏–ª–µ.

8. –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø –ò –†–ê–°–¢–û–†–ñ–ï–ù–ò–ï

8.1. –î–æ–≥–æ–≤–æ—Ä –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 31.12.2025.
8.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—å –¥–æ–≥–æ–≤–æ—Ä –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ, —É–≤–µ–¥–æ–º–∏–≤ –∑–∞ 5 –¥–Ω–µ–π.

9. –†–ê–ó–†–ï–®–ï–ù–ò–ï –°–ü–û–†–û–í

9.1. –í—Å–µ —Å–ø–æ—Ä—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω–æ–º —Å—É–¥–µ –≥. –ú–æ—Å–∫–≤—ã.

10. –†–ï–ö–í–ò–ó–ò–¢–´ –ò –ü–û–î–ü–ò–°–ò –°–¢–û–†–û–ù

–ó–ê–ö–ê–ó–ß–ò–ö:                              –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨:
–ê–û ¬´–°–ü–ö¬ª                               –û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª
–ò–ù–ù 7708654321                         –ò–ù–ù 7707123456

___________/–ü–µ—Ç—Ä–æ–≤ –ü.–ü./               ___________/–°–∏–¥–æ—Ä–æ–≤ –°.–°./
"""

# –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
–î–ï–ú–û_–î–ê–ù–ù–´–ï = {
    "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": "–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª",
    "–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞": "2025/–¢–≠–û-001",
    "–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞": date(2025, 1, 15),
    "—Å—É–º–º–∞": 8_500_000,
    "—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞": "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)",
    "—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞": –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–ö–û–ù–¢–†–ê–ì–ï–ù–¢–ê,
    "—Å—Ç–∞—Ç—É—Å_—é–¥": –°—Ç–∞—Ç—É—Å–Æ–î.–ù–ï_–ü–û–°–¢–£–ü–ê–õ,
}

# ============================================================================
# –ó–ê–ì–†–£–ó–ß–ò–ö –î–û–ö–£–ú–ï–ù–¢–û–í
# ============================================================================

class –ó–∞–≥—Ä—É–∑—á–∏–∫–î–æ–∫—É–º–µ–Ω—Ç–æ–≤:
    @staticmethod
    def –∑–∞–≥—Ä—É–∑–∏—Ç—å_txt(content: bytes) -> str:
        for –∫–æ–¥–∏—Ä–æ–≤–∫–∞ in ['utf-8', 'cp1251', 'cp866', 'latin-1', 'koi8-r']:
            try:
                —Ç–µ–∫—Å—Ç = content.decode(–∫–æ–¥–∏—Ä–æ–≤–∫–∞)
                if re.search(r'[–∞-—è–ê-–Ø—ë–Åa-zA-Z]', —Ç–µ–∫—Å—Ç):
                    return —Ç–µ–∫—Å—Ç
            except:
                continue
        return content.decode('utf-8', errors='replace')
    
    @staticmethod
    def –∑–∞–≥—Ä—É–∑–∏—Ç—å_docx(content: bytes) -> Tuple[bool, str]:
        if not DOCX_AVAILABLE:
            return False, "‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ python-docx: pip install python-docx"
        try:
            doc = DocxDocument(io.BytesIO(content))
            —á–∞—Å—Ç–∏ = []
            for para in doc.paragraphs:
                if para.text.strip():
                    —á–∞—Å—Ç–∏.append(para.text.strip())
            for table in doc.tables:
                for row in table.rows:
                    —è—á–µ–π–∫–∏ = [c.text.strip() for c in row.cells if c.text.strip()]
                    if —è—á–µ–π–∫–∏:
                        —á–∞—Å—Ç–∏.append(' | '.join(—è—á–µ–π–∫–∏))
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç = '\n'.join(—á–∞—Å—Ç–∏)
            return (True, —Ä–µ–∑—É–ª—å—Ç–∞—Ç) if —Ä–µ–∑—É–ª—å—Ç–∞—Ç.strip() else (False, "‚ùå –î–æ–∫—É–º–µ–Ω—Ç –ø—É—Å—Ç–æ–π")
        except Exception as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞ DOCX: {e}"
    
    @staticmethod
    def –∑–∞–≥—Ä—É–∑–∏—Ç—å_pdf(content: bytes) -> Tuple[bool, str]:
        if not PDF_AVAILABLE:
            return False, "‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PyPDF2: pip install PyPDF2"
        try:
            reader = PdfReader(io.BytesIO(content))
            —á–∞—Å—Ç–∏ = [page.extract_text().strip() for page in reader.pages if page.extract_text()]
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç = '\n'.join(—á–∞—Å—Ç–∏)
            return (True, —Ä–µ–∑—É–ª—å—Ç–∞—Ç) if —Ä–µ–∑—É–ª—å—Ç–∞—Ç.strip() else (False, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç")
        except Exception as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞ PDF: {e}"
    
    @classmethod
    def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(cls, uploaded_file) -> Tuple[bool, str]:
        if not uploaded_file:
            return False, "‚ùå –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω"
        try:
            content = uploaded_file.read()
            filename = uploaded_file.name.lower()
            if filename.endswith('.txt'):
                return True, cls.–∑–∞–≥—Ä—É–∑–∏—Ç—å_txt(content)
            elif filename.endswith('.docx'):
                return cls.–∑–∞–≥—Ä—É–∑–∏—Ç—å_docx(content)
            elif filename.endswith('.doc'):
                return False, "‚ùå –§–æ—Ä–º–∞—Ç .doc –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ .docx"
            elif filename.endswith('.pdf'):
                return cls.–∑–∞–≥—Ä—É–∑–∏—Ç—å_pdf(content)
            return False, "‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .docx, .pdf –∏–ª–∏ .txt"
        except Exception as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞: {e}"

# ============================================================================
# –ê–ù–ê–õ–ò–ó–ê–¢–û–† –î–û–ì–û–í–û–†–û–í
# ============================================================================

class –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–î–æ–≥–æ–≤–æ—Ä–æ–≤:
    """–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Å —Ç–∏–ø–æ–≤—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏"""
    
    –°–¢–û–ü_–°–õ–û–í–ê = {'–∏', '–≤', '–Ω–∞', '–ø–æ', '—Å', '–∫', '–æ', '–æ—Ç', '–∏–∑', '–∑–∞', '–¥–ª—è', '–Ω–µ', '—á—Ç–æ', '–∫–∞–∫', 
                  '—ç—Ç–æ', '–≤—Å–µ', '–∏–ª–∏', '–ø—Ä–∏', '–¥–æ', '–±–µ–∑', '–µ–≥–æ', '–µ—ë', '–∏—Ö', '–∞', '–Ω–æ', '–¥–∞', '–∂–µ'}
    
    @classmethod
    def –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str) -> str:
        if not —Ç–µ–∫—Å—Ç:
            return ""
        —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.lower()
        —Ç–µ–∫—Å—Ç = re.sub(r'[¬´¬ª""‚Äû‚Äü\'\"]', '', —Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'[\n\r\t]+', ' ', —Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'\s+', ' ', —Ç–µ–∫—Å—Ç)
        return —Ç–µ–∫—Å—Ç.strip()
    
    @classmethod
    def —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str) -> List[str]:
        —Ç–µ–∫—Å—Ç = cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'[^\w\s–∞-—è—ë–ê-–Ø–Å]', ' ', —Ç–µ–∫—Å—Ç)
        —Ç–æ–∫–µ–Ω—ã = —Ç–µ–∫—Å—Ç.split()
        return [t for t in —Ç–æ–∫–µ–Ω—ã if len(t) > 2 and t not in cls.–°–¢–û–ü_–°–õ–û–í–ê]
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(cls, —Ç–µ–∫—Å—Ç: str, –º–∞—Ä–∫–µ—Ä—ã: List[str]) -> Tuple[float, List[str]]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ"""
        if not –º–∞—Ä–∫–µ—Ä—ã:
            return 0.5, []
        
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç)
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = []
        
        for –º–∞—Ä–∫–µ—Ä in –º–∞—Ä–∫–µ—Ä—ã:
            –º–∞—Ä–∫–µ—Ä_–Ω–æ—Ä–º = –º–∞—Ä–∫–µ—Ä.lower()
            if –º–∞—Ä–∫–µ—Ä_–Ω–æ—Ä–º in —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º:
                –Ω–∞–π–¥–µ–Ω–Ω—ã–µ.append(–º–∞—Ä–∫–µ—Ä)
        
        —Å–∫–æ—Ä = len(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ) / len(–º–∞—Ä–∫–µ—Ä—ã) if –º–∞—Ä–∫–µ—Ä—ã else 0
        return —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    
    @classmethod
    def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(cls, —Ç–µ–∫—Å—Ç: str) -> Tuple[Optional[str], float, str]:
        """–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º"""
        –ª—É—á—à–µ–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ = None
        –ª—É—á—à–∏–π_—Å–∫–æ—Ä = 0
        –ø—Ä–∏—á–∏–Ω–∞ = ""
        
        for –∫–æ–¥_—Ç—Ñ, –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´.items():
            –º–∞—Ä–∫–µ—Ä—ã = –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ.get("–º–∞—Ä–∫–µ—Ä—ã", [])
            —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç, –º–∞—Ä–∫–µ—Ä—ã)
            
            # –ë–æ–Ω—É—Å –∑–∞ –Ω–∞—à—É —Ä–æ–ª—å
            –Ω–∞—à–∞_—Ä–æ–ª—å = –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ.get("–Ω–∞—à–∞_—Ä–æ–ª—å", "").lower()
            if –Ω–∞—à–∞_—Ä–æ–ª—å in cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç):
                —Å–∫–æ—Ä += 0.1
            
            if —Å–∫–æ—Ä > –ª—É—á—à–∏–π_—Å–∫–æ—Ä:
                –ª—É—á—à–∏–π_—Å–∫–æ—Ä = —Å–∫–æ—Ä
                –ª—É—á—à–µ–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ = –∫–æ–¥_—Ç—Ñ
                –ø—Ä–∏—á–∏–Ω–∞ = f"–ù–∞–π–¥–µ–Ω–æ {len(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ)}/{len(–º–∞—Ä–∫–µ—Ä—ã)} –º–∞—Ä–∫–µ—Ä–æ–≤: {', '.join(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ[:5])}"
        
        return –ª—É—á—à–µ–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, min(–ª—É—á—à–∏–π_—Å–∫–æ—Ä, 1.0), –ø—Ä–∏—á–∏–Ω–∞
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(cls, —Ç–µ–∫—Å—Ç: str, –ø–∞—Ç—Ç–µ—Ä–Ω—ã: List[Dict]) -> List[Dict]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤"""
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∏—Å–∫–∏ = []
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = —Ç–µ–∫—Å—Ç.lower()
        
        for –ø in –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
            try:
                match = re.search(–ø["–ø–∞—Ç—Ç–µ—Ä–Ω"], —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º, re.IGNORECASE | re.DOTALL)
                if match:
                    # –ö–æ–Ω—Ç–µ–∫—Å—Ç
                    start = max(0, match.start() - 80)
                    end = min(len(—Ç–µ–∫—Å—Ç), match.end() + 80)
                    –∫–æ–Ω—Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç[start:end].replace('\n', ' ').strip()
                    
                    –Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∏—Å–∫–∏.append({
                        "–ø—Ä–æ–±–ª–µ–º–∞": –ø.get("–ø—Ä–æ–±–ª–µ–º–∞", "–í—ã—è–≤–ª–µ–Ω —Ä–∏—Å–∫"),
                        "—É—Ä–æ–≤–µ–Ω—å": –ø.get("—É—Ä–æ–≤–µ–Ω—å", "–∂—ë–ª—Ç—ã–π"),
                        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": f"¬´...{–∫–æ–Ω—Ç–µ–∫—Å—Ç}...¬ª",
                    })
            except re.error:
                continue
        
        return –Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∏—Å–∫–∏
    
    @classmethod
    def –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞: str, –∫–æ–¥_—Ç—Ñ: str = None) -> Dict:
        """–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞"""
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {
            "–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ_—Ç—Ñ": None,
            "—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å": 0,
            "–ø—Ä–∏—á–∏–Ω–∞_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è": "",
            "–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ": "",
            "–∫–æ–¥_—Ç—Ñ": "",
            "–Ω–∞—à–∞_—Ä–æ–ª—å": "",
            "–Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª—ã": [],
            "–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ_—Ä–∞–∑–¥–µ–ª—ã": [],
            "—Ä–∏—Å–∫–∏": [],
            "–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤": [],
            "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": 0,
            "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": [],
            "—Ä–µ–∑—é–º–µ": "",
            "—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞": False
        }
        
        # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        if not –∫–æ–¥_—Ç—Ñ:
            detected, conf, reason = cls.–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞)
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ_—Ç—Ñ"] = detected
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"] = conf
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"] = reason
            if conf >= 0.4:
                –∫–æ–¥_—Ç—Ñ = detected
        
        if not –∫–æ–¥_—Ç—Ñ or –∫–æ–¥_—Ç—Ñ not in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É –≤—Ä—É—á–Ω—É—é."
            return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
        —Ç—Ñ = –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´[–∫–æ–¥_—Ç—Ñ]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ"] = —Ç—Ñ.get("–Ω–∞–∑–≤–∞–Ω–∏–µ", "")
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫–æ–¥_—Ç—Ñ"] = —Ç—Ñ.get("–∫–æ–¥", "")
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞—à–∞_—Ä–æ–ª—å"] = —Ç—Ñ.get("–Ω–∞—à–∞_—Ä–æ–ª—å", "")
        
        # –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤
        –æ–±—â–∏–π_—Å–∫–æ—Ä = 0
        –æ–±—â–∏–π_–≤–µ—Å = 0
        
        for –Ω–∞–∑–≤–∞–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª–∞, –¥–∞–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª–∞ in —Ç—Ñ.get("—Ä–∞–∑–¥–µ–ª—ã", {}).items():
            –≤–µ—Å = –¥–∞–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª–∞.get("–≤–µ—Å", 1.0)
            –º–∞—Ä–∫–µ—Ä—ã = –¥–∞–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª–∞.get("–º–∞—Ä–∫–µ—Ä—ã", [])
            –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω = –¥–∞–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª–∞.get("–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω", False)
            –æ–±—â–∏–π_–≤–µ—Å += –≤–µ—Å
            
            —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, –º–∞—Ä–∫–µ—Ä—ã)
            
            if —Å–∫–æ—Ä >= 0.5:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª—ã"].append(–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª–∞)
                –æ–±—â–∏–π_—Å–∫–æ—Ä += –≤–µ—Å * —Å–∫–æ—Ä
            elif —Å–∫–æ—Ä >= 0.25:
                –æ–±—â–∏–π_—Å–∫–æ—Ä += –≤–µ—Å * —Å–∫–æ—Ä * 0.5
            else:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ_—Ä–∞–∑–¥–µ–ª—ã"].append(–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª–∞)
                if –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω:
                    —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"].append(f"üö´ –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª ¬´{–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ä–∞–∑–¥–µ–ª–∞}¬ª")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤
        —Ä–∏—Å–∫–∏ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, —Ç—Ñ.get("—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã", []))
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–∏—Å–∫–∏"] = —Ä–∏—Å–∫–∏
        
        –∫—Ä–∞—Å–Ω—ã—Ö = sum(1 for r in —Ä–∏—Å–∫–∏ if r.get("—É—Ä–æ–≤–µ–Ω—å") == "–∫—Ä–∞—Å–Ω—ã–π")
        –∂—ë–ª—Ç—ã—Ö = sum(1 for r in —Ä–∏—Å–∫–∏ if r.get("—É—Ä–æ–≤–µ–Ω—å") == "–∂—ë–ª—Ç—ã–π")
        
        # –†–∞—Å—á—ë—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
        –±–∞–∑–æ–≤—ã–π_—Å–∫–æ—Ä = (–æ–±—â–∏–π_—Å–∫–æ—Ä / –æ–±—â–∏–π_–≤–µ—Å * 100) if –æ–±—â–∏–π_–≤–µ—Å > 0 else 0
        —à—Ç—Ä–∞—Ñ = –∫—Ä–∞—Å–Ω—ã—Ö * 12 + –∂—ë–ª—Ç—ã—Ö * 4
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] = max(0, min(100, –±–∞–∑–æ–≤—ã–π_—Å–∫–æ—Ä - —à—Ç—Ä–∞—Ñ))
        
        # –î–µ—Ç–∞–ª–∏ —Ä–∏—Å–∫–æ–≤
        for —Ä–∏—Å–∫ in —Ä–∏—Å–∫–∏:
            —É—Ä–æ–≤–µ–Ω—å = "üî¥ –ö–†–ò–¢–ò–ß–ù–û" if —Ä–∏—Å–∫["—É—Ä–æ–≤–µ–Ω—å"] == "–∫—Ä–∞—Å–Ω—ã–π" else "üü° –í–ù–ò–ú–ê–ù–ò–ï"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤"].append({
                "—É—Ä–æ–≤–µ–Ω—å": —É—Ä–æ–≤–µ–Ω—å,
                "–ø—Ä–æ–±–ª–µ–º–∞": —Ä–∏—Å–∫["–ø—Ä–æ–±–ª–µ–º–∞"],
                "–∫–æ–Ω—Ç–µ–∫—Å—Ç": —Ä–∏—Å–∫.get("–∫–æ–Ω—Ç–µ–∫—Å—Ç", ""),
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": cls._–ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é(—Ä–∏—Å–∫)
            })
        
        # –≠—Ç–æ –¢–§?
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞"] = (
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 70 and
            –∫—Ä–∞—Å–Ω—ã—Ö == 0 and
            len(—Ä–µ–∑—É–ª—å—Ç–∞—Ç["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ_—Ä–∞–∑–¥–µ–ª—ã"]) <= 2
        )
        
        # –†–µ–∑—é–º–µ
        if —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞"]:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚úÖ –î–æ–≥–æ–≤–æ—Ä –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–µ ¬´{—Ä–µ–∑—É–ª—å—Ç–∞—Ç['–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ']}¬ª"
        elif —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 50:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%). –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞."
        else:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ùå –ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–µ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%). –¢—Ä–µ–±—É–µ—Ç—Å—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –Æ–î."
        
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    @classmethod
    def _–ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é(cls, —Ä–∏—Å–∫: Dict) -> str:
        –ø—Ä–æ–±–ª–µ–º–∞ = —Ä–∏—Å–∫.get("–ø—Ä–æ–±–ª–µ–º–∞", "").lower()
        
        if "–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞" in –ø—Ä–æ–±–ª–µ–º–∞ or "–∞–≤–∞–Ω—Å" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ ¬´–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –Ω–µ –±–æ–ª–µ–µ 30%¬ª –∏–ª–∏ ¬´–æ–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É¬ª"
        elif "–Ω–µ—É—Å—Ç–æ–π–∫–∞" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–°–Ω–∏–∑–∏—Ç—å –¥–æ 0,1% –≤ –¥–µ–Ω—å, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç —Å—É–º–º—ã"
        elif "–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–ò—Å–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–æ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–æ –æ—Ç–∫–∞–∑–∞"
        elif "—Å—É–¥" in –ø—Ä–æ–±–ª–µ–º–∞ and "–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Å—É–¥ –≥. –ú–æ—Å–∫–≤—ã"
        elif "–≤—Å–µ —Ä–∏—Å–∫–∏" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∏—Å–∫–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏"
        elif "–Ω–µ –Ω–µ—Å—ë—Ç" in –ø—Ä–æ–±–ª–µ–º–∞ or "–Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è"
        elif "—à—Ç—Ä–∞—Ñ" in –ø—Ä–æ–±–ª–µ–º–∞ and "–ø—Ä–æ—Å—Ç–æ–π" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–°–Ω–∏–∑–∏—Ç—å —à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π –¥–æ 2000 —Ä—É–±/—Å—É—Ç–∫–∏"
        elif "–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å" in –ø—Ä–æ–±–ª–µ–º–∞:
            return "–°–Ω–∏–∑–∏—Ç—å —à—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ 1-3 –º–ª–Ω —Ä—É–±–ª–µ–π"
        else:
            return "–ù–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –≤ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"

# ============================================================================
# AI –ê–ù–ê–õ–ò–ó–ê–¢–û–†
# ============================================================================

class AI–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä:
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ(cls, –ø—Ä–æ–≤–∞–π–¥–µ—Ä: str, –∫–ª—é—á: str, folder_id: str = "") -> Tuple[bool, str]:
        if not REQUESTS_AVAILABLE:
            return False, "‚ùå –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ requests –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
        if not –∫–ª—é—á:
            return False, "‚ùå –ö–ª—é—á –Ω–µ —É–∫–∞–∑–∞–Ω"
        
        try:
            if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "openai":
                response = requests.get(
                    "https://api.openai.com/v1/models",
                    headers={"Authorization": f"Bearer {–∫–ª—é—á}"},
                    timeout=10
                )
                if response.status_code == 200:
                    return True, "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ"
                return False, f"‚ùå –û—à–∏–±–∫–∞ {response.status_code}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "anthropic":
                response = requests.post(
                    "https://api.anthropic.com/v1/messages",
                    headers={"x-api-key": –∫–ª—é—á, "Content-Type": "application/json", "anthropic-version": "2023-06-01"},
                    json={"model": "claude-3-haiku-20240307", "max_tokens": 5, "messages": [{"role": "user", "content": "—Ç–µ—Å—Ç"}]},
                    timeout=15
                )
                if response.status_code == 200:
                    return True, "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ"
                return False, f"‚ùå –û—à–∏–±–∫–∞ {response.status_code}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "yandexgpt":
                if not folder_id:
                    return False, "‚ùå –ù—É–∂–µ–Ω Folder ID"
                return True, "‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "gigachat":
                return True, "‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è OAuth-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
            
            return False, "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä"
        
        except requests.exceptions.Timeout:
            return False, "‚ùå –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"
        except Exception as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:30]}"
    
    @classmethod
    def –≤—ã–∑–≤–∞—Ç—å_ai(cls, –ø—Ä–æ–≤–∞–π–¥–µ—Ä: str, –ø—Ä–æ–º–ø—Ç: str, –∫–ª—é—á: str, folder_id: str = "") -> Tuple[bool, str]:
        if not REQUESTS_AVAILABLE:
            return False, "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ requests –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
        
        try:
            if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "openai":
                response = requests.post(
                    "https://api.openai.com/v1/chat/completions",
                    headers={"Authorization": f"Bearer {–∫–ª—é—á}", "Content-Type": "application/json"},
                    json={
                        "model": "gpt-4o-mini",
                        "messages": [
                            {"role": "system", "content": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —é—Ä–∏—Å—Ç. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."},
                            {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                        ],
                        "max_tokens": 3000,
                        "temperature": 0.3
                    },
                    timeout=120
                )
                if response.status_code == 200:
                    return True, response.json()["choices"][0]["message"]["content"]
                return False, f"–û—à–∏–±–∫–∞: {response.status_code}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "anthropic":
                response = requests.post(
                    "https://api.anthropic.com/v1/messages",
                    headers={"x-api-key": –∫–ª—é—á, "Content-Type": "application/json", "anthropic-version": "2023-06-01"},
                    json={"model": "claude-3-haiku-20240307", "max_tokens": 3000, "messages": [{"role": "user", "content": –ø—Ä–æ–º–ø—Ç}]},
                    timeout=120
                )
                if response.status_code == 200:
                    return True, response.json()["content"][0]["text"]
                return False, f"–û—à–∏–±–∫–∞: {response.status_code}"
            
            return False, "–ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"
        
        except Exception as e:
            return False, f"–û—à–∏–±–∫–∞: {str(e)}"
    
    @classmethod
    def —Å–æ–∑–¥–∞—Ç—å_–ø—Ä–æ–º–ø—Ç(cls, —Ç–µ–∫—Å—Ç: str, –∞–Ω–∞–ª–∏–∑: Dict, –æ—Ä–≥: str) -> str:
        —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç = ""
        for i, —Ä–∏—Å–∫ in enumerate(–∞–Ω–∞–ª–∏–∑.get("–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤", [])[:8], 1):
            —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç += f"{i}. {—Ä–∏—Å–∫['—É—Ä–æ–≤–µ–Ω—å']}: {—Ä–∏—Å–∫['–ø—Ä–æ–±–ª–µ–º–∞']}\n"
        
        return f"""–¢—ã ‚Äî –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —é—Ä–∏—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏ {–æ—Ä–≥}.
–ú—ã –≤—ã—Å—Ç—É–ø–∞–µ–º –∫–∞–∫ {–∞–Ω–∞–ª–∏–∑.get('–Ω–∞—à–∞_—Ä–æ–ª—å', '–ó–∞–∫–∞–∑—á–∏–∫')}.

–¢–ï–ö–°–¢ –î–û–ì–û–í–û–†–ê:
{—Ç–µ–∫—Å—Ç[:6000]}

–í–´–Ø–í–õ–ï–ù–ù–´–ï –†–ò–°–ö–ò:
{—Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç if —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç else "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã—è–≤–∏–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤."}

–ó–ê–î–ê–ù–ò–ï:
1. –î–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
2. –£–∫–∞–∂–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É–Ω–∫—Ç—ã —Å –Ω–æ–º–µ—Ä–∞–º–∏ (—á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
3. –î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
4. –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–û–ì–õ–ê–°–û–í–ê–¢–¨ / –î–û–†–ê–ë–û–¢–ê–¢–¨ / –û–¢–ö–õ–û–ù–ò–¢–¨

–ü–∏—à–∏ –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É."""

# ============================================================================
# –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ó–û–ù–´ –†–ò–°–ö–ê
# ============================================================================

@dataclass
class –í—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ:
    —Å—É–º–º–∞: float = 0
    —Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞: –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞ = –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–¢–ò–ü–û–í–ê–Ø
    —Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞: str = ""
    —Ç–∏–ø_—Å–¥–µ–ª–∫–∏: str = ""
    —Å—Ç–∞—Ç—É—Å_—é–¥: –°—Ç–∞—Ç—É—Å–Æ–î = –°—Ç–∞—Ç—É—Å–Æ–î.–ù–ï_–ü–û–°–¢–£–ü–ê–õ
    –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π_–ø–æ—Å—Ç–∞–≤—â–∏–∫: bool = False
    —Ç–µ–Ω–¥–µ—Ä: bool = False
    —Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞: float = 0
    —Å—Ä–æ–∫_–ª–µ—Ç: int = 0
    –∏–∑–º–µ–Ω–µ–Ω–∏—è_—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ: bool = False
    –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: str = ""
    –Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞: str = ""
    –¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞: str = ""

@dataclass
class –†–µ–∑—É–ª—å—Ç–∞—Ç–ó–æ–Ω—ã:
    –∑–æ–Ω–∞: –ó–æ–Ω–∞–†–∏—Å–∫–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ó–ï–õ–Å–ù–ê–Ø
    –ø—Ä–∏—á–∏–Ω–∞: str = ""
    —Å—Ä–æ–∫_–¥–Ω–µ–π: int = 0
    —Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥: bool = False
    –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: str = "–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä"
    –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: List[str] = field(default_factory=list)
    –º–∞—Ä—à—Ä—É—Ç: List[str] = field(default_factory=list)

def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(–≤—Ö–æ–¥: –í—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ, –ø–æ—Ä–æ–≥–∏: Dict = None) -> –†–µ–∑—É–ª—å—Ç–∞—Ç–ó–æ–Ω—ã:
    if –ø–æ—Ä–æ–≥–∏ is None:
        –ø–æ—Ä–æ–≥–∏ = DEFAULT_THRESHOLDS
    
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –†–µ–∑—É–ª—å—Ç–∞—Ç–ó–æ–Ω—ã()
    —Å—Ä–æ–∫–∏ = DEFAULT_DEADLINES
    
    # –ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê
    if –≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and –≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–∑–æ–Ω–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ö–†–ê–°–ù–ê–Ø
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–∏—á–∏–Ω–∞ = f"–¢–∏–ø —Å–¥–µ–ª–∫–∏ ¬´{–≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}¬ª —Ç—Ä–µ–±—É–µ—Ç —É—á–∞—Å—Ç–∏—è –Æ–î"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π = "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Å—Ä–æ–∫_–¥–Ω–µ–π = —Å—Ä–æ–∫–∏["—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π"]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–º–∞—Ä—à—Ä—É—Ç = ["–Æ–î (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)", "–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.append("‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Æ–î –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!")
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if –≤—Ö–æ–¥.—Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5_000_000):
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–∑–æ–Ω–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ö–†–ê–°–ù–ê–Ø
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–∏—á–∏–Ω–∞ = f"–°—É–º–º–∞ {–≤—Ö–æ–¥.—Å—É–º–º–∞:,.0f}‚ÇΩ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π = "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Å—Ä–æ–∫_–¥–Ω–µ–π = —Å—Ä–æ–∫–∏["—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π"]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–º–∞—Ä—à—Ä—É—Ç = ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–Æ–î (—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞)", "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if –≤—Ö–æ–¥.—Ç–µ–Ω–¥–µ—Ä and –≤—Ö–æ–¥.—Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞ > –ø–æ—Ä–æ–≥–∏.get("—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è", 3_000_000):
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–∑–æ–Ω–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ö–†–ê–°–ù–ê–Ø
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–∏—á–∏–Ω–∞ = f"–¢–µ–Ω–¥–µ—Ä –Ω–∞ —Å—É–º–º—É {–≤—Ö–æ–¥.—Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞:,.0f}‚ÇΩ"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π = "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Å—Ä–æ–∫_–¥–Ω–µ–π = —Å—Ä–æ–∫–∏["—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π"]
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    # –ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê
    –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã = []
    
    if –≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and –≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´:
        –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–¢–∏–ø: {–≤—Ö–æ–¥.—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}")
    
    if –≤—Ö–æ–¥.–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π_–ø–æ—Å—Ç–∞–≤—â–∏–∫ and –≤—Ö–æ–¥.—Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫", 100_000):
        –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append("–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫")
    
    if –≤—Ö–æ–¥.—Å—Ä–æ–∫_–ª–µ—Ç > 3:
        –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–°—Ä–æ–∫ {–≤—Ö–æ–¥.—Å—Ä–æ–∫_–ª–µ—Ç} –ª–µ—Ç")
    
    if –≤—Ö–æ–¥.—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞ == –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–¢–ò–ü–û–í–ê–Ø:
        if –≤—Ö–æ–¥.—Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100_000):
            –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–°—É–º–º–∞ –¢–§ > {–ø–æ—Ä–æ–≥–∏.get('–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å', 100_000):,.0f}‚ÇΩ")
    elif –≤—Ö–æ–¥.—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞ in [–§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–ö–û–ù–¢–†–ê–ì–ï–ù–¢–ê, –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–°–í–û–ë–û–î–ù–ê–Ø]:
        if –≤—Ö–æ–¥.—Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50_000):
            –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–ù–µ—Ç–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ > {–ø–æ—Ä–æ–≥–∏.get('–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å', 50_000):,.0f}‚ÇΩ")
    elif –≤—Ö–æ–¥.—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞ == –§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–¢–§_–°_–ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò:
        if –≤—Ö–æ–¥.–∏–∑–º–µ–Ω–µ–Ω–∏—è_—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ:
            –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append("–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –¢–§")
    
    if –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–∑–æ–Ω–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ñ–Å–õ–¢–ê–Ø
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–∏—á–∏–Ω–∞ = "; ".join(–∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã)
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π = "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Å—Ä–æ–∫_–¥–Ω–µ–π = —Å—Ä–æ–∫–∏["—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π"]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–º–∞—Ä—à—Ä—É—Ç = ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–°–≠–î", "–Æ–î (—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞)", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.append("‚ö†Ô∏è –ó–ê–ü–†–ï–©–ï–ù–û –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑ –≤–∏–∑—ã –Æ–î!")
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    # –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–∑–æ–Ω–∞ = –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ó–ï–õ–Å–ù–ê–Ø
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–ø—Ä–∏—á–∏–Ω–∞ = "–ó–µ–ª—ë–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä (–ø. 4.1 –†–µ–≥–ª–∞–º–µ–Ω—Ç–∞)"
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ = False
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π = "–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä"
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.—Å—Ä–æ–∫_–¥–Ω–µ–π = 0
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç.–º–∞—Ä—à—Ä—É—Ç = ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
    return —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# ============================================================================
# –ì–ï–ù–ï–†–ê–¢–û–† –û–¢–ß–Å–¢–û–í
# ============================================================================

class –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–û—Ç—á—ë—Ç–æ–≤:
    @classmethod
    def —Ç–µ–∫—Å—Ç–æ–≤—ã–π_–æ—Ç—á—ë—Ç(cls, –¥–∞–Ω–Ω—ã–µ: Dict, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: Dict, –æ—Ä–≥: Dict, ai_—Ç–µ–∫—Å—Ç: str = "") -> str:
        –Ω–∞–∑–≤–∞–Ω–∏—è_–∑–æ–Ω = {"–∑–µ–ª—ë–Ω–∞—è": "–ó–ï–õ–Å–ù–ê–Ø", "–∂—ë–ª—Ç–∞—è": "–ñ–Å–õ–¢–ê–Ø", "–∫—Ä–∞—Å–Ω–∞—è": "–ö–†–ê–°–ù–ê–Ø"}
        –∑–æ–Ω–∞ = –¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", "")
        
        –æ—Ç—á—ë—Ç = f"""{'‚ïê'*70}
–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –Æ–†–ò–î–ò–ß–ï–°–ö–û–ì–û –î–ï–ü–ê–†–¢–ê–ú–ï–ù–¢–ê
{–æ—Ä–≥.get("full_name", "")}
{'‚ïê'*70}

üìÖ –î–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y %H:%M')}
üë§ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: {–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.get('–∏–º—è', '')}, {–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.get('–¥–æ–ª–∂–Ω–æ—Å—Ç—å', '')}

{'‚îÄ'*70}
–°–í–ï–î–ï–ù–ò–Ø –û –î–û–ì–û–í–û–†–ï
{'‚îÄ'*70}

–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:        {–¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ù–µ —É–∫–∞–∑–∞–Ω')}
–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞:    {–¥–∞–Ω–Ω—ã–µ.get('–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞', '–ù–µ —É–∫–∞–∑–∞–Ω')}
–î–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞:     {–¥–∞–Ω–Ω—ã–µ.get('–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞', '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}
–°—É–º–º–∞ –¥–æ–≥–æ–≤–æ—Ä–∞:    {–¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0):,.2f} —Ä—É–±.

{'‚îÄ'*70}
–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê
{'‚îÄ'*70}

üö¶ –ó–û–ù–ê –†–ò–°–ö–ê:           {–Ω–∞–∑–≤–∞–Ω–∏—è_–∑–æ–Ω.get(–∑–æ–Ω–∞, '–ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–ê')}
üìä –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¢–§:      {–¥–∞–Ω–Ω—ã–µ.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.1f}%
‚öñÔ∏è –¢–†–ï–ë–£–ï–¢–°–Ø –£–ß–ê–°–¢–ò–ï –Æ–î: {'–î–ê' if –¥–∞–Ω–Ω—ã–µ.get('—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥') else '–ù–ï–¢'}
‚è±Ô∏è –°–†–û–ö –°–û–ì–õ–ê–°–û–í–ê–ù–ò–Ø:    {–¥–∞–Ω–Ω—ã–µ.get('—Å—Ä–æ–∫_–¥–Ω–µ–π', 0)} —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

{'‚îÄ'*70}
–í–´–Ø–í–õ–ï–ù–ù–´–ï –†–ò–°–ö–ò
{'‚îÄ'*70}
"""
        
        –¥–µ—Ç–∞–ª–∏ = –¥–∞–Ω–Ω—ã–µ.get('–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤', [])
        –∫—Ä–∞—Å–Ω—ã–µ = [r for r in –¥–µ—Ç–∞–ª–∏ if '–ö–†–ò–¢–ò–ß–ù–û' in r.get('—É—Ä–æ–≤–µ–Ω—å', '')]
        –∂—ë–ª—Ç—ã–µ = [r for r in –¥–µ—Ç–∞–ª–∏ if '–í–ù–ò–ú–ê–ù–ò–ï' in r.get('—É—Ä–æ–≤–µ–Ω—å', '')]
        
        if –∫—Ä–∞—Å–Ω—ã–µ:
            –æ—Ç—á—ë—Ç += "\nüî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï:\n"
            for i, —Ä–∏—Å–∫ in enumerate(–∫—Ä–∞—Å–Ω—ã–µ, 1):
                –æ—Ç—á—ë—Ç += f"   {i}. {—Ä–∏—Å–∫.get('–ø—Ä–æ–±–ª–µ–º–∞', '')}\n"
                –æ—Ç—á—ë—Ç += f"      ‚û°Ô∏è {—Ä–∏—Å–∫.get('—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è', '')}\n"
        
        if –∂—ë–ª—Ç—ã–µ:
            –æ—Ç—á—ë—Ç += "\nüü° –¢–†–ï–ë–£–Æ–¢ –í–ù–ò–ú–ê–ù–ò–Ø:\n"
            for i, —Ä–∏—Å–∫ in enumerate(–∂—ë–ª—Ç—ã–µ, 1):
                –æ—Ç—á—ë—Ç += f"   {i}. {—Ä–∏—Å–∫.get('–ø—Ä–æ–±–ª–µ–º–∞', '')}\n"
        
        if not –∫—Ä–∞—Å–Ω—ã–µ and not –∂—ë–ª—Ç—ã–µ:
            –æ—Ç—á—ë—Ç += "\n‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏ –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã\n"
        
        if ai_—Ç–µ–∫—Å—Ç:
            –æ—Ç—á—ë—Ç += f"""
{'‚îÄ'*70}
–≠–ö–°–ü–ï–†–¢–ù–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï (AI)
{'‚îÄ'*70}

{ai_—Ç–µ–∫—Å—Ç}
"""
        
        –æ—Ç—á—ë—Ç += f"""
{'‚îÄ'*70}
–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï
{'‚îÄ'*70}

{–¥–∞–Ω–Ω—ã–µ.get('–∑–∞–∫–ª—é—á–µ–Ω–∏–µ', –¥–∞–Ω–Ω—ã–µ.get('—Ä–µ–∑—é–º–µ', ''))}

{'‚ïê'*70}
–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.2 | {–æ—Ä–≥.get('short_name', '')}
{'‚ïê'*70}
"""
        return –æ—Ç—á—ë—Ç

# ============================================================================
# –ò–°–¢–û–†–ò–Ø –ü–†–û–í–ï–†–û–ö - –ò–°–ü–†–ê–í–õ–ï–ù–û
# ============================================================================

def –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é(–¥–∞–Ω–Ω—ã–µ: Dict):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–≤–µ—Ä–æ–∫"""
    if "–∏—Å—Ç–æ—Ä–∏—è" not in st.session_state:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
    
    –∑–∞–ø–∏—Å—å = {
        "–∏–¥": hashlib.md5(f"{datetime.now().isoformat()}{–¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '')}".encode()).hexdigest()[:8],
        "–¥–∞—Ç–∞_–≤—Ä–µ–º—è": datetime.now().strftime('%d.%m.%Y %H:%M'),
        "–¥–∞—Ç–∞": datetime.now().strftime('%d.%m.%Y'),
        "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –¥–∞–Ω–Ω—ã–µ.get("–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç", "–ù–µ —É–∫–∞–∑–∞–Ω"),
        "–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞": –¥–∞–Ω–Ω—ã–µ.get("–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞", "–ù–µ —É–∫–∞–∑–∞–Ω"),
        "—Å—É–º–º–∞": –¥–∞–Ω–Ω—ã–µ.get("—Å—É–º–º–∞", 0),
        "–∑–æ–Ω–∞": –¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", ""),
        "–∑–æ–Ω–∞_–Ω–∞–∑–≤–∞–Ω–∏–µ": –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_–∑–æ–Ω—ã(–¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", "")),
        "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": –¥–∞–Ω–Ω—ã–µ.get("—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ", 0),
        "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": –¥–∞–Ω–Ω—ã–µ.get("—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥", False),
        "–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Ä–∏—Å–∫–æ–≤": len(–¥–∞–Ω–Ω—ã–µ.get("—Ä–∏—Å–∫–∏", [])),
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", {}).get("–∏–º—è", ""),
    }
    
    st.session_state.–∏—Å—Ç–æ—Ä–∏—è.insert(0, –∑–∞–ø–∏—Å—å)
    
    # –•—Ä–∞–Ω–∏–º –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø–∏—Å–µ–π
    if len(st.session_state.–∏—Å—Ç–æ—Ä–∏—è) > 100:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = st.session_state.–∏—Å—Ç–æ—Ä–∏—è[:100]

# ============================================================================
# –°–¢–ò–õ–ò CSS
# ============================================================================

def –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏():
    st.markdown("""<style>
:root { --primary:#1e3a5f; --secondary:#2d5a87; --red:#dc3545; --yellow:#f0ad4e; --green:#28a745; }
.main-header { background:linear-gradient(135deg,var(--primary),var(--secondary)); padding:1.8rem; border-radius:12px; margin-bottom:1.5rem; color:white; }
.main-header h2 { margin:0; font-size:1.5rem; }
.traffic-light { display:flex; gap:8px; margin-bottom:0.8rem; }
.traffic-light span { width:16px; height:16px; border-radius:50%; box-shadow:0 0 8px currentColor; }
.tl-red { background:var(--red); color:var(--red); }
.tl-yellow { background:var(--yellow); color:var(--yellow); }
.tl-green { background:var(--green); color:var(--green); }
.version-badge { background:rgba(255,255,255,0.2); padding:3px 10px; border-radius:6px; font-size:0.7rem; margin-left:10px; }
.zone-card { border-radius:10px; padding:1.2rem; margin-bottom:1.2rem; border-left:5px solid; }
.zone-card.–∑–µ–ª—ë–Ω–∞—è { background:linear-gradient(135deg,#e8f5e9,#c8e6c9); border-left-color:var(--green); }
.zone-card.–∂—ë–ª—Ç–∞—è { background:linear-gradient(135deg,#fff8e1,#ffecb3); border-left-color:var(--yellow); }
.zone-card.–∫—Ä–∞—Å–Ω–∞—è { background:linear-gradient(135deg,#ffebee,#ffcdd2); border-left-color:var(--red); }
.zone-title { font-size:1.2rem; font-weight:600; margin-bottom:0.4rem; }
.risk-item { background:white; border-radius:8px; padding:1rem; margin-bottom:0.5rem; border-left:4px solid; }
.risk-item.red { border-left-color:var(--red); background:linear-gradient(90deg,#fff5f5,white); }
.risk-item.yellow { border-left-color:var(--yellow); background:linear-gradient(90deg,#fffcf0,white); }
.metric-card { background:#f8f9fa; border-radius:8px; padding:1rem; text-align:center; border:1px solid #e9ecef; }
.metric-value { font-size:1.6rem; font-weight:700; color:var(--primary); }
.metric-label { font-size:0.8rem; color:#6c757d; }
.admin-badge { background:#7b1fa2; color:white; padding:2px 8px; border-radius:10px; font-size:0.7rem; }
.user-badge { background:#1976d2; color:white; padding:2px 8px; border-radius:10px; font-size:0.7rem; }
.demo-badge { background:#ff9800; color:white; padding:2px 8px; border-radius:10px; font-size:0.7rem; }
footer { visibility:hidden; }
</style>""", unsafe_allow_html=True)

# ============================================================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ============================================================================

def –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è():
    –∑–Ω–∞—á–µ–Ω–∏—è = {
        "–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω": False,
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": None,
        "—Ä–æ–ª—å": None,
        "–¥–µ–º–æ_—Ä–µ–∂–∏–º": False,
        "—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞": "",
        "—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω": False,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã": None,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞": None,
        "ai_–∞–Ω–∞–ª–∏–∑": "",
        "–∏—Å—Ç–æ—Ä–∏—è": [],
        "—Ç–µ–∫—É—â–∏–π_–≤–≤–æ–¥": None,
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ": {},
        "–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏": DEFAULT_ORG_CONFIG.copy(),
        "–ø–æ—Ä–æ–≥–∏": DEFAULT_THRESHOLDS.copy(),
        "api_–∫–ª—é—á–∏": {p: "" for p in AI_–ü–†–û–í–ê–ô–î–ï–†–´},
        "yandex_folder_id": "",
        "–≤–∫–ª—é—á—ë–Ω–Ω—ã–µ_–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã": list(AI_–ü–†–û–í–ê–ô–î–ï–†–´.keys()),
    }
    
    for key, value in –∑–Ω–∞—á–µ–Ω–∏—è.items():
        if key not in st.session_state:
            st.session_state[key] = value

# ============================================================================
# UI: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø - –ò–°–ü–†–ê–í–õ–ï–ù–û
# ============================================================================

def —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
    
    st.markdown(f'''<div style="text-align:center;padding:2.5rem 1rem;">
<div class="traffic-light" style="justify-content:center;margin-bottom:1rem;"><span class="tl-red"></span><span class="tl-yellow"></span><span class="tl-green"></span></div>
<h1 style="font-size:2rem;margin-bottom:0.5rem;color:#1e3a5f;">üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä</h1>
<p style="color:#666;margin-bottom:1.5rem;">–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ v7.2<br><strong>{–æ—Ä–≥.get("short_name", "–ê–û ¬´–°–ü–ö¬ª")}</strong></p>
</div>''', unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns([1, 2, 1])
    
    with col2:
        tab1, tab2 = st.tabs(["üë§ –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", "üîê –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"])
        
        # –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
        with tab1:
            with st.form("user_auth"):
                –∏–º—è = st.text_input("–§–ò–û *", placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á")
                –¥–æ–ª–∂–Ω–æ—Å—Ç—å = st.selectbox("–î–æ–ª–∂–Ω–æ—Å—Ç—å *", options=["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –î–û–õ–ñ–ù–û–°–¢–ò)
                –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ = st.selectbox("–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ *", options=["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø)
                
                col_a, col_b = st.columns(2)
                with col_a:
                    –≤–æ–π—Ç–∏ = st.form_submit_button("üöÄ –í–æ–π—Ç–∏", use_container_width=True, type="primary")
                with col_b:
                    –¥–µ–º–æ = st.form_submit_button("üìã –î–µ–º–æ-—Ä–µ–∂–∏–º", use_container_width=True)
                
                if –≤–æ–π—Ç–∏:
                    if –∏–º—è and len(–∏–º—è.strip()) >= 3 and –¥–æ–ª–∂–Ω–æ—Å—Ç—å != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî" and –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî":
                        st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                        st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": –∏–º—è.strip(), "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": –¥–æ–ª–∂–Ω–æ—Å—Ç—å, "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ}
                        st.session_state.—Ä–æ–ª—å = –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
                        st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º = False
                        st.rerun()
                    else:
                        st.error("‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è")
                
                if –¥–µ–º–æ:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–í–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"}
                    st.session_state.—Ä–æ–ª—å = –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
                    st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
                    st.rerun()
        
        # –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† - –ò–°–ü–†–ê–í–õ–ï–ù–û
        with tab2:
            with st.form("admin_auth"):
                –ª–æ–≥–∏–Ω = st.text_input("–õ–æ–≥–∏–Ω", placeholder="admin")
                –ø–∞—Ä–æ–ª—å = st.text_input("–ü–∞—Ä–æ–ª—å", type="password")
                
                col_c, col_d = st.columns(2)
                with col_c:
                    –≤–æ–π—Ç–∏_–∞–¥–º–∏–Ω = st.form_submit_button("üîê –í–æ–π—Ç–∏", use_container_width=True, type="primary")
                with col_d:
                    –¥–µ–º–æ_–∞–¥–º–∏–Ω = st.form_submit_button("üìã –î–µ–º–æ-–∞–¥–º–∏–Ω", use_container_width=True)
                
                if –≤–æ–π—Ç–∏_–∞–¥–º–∏–Ω:
                    if –ª–æ–≥–∏–Ω in –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:
                        –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞ = –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò[–ª–æ–≥–∏–Ω]
                        –≤–≤–µ–¥—ë–Ω–Ω—ã–π_—Ö–µ—à = hashlib.sha256(–ø–∞—Ä–æ–ª—å.encode()).hexdigest()
                        
                        if –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞["–ø–∞—Ä–æ–ª—å_—Ö–µ—à"] == –≤–≤–µ–¥—ë–Ω–Ω—ã–π_—Ö–µ—à:
                            if –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞["—Ä–æ–ª—å"] == –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
                                st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                                st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {
                                    "–∏–º—è": –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞["–∏–º—è"],
                                    "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞["–¥–æ–ª–∂–Ω–æ—Å—Ç—å"],
                                    "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": –¥–∞–Ω–Ω—ã–µ_—é–∑–µ—Ä–∞["–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ"]
                                }
                                st.session_state.—Ä–æ–ª—å = –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†
                                st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º = False
                                st.rerun()
                            else:
                                st.error("‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
                        else:
                            st.error("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å")
                    else:
                        st.error("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
                
                # –î–µ–º–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
                if –¥–µ–º–æ_–∞–¥–º–∏–Ω:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"}
                    st.session_state.—Ä–æ–ª—å = –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†
                    st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
                    st.rerun()
            
            st.caption("üí° –õ–æ–≥–∏–Ω: admin | –ü–∞—Ä–æ–ª—å: admin123")

# ============================================================================
# UI: –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨
# ============================================================================

def –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
    
    with st.sidebar:
        st.markdown("### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å")
        
        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        —Ä–æ–ª—å = st.session_state.—Ä–æ–ª—å
        
        if —Ä–æ–ª—å == –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
            badge_class = "admin-badge"
            badge_name = "–ê–î–ú–ò–ù"
        elif st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º:
            badge_class = "demo-badge"
            badge_name = "–î–ï–ú–û"
        else:
            badge_class = "user-badge"
            badge_name = "–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨"
        
        st.markdown(f"""
        <div style="background:#f8f9fa;padding:10px;border-radius:8px;margin-bottom:10px;">
            <strong>{–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å['–∏–º—è']}</strong><br>
            <small>{–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å['–¥–æ–ª–∂–Ω–æ—Å—Ç—å']}</small><br>
            <span class="{badge_class}">{badge_name}</span>
        </div>
        """, unsafe_allow_html=True)
        
        if st.button("üö™ –í—ã–π—Ç–∏", use_container_width=True):
            for key in list(st.session_state.keys()):
                del st.session_state[key]
            st.rerun()
        
        st.markdown("---")
        
        # –ü–æ—Ä–æ–≥–∏
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        st.markdown(f"""
        **–ü–æ—Ä–æ–≥–∏ –∑–æ–Ω:**
        - üü¢ –¢–§ ‚â§ {–ø–æ—Ä–æ–≥–∏.get('–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å', 100000):,.0f}‚ÇΩ
        - üü¢ –ò–Ω—ã–µ ‚â§ {–ø–æ—Ä–æ–≥–∏.get('–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å', 50000):,.0f}‚ÇΩ
        - üü° –¥–æ {–ø–æ—Ä–æ–≥–∏.get('–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å', 5000000):,.0f}‚ÇΩ
        - üî¥ > {–ø–æ—Ä–æ–≥–∏.get('–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å', 5000000):,.0f}‚ÇΩ
        """)
        
        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        if st.session_state.–∏—Å—Ç–æ—Ä–∏—è:
            st.markdown("---")
            st.markdown("**üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**")
            for –∑–∞–ø–∏—Å—å in st.session_state.–∏—Å—Ç–æ—Ä–∏—è[:3]:
                emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–∞–ø–∏—Å—å.get("–∑–æ–Ω–∞", ""), "‚ö™")
                st.caption(f"{emoji} {–∑–∞–ø–∏—Å—å.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '')[:20]} ({–∑–∞–ø–∏—Å—å.get('–¥–∞—Ç–∞', '')})")

# ============================================================================
# UI: –í–ö–õ–ê–î–ö–ê –ê–ù–ê–õ–ò–ó–ê - –ò–°–ü–†–ê–í–õ–ï–ù–û
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
    –¥–µ–º–æ = st.session_state.–¥–µ–º–æ_—Ä–µ–∂–∏–º
    
    st.markdown("### üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–≥–æ–≤–æ—Ä–∞")
    
    # –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ
    –¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ = –î–ï–ú–û_–î–ê–ù–ù–´–ï if –¥–µ–º–æ else {}
    
    col1, col2 = st.columns(2)
    
    with col1:
        –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç = st.text_input(
            "–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç *",
            value=–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç", ""),
            placeholder="–û–û–û ¬´–ù–∞–∑–≤–∞–Ω–∏–µ¬ª"
        )
        –Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞ = st.text_input(
            "–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞",
            value=–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞", ""),
            placeholder="2025/001"
        )
        –¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞ = st.date_input(
            "–î–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞",
            value=–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞", date.today())
        )
        
        # –¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞
        —Ç–∏–ø—ã = –¢–ò–ü–´_–î–û–ì–û–í–û–†–û–í
        idx_—Ç–∏–ø–∞ = 0
        if –¥–µ–º–æ and –¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞") in —Ç–∏–ø—ã:
            idx_—Ç–∏–ø–∞ = —Ç–∏–ø—ã.index(–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ["—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞"])
        —Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞ = st.selectbox("–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞", options=—Ç–∏–ø—ã, index=idx_—Ç–∏–ø–∞)
    
    with col2:
        # –°—É–º–º–∞
        —Å—É–º–º–∞_–¥–µ—Ñ–æ–ª—Ç = f"{–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0):,.0f}".replace(",", " ") if –¥–µ–º–æ and –¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("—Å—É–º–º–∞") else ""
        —Å—É–º–º–∞_str = st.text_input("–°—É–º–º–∞ (‚ÇΩ)", value=—Å—É–º–º–∞_–¥–µ—Ñ–æ–ª—Ç, placeholder="1 500 000")
        
        —Å—É–º–º–∞ = 0
        if —Å—É–º–º–∞_str:
            try:
                —Å—É–º–º–∞ = float(re.sub(r'[^\d.]', '', —Å—É–º–º–∞_str.replace(',', '.').replace(' ', '')))
            except:
                st.error("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞")
        
        # –§–æ—Ä–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        —Ñ–æ—Ä–º—ã = list(–§–æ—Ä–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞)
        idx_—Ñ–æ—Ä–º—ã = 0
        if –¥–µ–º–æ and –¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞"):
            try:
                idx_—Ñ–æ—Ä–º—ã = —Ñ–æ—Ä–º—ã.index(–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ["—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞"])
            except:
                pass
        —Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞ = st.selectbox(
            "–§–æ—Ä–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ *",
            options=—Ñ–æ—Ä–º—ã,
            format_func=lambda x: –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_—Ñ–æ—Ä–º—ã(x),
            index=idx_—Ñ–æ—Ä–º—ã
        )
        
        # –°—Ç–∞—Ç—É—Å –Æ–î
        —Å—Ç–∞—Ç—É—Å—ã = list(–°—Ç–∞—Ç—É—Å–Æ–î)
        idx_—Å—Ç–∞—Ç—É—Å–∞ = 0
        if –¥–µ–º–æ and –¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ.get("—Å—Ç–∞—Ç—É—Å_—é–¥"):
            try:
                idx_—Å—Ç–∞—Ç—É—Å–∞ = —Å—Ç–∞—Ç—É—Å—ã.index(–¥–µ–º–æ_–¥–∞–Ω–Ω—ã–µ["—Å—Ç–∞—Ç—É—Å_—é–¥"])
            except:
                pass
        —Å—Ç–∞—Ç—É—Å_—é–¥ = st.selectbox(
            "–°—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –Æ–î",
            options=—Å—Ç–∞—Ç—É—Å—ã,
            format_func=lambda x: –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_—Å—Ç–∞—Ç—É—Å–∞(x),
            index=idx_—Å—Ç–∞—Ç—É—Å–∞
        )
        
        # –¢–∏–ø —Å–¥–µ–ª–∫–∏
        –æ–ø—Ü–∏–∏_—Å–¥–µ–ª–∫–∏ = ["‚Äî –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ ‚Äî"] + –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê + –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´
        —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = st.selectbox("–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø —Å–¥–µ–ª–∫–∏", options=–æ–ø—Ü–∏–∏_—Å–¥–µ–ª–∫–∏)
        if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ == "‚Äî –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ ‚Äî":
            —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = ""
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
    with st.expander("üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"):
        col_a, col_b = st.columns(2)
        with col_a:
            –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π_–ø–æ—Å—Ç–∞–≤—â–∏–∫ = st.checkbox("–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫")
            —Ç–µ–Ω–¥–µ—Ä = st.checkbox("–¢–µ–Ω–¥–µ—Ä/–∫–æ–Ω–∫—É—Ä—Å")
        with col_b:
            —Å—Ä–æ–∫_–ª–µ—Ç = st.number_input("–°—Ä–æ–∫ –¥–æ–≥–æ–≤–æ—Ä–∞ (–ª–µ—Ç)", min_value=0, max_value=50, value=0)
            –∏–∑–º–µ–Ω–µ–Ω–∏—è_—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ = st.checkbox("–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –¢–§")
        
        —Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞ = 0
        if —Ç–µ–Ω–¥–µ—Ä:
            —Ç–µ–Ω–¥–µ—Ä_str = st.text_input("–°—É–º–º–∞ —Ç–µ–Ω–¥–µ—Ä–∞ (‚ÇΩ)")
            if —Ç–µ–Ω–¥–µ—Ä_str:
                try:
                    —Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞ = float(re.sub(r'[^\d.]', '', —Ç–µ–Ω–¥–µ—Ä_str))
                except:
                    pass
    
    st.markdown("---")
    
    # –ö–Ω–æ–ø–∫–∏
    col_btn1, col_btn2, col_btn3 = st.columns(3)
    
    with col_btn1:
        –∫–Ω–æ–ø–∫–∞_–∑–æ–Ω—ã = st.button("üö¶ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–æ–Ω—É", type="primary", use_container_width=True)
    with col_btn2:
        if –¥–µ–º–æ:
            st.caption("‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        else:
            –∑–∞–≥—Ä—É–∑–∏—Ç—å_–¥–µ–º–æ = st.button("üìù –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ", use_container_width=True)
            if –∑–∞–≥—Ä—É–∑–∏—Ç—å_–¥–µ–º–æ:
                st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
                st.rerun()
    with col_btn3:
        –æ—á–∏—Å—Ç–∏—Ç—å = st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å", use_container_width=True)
        if –æ—á–∏—Å—Ç–∏—Ç—å:
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã = None
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞ = None
            st.session_state.ai_–∞–Ω–∞–ª–∏–∑ = ""
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = ""
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω—ã
    if –∫–Ω–æ–ø–∫–∞_–∑–æ–Ω—ã:
        –≤—Ö–æ–¥ = –í—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ(
            —Å—É–º–º–∞=—Å—É–º–º–∞, —Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞=—Ñ–æ—Ä–º–∞_–¥–æ–∫—É–º–µ–Ω—Ç–∞, —Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞=—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞,
            —Ç–∏–ø_—Å–¥–µ–ª–∫–∏=—Ç–∏–ø_—Å–¥–µ–ª–∫–∏, —Å—Ç–∞—Ç—É—Å_—é–¥=—Å—Ç–∞—Ç—É—Å_—é–¥, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π_–ø–æ—Å—Ç–∞–≤—â–∏–∫=–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π_–ø–æ—Å—Ç–∞–≤—â–∏–∫,
            —Ç–µ–Ω–¥–µ—Ä=—Ç–µ–Ω–¥–µ—Ä, —Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞=—Å—É–º–º–∞_—Ç–µ–Ω–¥–µ—Ä–∞, —Å—Ä–æ–∫_–ª–µ—Ç=—Å—Ä–æ–∫_–ª–µ—Ç,
            –∏–∑–º–µ–Ω–µ–Ω–∏—è_—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ=–∏–∑–º–µ–Ω–µ–Ω–∏—è_—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç=–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç,
            –Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞=–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞, –¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞=str(–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞)
        )
        st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã = –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(–≤—Ö–æ–¥, st.session_state.get("–ø–æ—Ä–æ–≥–∏"))
        st.session_state.—Ç–µ–∫—É—â–∏–π_–≤–≤–æ–¥ = –≤—Ö–æ–¥
        st.rerun()
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–æ–Ω—ã
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã:
        —Ä–µ–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã
        
        –Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–∑–æ–Ω—ã = {
            –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ó–ï–õ–Å–ù–ê–Ø: ("–∑–µ–ª—ë–Ω–∞—è", "üü¢ –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê", "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ"),
            –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ñ–Å–õ–¢–ê–Ø: ("–∂—ë–ª—Ç–∞—è", "üü° –ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê", "–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –Æ–î"),
            –ó–æ–Ω–∞–†–∏—Å–∫–∞.–ö–†–ê–°–ù–ê–Ø: ("–∫—Ä–∞—Å–Ω–∞—è", "üî¥ –ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê", "–ü–æ–ª–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –Æ–î"),
        }
        –∫–ª–∞—Å—Å_–∑–æ–Ω—ã, –Ω–∞–∑–≤–∞–Ω–∏–µ_–∑–æ–Ω—ã, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ = –Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–∑–æ–Ω—ã.get(—Ä–µ–∑.–∑–æ–Ω–∞, ("–∑–µ–ª—ë–Ω–∞—è", "‚ö™ –ù/–î", ""))
        
        st.markdown(f'''
        <div class="zone-card {–∫–ª–∞—Å—Å_–∑–æ–Ω—ã}">
            <div class="zone-title">{–Ω–∞–∑–≤–∞–Ω–∏–µ_–∑–æ–Ω—ã}</div>
            <div style="font-size:0.95rem;color:#555;">{–ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫}</div>
            <div style="margin-top:0.5rem;font-size:0.9rem;">{—Ä–µ–∑.–ø—Ä–∏—á–∏–Ω–∞}</div>
        </div>
        ''', unsafe_allow_html=True)
        
        col_m1, col_m2, col_m3 = st.columns(3)
        with col_m1:
            st.metric("üí∞ –°—É–º–º–∞", f"{—Å—É–º–º–∞:,.0f} ‚ÇΩ".replace(",", " "))
        with col_m2:
            st.metric("‚è±Ô∏è –°—Ä–æ–∫", f"{—Ä–µ–∑.—Å—Ä–æ–∫_–¥–Ω–µ–π} –¥–Ω." if —Ä–µ–∑.—Å—Ä–æ–∫_–¥–Ω–µ–π else "‚Äî")
        with col_m3:
            st.metric("‚öñÔ∏è –Æ–î", "–î–∞" if —Ä–µ–∑.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥ else "–ù–µ—Ç")
        
        if —Ä–µ–∑.–º–∞—Ä—à—Ä—É—Ç:
            st.info("üìç " + " ‚Üí ".join(—Ä–µ–∑.–º–∞—Ä—à—Ä—É—Ç))
        
        for –ø—Ä–µ–¥—É–ø—Ä in —Ä–µ–∑.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
            st.warning(–ø—Ä–µ–¥—É–ø—Ä)
        
        st.markdown(f"**–°—Ç–∞—Ç—É—Å:** {–ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_—Å—Ç–∞—Ç—É—Å–∞(—Å—Ç–∞—Ç—É—Å_—é–¥)}")
    
    st.markdown("---")
    
    # ============================================
    # –ó–ê–ì–†–£–ó–ö–ê –¢–ï–ö–°–¢–ê –î–û–ì–û–í–û–†–ê - –ò–°–ü–†–ê–í–õ–ï–ù–û
    # ============================================
    st.markdown("### üìÑ –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞")
    st.info("üí° –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª **–ò–õ–ò** –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é (–Ω–µ –æ–±–∞ —Å–ø–æ—Å–æ–±–∞)")
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
    —Ñ–∞–π–ª = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (DOCX, PDF, TXT)", type=["txt", "docx", "pdf"], key="file_uploader")
    
    if —Ñ–∞–π–ª:
        —É—Å–ø–µ—Ö, —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –ó–∞–≥—Ä—É–∑—á–∏–∫–î–æ–∫—É–º–µ–Ω—Ç–æ–≤.–∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(—Ñ–∞–π–ª)
        if —É—Å–ø–µ—Ö:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç[:500000]
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = True
            st.success(f"‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: {len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞):,} —Å–∏–º–≤–æ–ª–æ–≤")
        else:
            st.error(—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
    
    # –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ñ–∞–π–ª –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω
    if not st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω:
        —Ç–µ–∫—Å—Ç_–ø–æ_—É–º–æ–ª—á–∞–Ω–∏—é = st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ if –¥–µ–º–æ else ""
        —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = st.text_area(
            "–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é:",
            value=—Ç–µ–∫—Å—Ç_–ø–æ_—É–º–æ–ª—á–∞–Ω–∏—é,
            height=200,
            placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤)...",
            key="text_input"
        )
        
        if —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ != st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞
    else:
        st.info(f"üìÑ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª ({len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞):,} —Å–∏–º–≤–æ–ª–æ–≤)")
        if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª"):
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = ""
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    # –í—ã–±–æ—Ä —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã
    –≤—Å–µ_—Ç—Ñ = {**–í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´, **st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ}
    
    # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    –∞–≤—Ç–æ_—Ç—Ñ = None
    –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å = 0
    if st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ and len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) > 100:
        –∞–≤—Ç–æ_—Ç—Ñ, –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∞–≤—Ç–æ_–ø—Ä–∏—á–∏–Ω–∞ = –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–î–æ–≥–æ–≤–æ—Ä–æ–≤.–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞)
        if –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å >= 0.4 and –∞–≤—Ç–æ_—Ç—Ñ:
            st.info(f"üîç –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: **{–≤—Å–µ_—Ç—Ñ[–∞–≤—Ç–æ_—Ç—Ñ]['–Ω–∞–∑–≤–∞–Ω–∏–µ']}** (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {–∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å*100:.0f}%)")
    
    –æ–ø—Ü–∏–∏_—Ç—Ñ = [("‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É ‚Äî", None)]
    –æ–ø—Ü–∏–∏_—Ç—Ñ += [(f"{v['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({v['–∫–æ–¥']})", k) for k, v in –≤—Å–µ_—Ç—Ñ.items()]
    
    idx_—Ç—Ñ = 0
    if –∞–≤—Ç–æ_—Ç—Ñ and –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å >= 0.4:
        for i, (_, k) in enumerate(–æ–ø—Ü–∏–∏_—Ç—Ñ):
            if k == –∞–≤—Ç–æ_—Ç—Ñ:
                idx_—Ç—Ñ = i
                break
    
    –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ = st.selectbox(
        "–°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–æ–π:",
        options=–æ–ø—Ü–∏–∏_—Ç—Ñ,
        format_func=lambda x: x[0],
        index=idx_—Ç—Ñ
    )[1]
    
    # –ö–Ω–æ–ø–∫–∏ –∞–Ω–∞–ª–∏–∑–∞
    st.markdown("---")
    col_an1, col_an2 = st.columns(2)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞
    api_–∫–ª—é—á–∏ = st.session_state.get("api_–∫–ª—é—á–∏", {})
    –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ = st.session_state.get("–≤–∫–ª—é—á—ë–Ω–Ω—ã–µ_–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã", [])
    –µ—Å—Ç—å_–∫–ª—é—á = any(api_–∫–ª—é—á–∏.get(p) for p in –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ)
    
    with col_an1:
        –∫–Ω–æ–ø–∫–∞_—Å—Ä–∞–≤–Ω–µ–Ω–∏—è = st.button("üîç –°—Ä–∞–≤–Ω–∏—Ç—å —Å –¢–§", type="primary", use_container_width=True)
    
    with col_an2:
        –∫–Ω–æ–ø–∫–∞_ai = st.button(
            "ü§ñ AI-–∞–Ω–∞–ª–∏–∑" + ("" if –µ—Å—Ç—å_–∫–ª—é—á else " (–Ω–µ—Ç –∫–ª—é—á–∞)"),
            use_container_width=True,
            disabled=not –µ—Å—Ç—å_–∫–ª—é—á
        )
        if not –µ—Å—Ç—å_–∫–ª—é—á and st.session_state.—Ä–æ–ª—å == –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
            st.caption("üí° –î–æ–±–∞–≤—å—Ç–µ API-–∫–ª—é—á –≤ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑
    if –∫–Ω–æ–ø–∫–∞_—Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
        –æ—à–∏–±–∫–∏ = []
        if not –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç or len(–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç) < 2:
            –æ—à–∏–±–∫–∏.append("–£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞")
        if not st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ or len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) < 100:
            –æ—à–∏–±–∫–∏.append("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (–º–∏–Ω. 100 —Å–∏–º–≤–æ–ª–æ–≤)")
        if not –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ:
            –æ—à–∏–±–∫–∏.append("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É")
        
        if –æ—à–∏–±–∫–∏:
            for –æ in –æ—à–∏–±–∫–∏:
                st.error(f"‚ùå {–æ}")
        else:
            with st.spinner("üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º..."):
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–î–æ–≥–æ–≤–æ—Ä–æ–≤.–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ)
                st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            st.rerun()
    
    # AI –∞–Ω–∞–ª–∏–∑
    if –∫–Ω–æ–ø–∫–∞_ai:
        if not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞:
            st.warning("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¢–§")
        elif len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) < 100:
            st.error("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞")
        else:
            # –ù–∞—Ö–æ–¥–∏–º —Ä–∞–±–æ—á–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
            –ø—Ä–æ–≤–∞–π–¥–µ—Ä = None
            –∫–ª—é—á = ""
            for p in –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ:
                if api_–∫–ª—é—á–∏.get(p):
                    –ø—Ä–æ–≤–∞–π–¥–µ—Ä = p
                    –∫–ª—é—á = api_–∫–ª—é—á–∏[p]
                    break
            
            if –ø—Ä–æ–≤–∞–π–¥–µ—Ä:
                with st.spinner(f"ü§ñ {AI_–ü–†–û–í–ê–ô–î–ï–†–´[–ø—Ä–æ–≤–∞–π–¥–µ—Ä]['–Ω–∞–∑–≤–∞–Ω–∏–µ']} –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç..."):
                    –ø—Ä–æ–º–ø—Ç = AI–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.—Å–æ–∑–¥–∞—Ç—å_–ø—Ä–æ–º–ø—Ç(
                        st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞,
                        st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞,
                        –æ—Ä–≥.get("short_name", "–ê–û ¬´–°–ü–ö¬ª")
                    )
                    folder_id = st.session_state.get("yandex_folder_id", "") if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "yandexgpt" else ""
                    —É—Å–ø–µ—Ö, —Ä–µ–∑—É–ª—å—Ç–∞—Ç = AI–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.–≤—ã–∑–≤–∞—Ç—å_ai(–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –ø—Ä–æ–º–ø—Ç, –∫–ª—é—á, folder_id)
                    
                    if —É—Å–ø–µ—Ö:
                        st.session_state.ai_–∞–Ω–∞–ª–∏–∑ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        st.rerun()
                    else:
                        st.error(f"‚ùå {—Ä–µ–∑—É–ª—å—Ç–∞—Ç}")
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞:
        –ø–æ–∫–∞–∑–∞—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_–∞–Ω–∞–ª–∏–∑–∞(st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞)
    
    if st.session_state.ai_–∞–Ω–∞–ª–∏–∑:
        st.markdown("---")
        st.markdown("### ü§ñ –≠–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ AI")
        st.markdown(f'<div style="background:#e8f4f8;border:1px solid #b8d4e3;border-radius:8px;padding:15px;white-space:pre-wrap;">{st.session_state.ai_–∞–Ω–∞–ª–∏–∑}</div>', unsafe_allow_html=True)


def –ø–æ–∫–∞–∑–∞—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_–∞–Ω–∞–ª–∏–∑–∞(—Ä–µ–∑—É–ª—å—Ç–∞—Ç: Dict):
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞"""
    st.markdown("---")
    st.markdown(f"### üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: {—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ', '')}")
    
    —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0)
    —ç—Ç–æ_—Ç—Ñ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞', False)
    
    if —ç—Ç–æ_—Ç—Ñ:
        —Ü–≤–µ—Ç = "#28a745"
        –±–µ–π–¥–∂ = "‚úÖ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ –¢–§"
    elif —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ >= 50:
        —Ü–≤–µ—Ç = "#ffc107"
        –±–µ–π–¥–∂ = "‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï"
    else:
        —Ü–≤–µ—Ç = "#dc3545"
        –±–µ–π–¥–∂ = "‚ùå –ó–ù–ê–ß–ò–¢–ï–õ–¨–ù–´–ï –û–¢–ö–õ–û–ù–ï–ù–ò–Ø"
    
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.markdown(f'<div class="metric-card"><div class="metric-value" style="color:{—Ü–≤–µ—Ç};">{—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:.0f}%</div><div class="metric-label">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§</div></div>', unsafe_allow_html=True)
    with col2:
        st.markdown(f'<div class="metric-card"><div class="metric-value" style="color:#28a745;">{len(—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get("–Ω–∞–π–¥–µ–Ω–Ω—ã–µ_—Ä–∞–∑–¥–µ–ª—ã", []))}</div><div class="metric-label">–ù–∞–π–¥–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤</div></div>', unsafe_allow_html=True)
    with col3:
        –∫—Ä–∞—Å–Ω—ã—Ö = sum(1 for r in —Ä–µ–∑—É–ª—å—Ç–∞—Ç.get("—Ä–∏—Å–∫–∏", []) if r.get("—É—Ä–æ–≤–µ–Ω—å") == "–∫—Ä–∞—Å–Ω—ã–π")
        st.markdown(f'<div class="metric-card"><div class="metric-value" style="color:#dc3545;">{–∫—Ä–∞—Å–Ω—ã—Ö}</div><div class="metric-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö</div></div>', unsafe_allow_html=True)
    with col4:
        –∂—ë–ª—Ç—ã—Ö = sum(1 for r in —Ä–µ–∑—É–ª—å—Ç–∞—Ç.get("—Ä–∏—Å–∫–∏", []) if r.get("—É—Ä–æ–≤–µ–Ω—å") == "–∂—ë–ª—Ç—ã–π")
        st.markdown(f'<div class="metric-card"><div class="metric-value" style="color:#ffc107;">{–∂—ë–ª—Ç—ã—Ö}</div><div class="metric-label">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</div></div>', unsafe_allow_html=True)
    
    st.markdown(f"**{–±–µ–π–¥–∂}**")
    st.markdown(—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('—Ä–µ–∑—é–º–µ', ''))
    
    # –†–∏—Å–∫–∏
    –¥–µ—Ç–∞–ª–∏ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤', [])
    –∫—Ä–∞—Å–Ω—ã–µ = [r for r in –¥–µ—Ç–∞–ª–∏ if '–ö–†–ò–¢–ò–ß–ù–û' in r.get('—É—Ä–æ–≤–µ–Ω—å', '')]
    –∂—ë–ª—Ç—ã–µ = [r for r in –¥–µ—Ç–∞–ª–∏ if '–í–ù–ò–ú–ê–ù–ò–ï' in r.get('—É—Ä–æ–≤–µ–Ω—å', '')]
    
    if –∫—Ä–∞—Å–Ω—ã–µ:
        with st.expander(f"üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò ({len(–∫—Ä–∞—Å–Ω—ã–µ)})", expanded=True):
            for r in –∫—Ä–∞—Å–Ω—ã–µ:
                st.markdown(f'''
                <div class="risk-item red">
                    <strong>‚ö†Ô∏è {r.get("–ø—Ä–æ–±–ª–µ–º–∞", "")}</strong>
                    <div style="margin-top:8px;font-size:0.9rem;color:#666;">{r.get("–∫–æ–Ω—Ç–µ–∫—Å—Ç", "")[:250]}</div>
                    <div style="margin-top:8px;padding:8px;background:#fff;border-radius:4px;">
                        <strong>‚û°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> {r.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "")}
                    </div>
                </div>
                ''', unsafe_allow_html=True)
    
    if –∂—ë–ª—Ç—ã–µ:
        with st.expander(f"üü° –¢–†–ï–ë–£–Æ–¢ –í–ù–ò–ú–ê–ù–ò–Ø ({len(–∂—ë–ª—Ç—ã–µ)})"):
            for r in –∂—ë–ª—Ç—ã–µ:
                st.markdown(f'''
                <div class="risk-item yellow">
                    <strong>‚ö° {r.get("–ø—Ä–æ–±–ª–µ–º–∞", "")}</strong>
                    <div style="margin-top:5px;font-size:0.85rem;">‚û°Ô∏è {r.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "")}</div>
                </div>
                ''', unsafe_allow_html=True)

# ============================================================================
# UI: –í–ö–õ–ê–î–ö–ê –û–¢–ß–Å–¢–û–í
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
    
    st.markdown("### üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤")
    
    if not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞ and not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã:
        st.info("‚ÑπÔ∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞")
        return
    
    –≤—Ö–æ–¥ = st.session_state.get('—Ç–µ–∫—É—â–∏–π_–≤–≤–æ–¥') or –í—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ()
    –∞–Ω–∞–ª–∏–∑ = st.session_state.get('—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞') or {}
    
    # –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞
    –¥–∞–Ω–Ω—ã–µ = {
        "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –≤—Ö–æ–¥.–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç or "–ù–µ —É–∫–∞–∑–∞–Ω",
        "–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞": –≤—Ö–æ–¥.–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞ or "–ù–µ —É–∫–∞–∑–∞–Ω",
        "–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞": str(–≤—Ö–æ–¥.–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞) if –≤—Ö–æ–¥.–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞ else "",
        "—Å—É–º–º–∞": –≤—Ö–æ–¥.—Å—É–º–º–∞ or 0,
        "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": –∞–Ω–∞–ª–∏–∑.get("—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ", 0),
        "–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤": –∞–Ω–∞–ª–∏–∑.get("–¥–µ—Ç–∞–ª–∏_—Ä–∏—Å–∫–æ–≤", []),
        "—Ä–∏—Å–∫–∏": –∞–Ω–∞–ª–∏–∑.get("—Ä–∏—Å–∫–∏", []),
        "—Ä–µ–∑—é–º–µ": –∞–Ω–∞–ª–∏–∑.get("—Ä–µ–∑—é–º–µ", ""),
    }
    
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã:
        —Ä–µ–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã
        –¥–∞–Ω–Ω—ã–µ.update({
            "–∑–æ–Ω–∞": —Ä–µ–∑.–∑–æ–Ω–∞.value if —Ä–µ–∑.–∑–æ–Ω–∞ else "",
            "–ø—Ä–∏—á–∏–Ω–∞": —Ä–µ–∑.–ø—Ä–∏—á–∏–Ω–∞ or "",
            "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": —Ä–µ–∑.—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥,
            "—Å—Ä–æ–∫_–¥–Ω–µ–π": —Ä–µ–∑.—Å—Ä–æ–∫_–¥–Ω–µ–π or 0,
        })
    
    # –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
    –∑–æ–Ω–∞ = –¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", "")
    –∫—Ä–∞—Å–Ω—ã—Ö = sum(1 for r in –¥–∞–Ω–Ω—ã–µ.get('—Ä–∏—Å–∫–∏', []) if r.get('—É—Ä–æ–≤–µ–Ω—å') == '–∫—Ä–∞—Å–Ω—ã–π')
    
    if –∑–æ–Ω–∞ == "–∫—Ä–∞—Å–Ω–∞—è" or –∫—Ä–∞—Å–Ω—ã—Ö >= 3:
        –¥–∞–Ω–Ω—ã–µ["–∑–∞–∫–ª—é—á–µ–Ω–∏–µ"] = "‚ùå –î–æ–≥–æ–≤–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞."
    elif –∑–æ–Ω–∞ == "–∂—ë–ª—Ç–∞—è" or –∫—Ä–∞—Å–Ω—ã—Ö >= 1:
        –¥–∞–Ω–Ω—ã–µ["–∑–∞–∫–ª—é—á–µ–Ω–∏–µ"] = "‚ö†Ô∏è –î–æ–≥–æ–≤–æ—Ä —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Å –Æ–î."
    else:
        –¥–∞–Ω–Ω—ã–µ["–∑–∞–∫–ª—é—á–µ–Ω–∏–µ"] = f"‚úÖ –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§: {–¥–∞–Ω–Ω—ã–µ.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.0f}%."
    
    # –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    emoji_–∑–æ–Ω—ã = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–æ–Ω–∞, "‚ö™")
    
    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"**–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:** {–¥–∞–Ω–Ω—ã–µ['–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç']}")
        st.markdown(f"**–ù–æ–º–µ—Ä:** {–¥–∞–Ω–Ω—ã–µ['–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞']}")
    with col2:
        st.markdown(f"**–ó–æ–Ω–∞:** {emoji_–∑–æ–Ω—ã} {–ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç–∫—É_–∑–æ–Ω—ã(–∑–æ–Ω–∞)}")
        st.markdown(f"**–°—É–º–º–∞:** {–¥–∞–Ω–Ω—ã–µ['—Å—É–º–º–∞']:,.0f} ‚ÇΩ")
    
    st.markdown("---")
    
    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
    col1, col2 = st.columns(2)
    
    with col1:
        —Ç–µ–∫—Å—Ç = –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–û—Ç—á—ë—Ç–æ–≤.—Ç–µ–∫—Å—Ç–æ–≤—ã–π_–æ—Ç—á—ë—Ç(–¥–∞–Ω–Ω—ã–µ, st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ—Ä–≥, st.session_state.ai_–∞–Ω–∞–ª–∏–∑)
        st.download_button("üì• –°–∫–∞—á–∞—Ç—å TXT", —Ç–µ–∫—Å—Ç.encode('utf-8'), f"–æ—Ç—á—ë—Ç_{–¥–∞–Ω–Ω—ã–µ['–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞']}.txt", "text/plain", use_container_width=True)
    
    with col2:
        json_–¥–∞–Ω–Ω—ã–µ = json.dumps(–¥–∞–Ω–Ω—ã–µ, ensure_ascii=False, indent=2, default=str)
        st.download_button("üì• –°–∫–∞—á–∞—Ç—å JSON", json_–¥–∞–Ω–Ω—ã–µ.encode('utf-8'), f"–æ—Ç—á—ë—Ç_{–¥–∞–Ω–Ω—ã–µ['–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞']}.json", "application/json", use_container_width=True)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
    if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é", use_container_width=True):
        –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é(–¥–∞–Ω–Ω—ã–µ)
        st.success("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏—é!")
    
    with st.expander("üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞"):
        st.text(—Ç–µ–∫—Å—Ç)

# ============================================================================
# UI: –í–ö–õ–ê–î–ö–ê –ò–°–¢–û–†–ò–ò - –ò–°–ü–†–ê–í–õ–ï–ù–û
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏():
    st.markdown("### üìú –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫")
    
    if not st.session_state.–∏—Å—Ç–æ—Ä–∏—è:
        st.info("‚ÑπÔ∏è –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—É—Å—Ç–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.")
        return
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    –≤—Å–µ–≥–æ = len(st.session_state.–∏—Å—Ç–æ—Ä–∏—è)
    –∑–µ–ª—ë–Ω—ã—Ö = sum(1 for h in st.session_state.–∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∑–µ–ª—ë–Ω–∞—è')
    –∂—ë–ª—Ç—ã—Ö = sum(1 for h in st.session_state.–∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∂—ë–ª—Ç–∞—è')
    –∫—Ä–∞—Å–Ω—ã—Ö = sum(1 for h in st.session_state.–∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∫—Ä–∞—Å–Ω–∞—è')
    
    col1, col2, col3, col4 = st.columns(4)
    col1.metric("üìä –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫", –≤—Å–µ–≥–æ)
    col2.metric("üü¢ –ó–µ–ª—ë–Ω—ã—Ö", –∑–µ–ª—ë–Ω—ã—Ö)
    col3.metric("üü° –ñ—ë–ª—Ç—ã—Ö", –∂—ë–ª—Ç—ã—Ö)
    col4.metric("üî¥ –ö—Ä–∞—Å–Ω—ã—Ö", –∫—Ä–∞—Å–Ω—ã—Ö)
    
    st.markdown("---")
    
    # –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏
    st.markdown("#### üìã –ñ—É—Ä–Ω–∞–ª –ø—Ä–æ–≤–µ—Ä–æ–∫")
    
    for –∑–∞–ø–∏—Å—å in st.session_state.–∏—Å—Ç–æ—Ä–∏—è:
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–∞–ø–∏—Å—å.get("–∑–æ–Ω–∞", ""), "‚ö™")
        
        with st.expander(f"{emoji} {–∑–∞–ø–∏—Å—å.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ù/–î')} | ‚Ññ {–∑–∞–ø–∏—Å—å.get('–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞', '–ù/–î')} | {–∑–∞–ø–∏—Å—å.get('–¥–∞—Ç–∞', '')}"):
            col_a, col_b = st.columns(2)
            
            with col_a:
                st.markdown(f"""
                **–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** {–∑–∞–ø–∏—Å—å.get('–¥–∞—Ç–∞_–≤—Ä–µ–º—è', '')}  
                **–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:** {–∑–∞–ø–∏—Å—å.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '')}  
                **–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞:** {–∑–∞–ø–∏—Å—å.get('–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞', '')}  
                **–°—É–º–º–∞:** {–∑–∞–ø–∏—Å—å.get('—Å—É–º–º–∞', 0):,.0f} ‚ÇΩ
                """)
            
            with col_b:
                st.markdown(f"""
                **–ó–æ–Ω–∞ —Ä–∏—Å–∫–∞:** {–∑–∞–ø–∏—Å—å.get('–∑–æ–Ω–∞_–Ω–∞–∑–≤–∞–Ω–∏–µ', '')}  
                **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§:** {–∑–∞–ø–∏—Å—å.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.0f}%  
                **–¢—Ä–µ–±—É–µ—Ç—Å—è –Æ–î:** {'–î–∞' if –∑–∞–ø–∏—Å—å.get('—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥') else '–ù–µ—Ç'}  
                **–ü—Ä–æ–≤–µ—Ä–∏–ª:** {–∑–∞–ø–∏—Å—å.get('–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', '')}
                """)
    
    st.markdown("---")
    
    if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é"):
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
        st.rerun()

# ============================================================================
# UI: –ù–ê–°–¢–†–û–ô–ö–ò (–¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê)
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –¢–û–õ–¨–ö–û –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    
    if st.session_state.—Ä–æ–ª—å != –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
        st.error("üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        st.info("‚ÑπÔ∏è –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫.")
        return
    
    st.markdown("### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã")
    st.success("üîì –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã.")
    
    tabs = st.tabs(["üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "üìä –ü–æ—Ä–æ–≥–∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞", "üîë API-–∫–ª—é—á–∏", "üìÇ –¢–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã"])
    
    # ==========================================
    # –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø
    # ==========================================
    with tabs[0]:
        st.markdown("#### üè¢ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏")
        
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
        
        col1, col2 = st.columns(2)
        with col1:
            –Ω–æ–≤–æ–µ_–ø–æ–ª–Ω–æ–µ = st.text_input("–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("full_name", ""))
            –Ω–æ–≤–æ–µ_–∫—Ä–∞—Ç–∫–æ–µ = st.text_input("–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("short_name", ""))
            –Ω–æ–≤—ã–π_–∏–Ω–Ω = st.text_input("–ò–ù–ù", value=–æ—Ä–≥.get("inn", ""))
        with col2:
            –Ω–æ–≤—ã–π_–¥–∏—Ä–µ–∫—Ç–æ—Ä = st.text_input("–§–ò–û —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è", value=–æ—Ä–≥.get("director_name", ""))
            –Ω–æ–≤–∞—è_–¥–æ–ª–∂–Ω–æ—Å—Ç—å = st.text_input("–î–æ–ª–∂–Ω–æ—Å—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è", value=–æ—Ä–≥.get("director_position", ""))
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã", key="save_org"):
            st.session_state.–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏.update({
                "full_name": –Ω–æ–≤–æ–µ_–ø–æ–ª–Ω–æ–µ,
                "short_name": –Ω–æ–≤–æ–µ_–∫—Ä–∞—Ç–∫–æ–µ,
                "inn": –Ω–æ–≤—ã–π_–∏–Ω–Ω,
                "director_name": –Ω–æ–≤—ã–π_–¥–∏—Ä–µ–∫—Ç–æ—Ä,
                "director_position": –Ω–æ–≤–∞—è_–¥–æ–ª–∂–Ω–æ—Å—Ç—å
            })
            st.success("‚úÖ –†–µ–∫–≤–∏–∑–∏—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
    
    # ==========================================
    # –ü–û–†–û–ì–ò –†–ï–ì–õ–ê–ú–ï–ù–¢–ê - –ò–°–ü–†–ê–í–õ–ï–ù–û
    # ==========================================
    with tabs[1]:
        st.markdown("#### üìä –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞")
        st.info("‚ÑπÔ∏è –ò–∑–º–µ–Ω–∏—Ç–µ —Å—É–º–º—ã –µ—Å–ª–∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è")
        
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        
        st.markdown("**üü¢ –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ):**")
        col1, col2 = st.columns(2)
        with col1:
            –Ω–æ–≤—ã–π_—Ç—Ñ_–º–∞–∫—Å = st.number_input(
                "–ú–∞–∫—Å. —Å—É–º–º–∞ –¥–ª—è —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã (‚ÇΩ)",
                value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100000),
                min_value=0, max_value=10_000_000, step=10000,
                help="–î–æ —ç—Ç–æ–π —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä –ø–æ –¢–§ –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ"
            )
        with col2:
            –Ω–æ–≤—ã–π_–Ω–µ—Ç—Ñ_–º–∞–∫—Å = st.number_input(
                "–ú–∞–∫—Å. —Å—É–º–º–∞ –¥–ª—è –Ω–µ—Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã (‚ÇΩ)",
                value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50000),
                min_value=0, max_value=10_000_000, step=10000,
                help="–î–æ —ç—Ç–æ–π —Å—É–º–º—ã –Ω–µ—Ç–∏–ø–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ"
            )
        
        st.markdown("**üü° –ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –Æ–î):**")
        –Ω–æ–≤—ã–π_–∂—ë–ª—Ç—ã–π_–º–∞–∫—Å = st.number_input(
            "–ú–∞–∫—Å. —Å—É–º–º–∞ –∂—ë–ª—Ç–æ–π –∑–æ–Ω—ã (‚ÇΩ)",
            value=–ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5_000_000),
            min_value=0, max_value=100_000_000, step=100000,
            help="–î–æ–≥–æ–≤–æ—Ä—ã —Å–≤—ã—à–µ —ç—Ç–æ–π —Å—É–º–º—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ö–†–ê–°–ù–£–Æ –∑–æ–Ω—É"
        )
        
        st.markdown("**üî¥ –ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê (–æ—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è):**")
        col3, col4 = st.columns(2)
        with col3:
            –Ω–æ–≤—ã–π_—Ç–µ–Ω–¥–µ—Ä = st.number_input(
                "–¢–µ–Ω–¥–µ—Ä ‚Üí –∫—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ –æ—Ç (‚ÇΩ)",
                value=–ø–æ—Ä–æ–≥–∏.get("—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è", 3_000_000),
                min_value=0, max_value=50_000_000, step=100000
            )
        with col4:
            –Ω–æ–≤—ã–π_–µ–¥–∏–Ω—Å—Ç–≤ = st.number_input(
                "–ï–¥–∏–Ω—Å—Ç–≤. –ø–æ—Å—Ç–∞–≤—â–∏–∫ ‚Üí –∂—ë–ª—Ç–∞—è –æ—Ç (‚ÇΩ)",
                value=–ø–æ—Ä–æ–≥–∏.get("–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫", 100_000),
                min_value=0, max_value=5_000_000, step=10000
            )
        
        st.markdown("**‚è±Ô∏è –°—Ä–æ–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (—Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π):**")
        —Å—Ä–æ–∫–∏ = st.session_state.get("—Å—Ä–æ–∫–∏", DEFAULT_DEADLINES)
        col5, col6, col7 = st.columns(3)
        with col5:
            –Ω–æ–≤—ã–π_—Å—Ç–∞–Ω–¥–∞—Ä—Ç = st.number_input("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", 5), min_value=1, max_value=30)
        with col6:
            –Ω–æ–≤—ã–π_—Ä–∞—Å—à–∏—Ä–µ–Ω = st.number_input("–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", 10), min_value=1, max_value=60)
        with col7:
            –Ω–æ–≤—ã–π_—Å—Ä–æ—á–Ω—ã–π = st.number_input("–°—Ä–æ—á–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ä–æ—á–Ω—ã–π", 1), min_value=1, max_value=10)
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏", key="save_thresholds"):
            st.session_state.–ø–æ—Ä–æ–≥–∏ = {
                "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": –Ω–æ–≤—ã–π_—Ç—Ñ_–º–∞–∫—Å,
                "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": –Ω–æ–≤—ã–π_–Ω–µ—Ç—Ñ_–º–∞–∫—Å,
                "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": –Ω–æ–≤—ã–π_–∂—ë–ª—Ç—ã–π_–º–∞–∫—Å,
                "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": –Ω–æ–≤—ã–π_—Ç–µ–Ω–¥–µ—Ä,
                "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": –Ω–æ–≤—ã–π_–µ–¥–∏–Ω—Å—Ç–≤
            }
            st.session_state.—Å—Ä–æ–∫–∏ = {
                "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": –Ω–æ–≤—ã–π_—Å—Ç–∞–Ω–¥–∞—Ä—Ç,
                "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": –Ω–æ–≤—ã–π_—Ä–∞—Å—à–∏—Ä–µ–Ω,
                "—Å—Ä–æ—á–Ω—ã–π": –Ω–æ–≤—ã–π_—Å—Ä–æ—á–Ω—ã–π
            }
            st.success("‚úÖ –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
    
    # ==========================================
    # API –ö–õ–Æ–ß–ò
    # ==========================================
    with tabs[2]:
        st.markdown("#### üîë API-–∫–ª—é—á–∏ –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞")
        
        api_–∫–ª—é—á–∏ = st.session_state.get("api_–∫–ª—é—á–∏", {})
        –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ = st.session_state.get("–≤–∫–ª—é—á—ë–Ω–Ω—ã–µ_–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã", [])
        
        for –ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥, –∏–Ω—Ñ–æ in AI_–ü–†–û–í–ê–ô–î–ï–†–´.items():
            col1, col2, col3 = st.columns([3, 1, 2])
            
            with col1:
                —Ç–µ–∫—É—â–∏–π = api_–∫–ª—é—á–∏.get(–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥, "")
                –Ω–æ–≤—ã–π = st.text_input(
                    f"**{–∏–Ω—Ñ–æ['–Ω–∞–∑–≤–∞–Ω–∏–µ']}**",
                    type="password",
                    value=—Ç–µ–∫—É—â–∏–π,
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á...",
                    key=f"key_{–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥}"
                )
                if –Ω–æ–≤—ã–π != —Ç–µ–∫—É—â–∏–π:
                    st.session_state.api_–∫–ª—é—á–∏[–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥] = –Ω–æ–≤—ã–π
            
            with col2:
                if st.session_state.api_–∫–ª—é—á–∏.get(–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥):
                    if st.button("üîç", key=f"test_{–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥}", help="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"):
                        with st.spinner("..."):
                            folder = st.session_state.get("yandex_folder_id", "") if –ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥ == "yandexgpt" else ""
                            —É—Å–ø–µ—Ö, —Å–æ–æ–±—â = AI–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ(–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥, st.session_state.api_–∫–ª—é—á–∏[–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥], folder)
                        if —É—Å–ø–µ—Ö:
                            st.success("‚úÖ")
                        else:
                            st.error("‚ùå")
            
            with col3:
                if st.session_state.api_–∫–ª—é—á–∏.get(–ø—Ä–æ–≤–∞–π–¥–µ—Ä_–∏–¥):
                    st.caption("‚úÖ –ö–ª—é—á –≤–≤–µ–¥—ë–Ω")
                else:
                    st.caption("‚Äî")
        
        st.markdown("---")
        –Ω–æ–≤—ã–π_folder = st.text_input("YandexGPT Folder ID", value=st.session_state.get("yandex_folder_id", ""))
        if –Ω–æ–≤—ã–π_folder != st.session_state.get("yandex_folder_id", ""):
            st.session_state.yandex_folder_id = –Ω–æ–≤—ã–π_folder
    
    # ==========================================
    # –¢–ò–ü–û–í–´–ï –§–û–†–ú–´
    # ==========================================
    with tabs[3]:
        st.markdown("#### üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏")
        
        st.markdown("**–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã:**")
        for –∫–æ–¥, —Ç—Ñ in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´.items():
            st.markdown(f"- ‚ö™ {—Ç—Ñ['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({—Ç—Ñ['–∫–æ–¥']})")
        
        st.markdown("---")
        st.markdown("**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã:**")
        
        if st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ:
            for –∫–æ–¥, —Ç—Ñ in st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ.items():
                col1, col2 = st.columns([4, 1])
                with col1:
                    st.markdown(f"- üîµ {—Ç—Ñ.get('–Ω–∞–∑–≤–∞–Ω–∏–µ', –∫–æ–¥)}")
                with col2:
                    if st.button("üóëÔ∏è", key=f"del_{–∫–æ–¥}"):
                        del st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[–∫–æ–¥]
                        st.rerun()
        else:
            st.info("‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ—Ä–º—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã")
        
        st.markdown("---")
        st.caption("üí° –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤—ã—Ö —Ñ–æ—Ä–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")

# ============================================================================
# –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# ============================================================================

def –≥–ª–∞–≤–Ω–∞—è():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏", DEFAULT_ORG_CONFIG)
    —Ä–æ–ª—å = st.session_state.—Ä–æ–ª—å
    
    st.markdown(f'''
    <div class="main-header">
        <div class="traffic-light"><span class="tl-red"></span><span class="tl-yellow"></span><span class="tl-green"></span></div>
        <h2>üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä <span class="version-badge">v7.2</span></h2>
        <div style="opacity:0.9;font-size:0.9rem;">{–æ—Ä–≥.get("short_name", "")}</div>
    </div>
    ''', unsafe_allow_html=True)
    
    –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å()
    
    # –í–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    if —Ä–æ–ª—å == –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
        –≤–∫–ª–∞–¥–∫–∏ = ["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è", "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"]
    else:
        –≤–∫–ª–∞–¥–∫–∏ = ["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è"]
    
    tabs = st.tabs(–≤–∫–ª–∞–¥–∫–∏)
    
    with tabs[0]:
        –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞()
    with tabs[1]:
        –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤()
    with tabs[2]:
        –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏()
    
    if —Ä–æ–ª—å == –†–æ–ª—å–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†:
        with tabs[3]:
            –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫()


def main():
    –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏()
    –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è()
    
    if not st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
        —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏()
    else:
        –≥–ª–∞–≤–Ω–∞—è()


if __name__ == "__main__":
    main()
