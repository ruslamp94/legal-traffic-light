"""
–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.5
–ê–û ¬´–°–ü–ö¬ª ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è

–ù–æ–≤–æ–µ –≤ v7.5:
- AI-–∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (—Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API)
- RAG-—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–∏–ø–æ–≤—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏
- –°—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ API-–∫–ª—é—á–µ–π
- –î–µ—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∏—Å–∫–æ–≤
"""

import streamlit as st
import re, json, hashlib, io, time
from datetime import datetime, date
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass, field
import difflib

# ============================================================================
# –ë–ò–ë–õ–ò–û–¢–ï–ö–ò
# ============================================================================

DOCX_AVAILABLE = False
PDF_AVAILABLE = False
REQUESTS_AVAILABLE = False

try:
    from docx import Document as DocxDocument
    DOCX_AVAILABLE = True
except ImportError:
    pass

try:
    from PyPDF2 import PdfReader
    PDF_AVAILABLE = True
except ImportError:
    pass

try:
    import requests
    REQUESTS_AVAILABLE = True
except ImportError:
    pass

# ============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´
# ============================================================================

st.set_page_config(
    page_title="–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.5 | –°–ü–ö",
    page_icon="üö¶",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================================
# –ö–û–ù–°–¢–ê–ù–¢–´
# ============================================================================

DEFAULT_ORG_CONFIG = {
    "full_name": '–ê–∫—Ü–∏–æ–Ω–µ—Ä–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ ¬´–°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª',
    "short_name": '–ê–û ¬´–°–ü–ö¬ª',
    "inn": "7701234567",
    "kpp": "770101001",
    "director_name": "–°–∏–¥–æ—Ä–æ–≤ –°–µ—Ä–≥–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á",
    "director_position": "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",
}

DEFAULT_THRESHOLDS = {
    "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": 100_000,
    "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": 50_000,
    "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": 5_000_000,
    "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": 3_000_000,
    "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": 100_000
}

DEFAULT_DEADLINES = {"—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": 5, "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": 10, "—Å—Ä–æ—á–Ω—ã–π": 1}

–†–û–õ–¨_–ê–î–ú–ò–ù = "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
–†–û–õ–¨_–Æ–ó–ï–† = "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"

# ============================================================================
# –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò
# ============================================================================

–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò = {
    "admin": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("admin123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–û–õ–¨_–ê–î–ú–ò–ù,
        "–∏–º—è": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    },
    "legal": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("legal123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–û–õ–¨_–ê–î–ú–ò–ù,
        "–∏–º—è": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Æ–î",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    }
}

# ============================================================================
# AI –ü–†–û–í–ê–ô–î–ï–†–´ –° –°–°–´–õ–ö–ê–ú–ò
# ============================================================================

AI_–ü–†–û–í–ê–ô–î–ï–†–´ = {
    "openai": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "OpenAI GPT-4",
        "–º–æ–¥–µ–ª—å": "gpt-4o-mini",
        "url_api": "https://api.openai.com/v1/chat/completions",
        "url_keys": "https://platform.openai.com/api-keys",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á –Ω–∞ platform.openai.com ‚Üí API Keys",
        "—Ü–µ–Ω–∞": "~$0.15 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤"
    },
    "anthropic": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "Anthropic Claude",
        "–º–æ–¥–µ–ª—å": "claude-3-haiku-20240307",
        "url_api": "https://api.anthropic.com/v1/messages",
        "url_keys": "https://console.anthropic.com/settings/keys",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á –Ω–∞ console.anthropic.com ‚Üí API Keys",
        "—Ü–µ–Ω–∞": "~$0.25 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤"
    },
    "gigachat": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "GigaChat (–°–±–µ—Ä)",
        "–º–æ–¥–µ–ª—å": "GigaChat",
        "url_api": "https://gigachat.devices.sberbank.ru/api/v1/chat/completions",
        "url_keys": "https://developers.sber.ru/portal/products/gigachat-api",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ developers.sber.ru ‚Üí GigaChat API",
        "—Ü–µ–Ω–∞": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å"
    },
    "yandexgpt": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "YandexGPT",
        "–º–æ–¥–µ–ª—å": "yandexgpt-lite",
        "url_api": "https://llm.api.cloud.yandex.net/foundationModels/v1/completion",
        "url_keys": "https://console.cloud.yandex.ru/",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–ö–æ–Ω—Å–æ–ª—å –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞ ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí API-–∫–ª—é—á",
        "—Ü–µ–Ω–∞": "~1.2‚ÇΩ –∑–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤"
    },
}

# ============================================================================
# –°–ü–†–ê–í–û–ß–ù–ò–ö–ò
# ============================================================================

–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø = [
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–∑–æ–∫",
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ–¥–≤–∏–∂–Ω–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞",
    "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑–∞–∫—É–ø–æ–∫", "–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
    "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤", "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è",
]

–î–û–õ–ñ–ù–û–°–¢–ò = [
    "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–í–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞", "–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
]

–ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê = [
    "–ê—Ä–µ–Ω–¥–∞ –≤–∞–≥–æ–Ω–æ–≤", "–õ–∏–∑–∏–Ω–≥ –≤–∞–≥–æ–Ω–æ–≤", "–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –≤–∞–≥–æ–Ω–æ–≤",
    "–ê—Ä–µ–Ω–¥–∞ –ª–æ–∫–æ–º–æ—Ç–∏–≤–æ–≤", "–î–æ–≥–æ–≤–æ—Ä —Å –û–ê–û ¬´–†–ñ–î¬ª", "–í–≠–î/–í–∞–ª—é—Ç–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã",
    "–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–π–º–∞", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–ª–æ–≥–∞",
    "–ê—Ä–µ–Ω–¥–∞/–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û",
]

–ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´ = [
    "–î–æ–≥–æ–≤–æ—Ä –¢–≠–û", "–†–∞–º–æ—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –≥—Ä—É–∑–∞",
    "–ó–∞–∫—É–ø–∫–∞ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
]

–¢–ò–ü–´_–î–û–ì–û–í–û–†–û–í = [
    "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)", "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏", "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
    "–î–æ–≥–æ–≤–æ—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (–∞–≤—Ç–æ)", "–î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã –≤–∞–≥–æ–Ω–æ–≤", "–î–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞",
    "–ê–≥–µ–Ω—Ç—Å–∫–∏–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "–î—Ä—É–≥–æ–π",
]

–§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê = ["–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–¢–§)", "–§–æ—Ä–º–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞", "–°–≤–æ–±–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞", "–¢–§ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏"]
–°–¢–ê–¢–£–°–´_–Æ–î = ["–ù–µ –ø–æ—Å—Ç—É–ø–∞–ª", "–ü–æ—Å—Ç—É–ø–∞–ª", "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω –Æ–î", "–û—Ç–∫–ª–æ–Ω—ë–Ω", "–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏"]

# ============================================================================
# –¢–ò–ü–û–í–´–ï –§–û–†–ú–´ –° –≠–¢–ê–õ–û–ù–ù–´–ú–ò –£–°–õ–û–í–ò–Ø–ú–ò –î–õ–Ø RAG
# ============================================================================

–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´ = {
    "—É—Å–ª—É–≥–∏_—Ç—ç–æ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–£–°–õ-001",
        "–≤–µ—Ä—Å–∏—è": "2025.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ó–∞–∫–∞–∑—á–∏–∫",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ-—ç–∫—Å–ø–µ–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è",
        
        # –ö–ª—é—á–µ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞
        "–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏", "–≤–∞–≥–æ–Ω—ã", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "—Ç—ç–æ", "–µ–ª—Å", "—Ä–∂–¥"],
        
        # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏", "–æ–±—è–∑—É–µ—Ç—Å—è"],
                "–≤–µ—Å": 2.0
            },
            "–ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∞–≤–∞", "–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "–∑–∞—è–≤–∫–∞", "–≤–∞–≥–æ–Ω—ã"],
                "–≤–µ—Å": 1.5
            },
            "–°–¢–û–ò–ú–û–°–¢–¨ –ò –†–ê–°–ß–Å–¢–´": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Ü–µ–Ω–∞", "–æ–ø–ª–∞—Ç–∞", "—Å—á—ë—Ç", "–∞–∫—Ç"],
                "–≤–µ—Å": 2.0
            },
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—à—Ç—Ä–∞—Ñ", "–Ω–µ—É—Å—Ç–æ–π–∫–∞", "—É–±—ã—Ç–∫–∏"],
                "–≤–µ—Å": 2.0
            },
            "–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": False,
                "–º–∞—Ä–∫–µ—Ä—ã": ["–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å", "—Ç–∞–π–Ω–∞", "—Ä–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ"],
                "–≤–µ—Å": 0.5
            },
            "–§–û–†–°-–ú–ê–ñ–û–†": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["—Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä", "–Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–∞—è —Å–∏–ª–∞", "–æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞"],
                "–≤–µ—Å": 0.5
            },
            "–°–ü–û–†–´": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["—Å–ø–æ—Ä—ã", "–∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π", "—Å—É–¥", "–ø—Ä–µ—Ç–µ–Ω–∑–∏—è"],
                "–≤–µ—Å": 1.0
            },
            "–†–ï–ö–í–ò–ó–ò–¢–´": {
                "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True,
                "–º–∞—Ä–∫–µ—Ä—ã": ["—Ä–µ–∫–≤–∏–∑–∏—Ç—ã", "–∏–Ω–Ω", "–ø–æ–¥–ø–∏—Å–∏", "–∞–¥—Ä–µ—Å"],
                "–≤–µ—Å": 0.5
            },
        },
        
        # –≠–¢–ê–õ–û–ù–ù–´–ï –£–°–õ–û–í–ò–Ø (—á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –Ω–∞—à–µ–π –¢–§)
        "—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è": {
            "–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞": "–Ω–µ –±–æ–ª–µ–µ 30%",
            "—Å—Ä–æ–∫_–æ–ø–ª–∞—Ç—ã": "–Ω–µ –º–µ–Ω–µ–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π",
            "–Ω–µ—É—Å—Ç–æ–π–∫–∞_–Ω–∞—à–∞": "–Ω–µ –±–æ–ª–µ–µ 0.1% –≤ –¥–µ–Ω—å, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç —Å—É–º–º—ã",
            "–Ω–µ—É—Å—Ç–æ–π–∫–∞_–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞": "0.1% –≤ –¥–µ–Ω—å –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É",
            "—à—Ç—Ä–∞—Ñ_–ø—Ä–æ—Å—Ç–æ–π": "–Ω–µ –±–æ–ª–µ–µ 2500 —Ä—É–±/—Å—É—Ç–∫–∏",
            "—à—Ç—Ä–∞—Ñ_–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å": "–Ω–µ –±–æ–ª–µ–µ 3 000 000 —Ä—É–±",
            "–ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å": "–ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Å—É–¥ –≥. –ú–æ—Å–∫–≤—ã",
            "—Å—Ä–æ–∫_–¥–µ–π—Å—Ç–≤–∏—è": "–Ω–µ –±–æ–ª–µ–µ 3 –ª–µ—Ç –±–µ–∑ –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏–∏",
            "–∏–∑–º–µ–Ω–µ–Ω–∏–µ_—Ü–µ–Ω—ã": "—Ç–æ–ª—å–∫–æ –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é —Å—Ç–æ—Ä–æ–Ω",
            "—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ": "–∑–∞ 30 –¥–Ω–µ–π –ø–∏—Å—å–º–µ–Ω–Ω–æ",
        },
        
        # –†–∏—Å–∫–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–∑–∞–∫–∞–∑—á–∏–∫.*?(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç|–ø—Ä–∏–Ω–∏–º–∞–µ—Ç).*?(?:–≤—Å–µ|–ª—é–±—ã–µ|–ø–æ–ª–Ω).*?—Ä–∏—Å–∫",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–í–°–ï –†–ò–°–ö–ò –≤–æ–∑–ª–æ–∂–µ–Ω—ã –Ω–∞ –°–ü–ö",
                "—ç—Ç–∞–ª–æ–Ω": "–†–∏—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò—Å–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–ö–∞–∂–¥–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –Ω–µ—Å—ë—Ç —Ä–∏—Å–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–≤–æ–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%",
                "—ç—Ç–∞–ª–æ–Ω": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –Ω–µ –±–æ–ª–µ–µ 30%",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ 30% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏¬ª –∏–ª–∏ ¬´–û–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–Ω–µ—É—Å—Ç–æ–π–∫\w*.*?–∑–∞–∫–∞–∑—á–∏–∫\w*.*?(?:0[,.]?[3-9]|[1-9])\s*%",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –¥–ª—è –°–ü–ö –≤—ã—à–µ 0.2%/–¥–µ–Ω—å",
                "—ç—Ç–∞–ª–æ–Ω": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –Ω–µ –±–æ–ª–µ–µ 0.1% –≤ –¥–µ–Ω—å",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–ù–µ—É—Å—Ç–æ–π–∫–∞ 0.1% –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"—à—Ç—Ä–∞—Ñ.*?–ø—Ä–æ—Å—Ç–æ–π.*?(?:[3-9]\d{3}|[1-9]\d{4,})",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π –±–æ–ª–µ–µ 2500 —Ä—É–±/—Å—É—Ç–∫–∏",
                "—ç—Ç–∞–ª–æ–Ω": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π –Ω–µ –±–æ–ª–µ–µ 2500 —Ä—É–±/–≤–∞–≥–æ–Ω–æ-—Å—É—Ç–∫–∏",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–®—Ç—Ä–∞—Ñ –∑–∞ —Å–≤–µ—Ä—Ö–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π ‚Äî 2000 —Ä—É–±. –∑–∞ –≤–∞–≥–æ–Ω–æ-—Å—É—Ç–∫–∏¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"—à—Ç—Ä–∞—Ñ.*?–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç.*?(?:[5-9]|[1-9]\d)\s*(?:000\s*000|–º–ª–Ω)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–®—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –±–æ–ª–µ–µ 5 –º–ª–Ω",
                "—ç—Ç–∞–ª–æ–Ω": "–®—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –±–æ–ª–µ–µ 3 –º–ª–Ω —Ä—É–±",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî 1 000 000 —Ä—É–±–ª–µ–π¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω\w+.*?(?:–∏–∑–º–µ–Ω–µ–Ω|–ø–æ–≤—ã—à|—É–≤–µ–ª–∏—á)\w*.*?(?:—Ü–µ–Ω|—Ç–∞—Ä–∏—Ñ|—Å—Ç–æ–∏–º–æ—Å—Ç)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã/—Ç–∞—Ä–∏—Ñ–æ–≤",
                "—ç—Ç–∞–ª–æ–Ω": "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é —Å—Ç–æ—Ä–æ–Ω",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò—Å–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å: ¬´–ó–∞–∫–∞–∑—á–∏–∫ –≤–ø—Ä–∞–≤–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"(?:–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω|–∑–∞—Ä—É–±–µ–∂–Ω)\w*.*?(?:—Å—É–¥|–∞—Ä–±–∏—Ç—Ä–∞–∂)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ü–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å –≤ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–º —Å—É–¥–µ",
                "—ç—Ç–∞–ª–æ–Ω": "–ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Å—É–¥ –≥. –ú–æ—Å–∫–≤—ã",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–í—Å–µ —Å–ø–æ—Ä—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω–æ–º —Å—É–¥–µ –≥–æ—Ä–æ–¥–∞ –ú–æ—Å–∫–≤—ã¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–ø–ª–∞—Ç–∞.*?(?:1|2|3)\s*(?:—Ä–∞–±–æ—á|–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω|–±–∞–Ω–∫–æ–≤—Å–∫)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã –º–µ–Ω–µ–µ 5 –¥–Ω–µ–π",
                "—ç—Ç–∞–ª–æ–Ω": "–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã –Ω–µ –º–µ–Ω–µ–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: ¬´–û–ø–ª–∞—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π —Å –¥–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á—ë—Ç–∞¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–º–æ–ª—á–∞–Ω–∏\w+.*?(?:—Å–æ–≥–ª–∞—Å–∏|–∞–∫—Ü–µ–ø—Ç|–ø—Ä–∏–Ω—è—Ç)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ú–æ–ª—á–∞–Ω–∏–µ = —Å–æ–≥–ª–∞—Å–∏–µ (—Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ)",
                "—ç—Ç–∞–ª–æ–Ω": "–Ø–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏—ë–º–∫–∏",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å: ¬´–£—Å–ª—É–≥–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—ã–º–∏ –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∞–∫—Ç–∞ –æ–±–µ–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏¬ª"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª\w+.*?–Ω–µ\s+(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç).*?(?:–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç|—É–±—ã—Ç–∫)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏",
                "—ç—Ç–∞–ª–æ–Ω": "–í–∑–∞–∏–º–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∑–∞ –Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–µ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"
            },
            {
                "–ø–∞—Ç—Ç–µ—Ä–Ω": r"–±–µ–∑\s*(?:–æ–≥—Ä–∞–Ω–∏—á–µ–Ω|–ª–∏–º–∏—Ç|–ø—Ä–µ–¥–µ–ª)",
                "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π",
                "–ø—Ä–æ–±–ª–µ–º–∞": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è",
                "—ç—Ç–∞–ª–æ–Ω": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç —Å—É–º–º—ã",
                "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å: ¬´–Ω–æ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞¬ª"
            },
        ]
    },
    
    "–ø–æ—Å—Ç–∞–≤–∫–∞": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–ü–û–°-001",
        "–≤–µ—Ä—Å–∏—è": "2025.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–ø–∞—Å–Ω—ã—Ö —á–∞—Å—Ç–µ–π",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å", "—Ç–æ–≤–∞—Ä", "–ø–æ—Å—Ç–∞–≤–∫–∞", "—Ç–æ—Ä–≥-12"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å", "—Ç–æ–≤–∞—Ä"], "–≤–µ—Å": 2.0},
            "–ö–ê–ß–ï–°–¢–í–û": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–∫–∞—á–µ—Å—Ç–≤–æ", "–≥–æ—Å—Ç", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"], "–≤–µ—Å": 1.5},
            "–¶–ï–ù–ê –ò –†–ê–°–ß–Å–¢–´": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ü–µ–Ω–∞", "–æ–ø–ª–∞—Ç–∞", "–Ω–¥—Å"], "–≤–µ—Å": 2.0},
            "–°–†–û–ö–ò –ü–û–°–¢–ê–í–ö–ò": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ä–æ–∫", "–ø–æ—Å—Ç–∞–≤–∫–∞", "–¥–∞—Ç–∞"], "–≤–µ—Å": 1.5},
            "–ü–†–ò–Å–ú–ö–ê": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–ø—Ä–∏—ë–º–∫–∞", "–ø-6", "–ø-7"], "–≤–µ—Å": 1.0},
            "–ì–ê–†–ê–ù–¢–ò–Ø": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–≥–∞—Ä–∞–Ω—Ç–∏—è", "–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π"], "–≤–µ—Å": 1.5},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–Ω–µ—É—Å—Ç–æ–π–∫–∞"], "–≤–µ—Å": 2.0},
        },
        "—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è": {
            "–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞": "–Ω–µ –±–æ–ª–µ–µ 30%",
            "–≥–∞—Ä–∞–Ω—Ç–∏—è": "–Ω–µ –º–µ–Ω–µ–µ 12 –º–µ—Å—è—Ü–µ–≤",
            "–ø—Ä–∏—ë–º–∫–∞": "–ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ü-6, –ü-7",
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%", "—ç—Ç–∞–ª–æ–Ω": "–ù–µ –±–æ–ª–µ–µ 30%", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 30% –∏–ª–∏ –æ–ø–ª–∞—Ç—É –ø–æ —Ñ–∞–∫—Ç—É"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–±–µ–∑\s*–≥–∞—Ä–∞–Ω—Ç–∏–∏", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏", "—ç—Ç–∞–ª–æ–Ω": "–ì–∞—Ä–∞–Ω—Ç–∏—è 12+ –º–µ—Å—è—Ü–µ–≤", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–≥–∞—Ä–∞–Ω—Ç–∏—è.*?(?:1|2|3)\s*–º–µ—Å—è—Ü", "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ì–∞—Ä–∞–Ω—Ç–∏—è –º–µ–Ω–µ–µ 6 –º–µ—Å—è—Ü–µ–≤", "—ç—Ç–∞–ª–æ–Ω": "12 –º–µ—Å—è—Ü–µ–≤", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–≤–µ–ª–∏—á–∏—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫"},
        ]
    },
    
    "—Ö—Ä–∞–Ω–µ–Ω–∏–µ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–•–†–ù-001",
        "–≤–µ—Ä—Å–∏—è": "2025.1",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º—É—â–µ—Å—Ç–≤–∞",
        "–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å", "—Ö—Ä–∞–Ω–µ–Ω–∏–µ", "–∏–º—É—â–µ—Å—Ç–≤–æ"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å", "—Ö—Ä–∞–Ω–µ–Ω–∏–µ"], "–≤–µ—Å": 2.0},
            "–û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "—Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å"], "–≤–µ—Å": 1.5},
            "–í–û–ó–ù–ê–ì–†–ê–ñ–î–ï–ù–ò–ï": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ", "–æ–ø–ª–∞—Ç–∞"], "–≤–µ—Å": 1.5},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": True, "–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—É—Ç—Ä–∞—Ç–∞", "–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ"], "–≤–µ—Å": 2.0},
        },
        "—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è": {
            "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å_—Ö—Ä–∞–Ω–∏—Ç–µ–ª—è": "–ø–æ–ª–Ω–∞—è –∑–∞ —É—Ç—Ä–∞—Ç—É –∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ",
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—Ö—Ä–∞–Ω–∏—Ç–µ–ª\w+.*?–Ω–µ\s+(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–•—Ä–∞–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "—ç—Ç–∞–ª–æ–Ω": "–ü–æ–ª–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –∑–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å"},
        ]
    },
}

# ============================================================================
# –î–ï–ú–û –î–û–ì–û–í–û–†
# ============================================================================

–î–ï–ú–û_–î–û–ì–û–í–û–† = """–î–û–ì–û–í–û–† –û–ö–ê–ó–ê–ù–ò–Ø –£–°–õ–£–ì ‚Ññ 2025/–¢–≠–û-001

–≥. –ú–æ—Å–∫–≤–∞                                                     ¬´15¬ª —è–Ω–≤–∞—Ä—è 2025 –≥.

–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª (–ò–ù–ù 7707999888), –∏–º–µ–Ω—É–µ–º–æ–µ ¬´–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å¬ª, –≤ –ª–∏—Ü–µ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ö–æ–∑–ª–æ–≤–∞ –ö.–ö., –∏
–ê–û ¬´–°–ü–ö¬ª (–ò–ù–ù 7701234567), –∏–º–µ–Ω—É–µ–º–æ–µ ¬´–ó–∞–∫–∞–∑—á–∏–∫¬ª, –≤ –ª–∏—Ü–µ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –°–∏–¥–æ—Ä–æ–≤–∞ –°.–°., –∑–∞–∫–ª—é—á–∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä:

1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê
1.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥–∏ –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∂/–¥ –≤–∞–≥–æ–Ω–æ–≤ –¥–ª—è –ø–µ—Ä–µ–≤–æ–∑–∫–∏ –≥—Ä—É–∑–æ–≤ –ó–∞–∫–∞–∑—á–∏–∫–∞, –∞ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å —É—Å–ª—É–≥–∏.

2. –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò –°–¢–û–†–û–ù
2.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –ø–æ–¥–∞—Ç—å –≤–∞–≥–æ–Ω—ã –ø–æ –ó–∞—è–≤–∫–µ –ó–∞–∫–∞–∑—á–∏–∫–∞.
2.2. –ó–∞–∫–∞–∑—á–∏–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–≥—Ä—É–∑–∫—É/–≤—ã–≥—Ä—É–∑–∫—É –≤ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Ä–æ–∫–∏.
2.3. –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ—Å—ë—Ç –≤—Å–µ —Ä–∏—Å–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–∞–≥–æ–Ω–æ–≤.

3. –°–¢–û–ò–ú–û–°–¢–¨ –£–°–õ–£–ì –ò –ü–û–†–Ø–î–û–ö –†–ê–°–ß–Å–¢–û–í
3.1. –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥: 8 500 000 (–í–æ—Å–µ–º—å –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø—è—Ç—å—Å–æ—Ç —Ç—ã—Å—è—á) —Ä—É–±–ª–µ–π.
3.2. –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ 50% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è.
3.3. –û–ø–ª–∞—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á—ë—Ç–∞.
3.4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ –∏–∑–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∑–∞ 10 –¥–Ω–µ–π.

4. –ü–†–ò–Å–ú–ö–ê –£–°–õ–£–ì
4.1. –ê–∫—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.
4.2. –ú–æ–ª—á–∞–Ω–∏–µ –ó–∞–∫–∞–∑—á–∏–∫–∞ –±–æ–ª–µ–µ 3 –¥–Ω–µ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ–º —Å –∞–∫—Ç–æ–º.

5. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù
5.1. –ó–∞ —Å–≤–µ—Ä—Ö–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞–≥–æ–Ω–æ–≤ —à—Ç—Ä–∞—Ñ 5 000 —Ä—É–±–ª–µ–π –∑–∞ –≤–∞–≥–æ–Ω–æ-—Å—É—Ç–∫–∏.
5.2. –ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –æ–ø–ª–∞—Ç—ã –Ω–µ—É—Å—Ç–æ–π–∫–∞ 0,5% –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
5.3. –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ—Å—ë—Ç –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–∞–≥–æ–Ω–æ–≤.
5.4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ —É–±—ã—Ç–∫–∏.

6. –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨
6.1. –°—Ä–æ–∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: –±–µ—Å—Å—Ä–æ—á–Ω–æ.
6.2. –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: 15 000 000 —Ä—É–±–ª–µ–π.

7. –§–û–†–°-–ú–ê–ñ–û–†
7.1. –°—Ç–æ—Ä–æ–Ω—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–π —Å–∏–ª–µ.

8. –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø
8.1. –î–æ–≥–æ–≤–æ—Ä –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 31.12.2025.
8.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—å –¥–æ–≥–æ–≤–æ—Ä –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∑–∞ 5 –¥–Ω–µ–π.

9. –†–ê–ó–†–ï–®–ï–ù–ò–ï –°–ü–û–†–û–í
9.1. –í—Å–µ —Å–ø–æ—Ä—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω–æ–º —Å—É–¥–µ –≥. –ú–æ—Å–∫–≤—ã.

10. –†–ï–ö–í–ò–ó–ò–¢–´ –ò –ü–û–î–ü–ò–°–ò –°–¢–û–†–û–ù

–ó–ê–ö–ê–ó–ß–ò–ö:                              –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨:
–ê–û ¬´–°–ü–ö¬ª                               –û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª
–ò–ù–ù 7701234567                         –ò–ù–ù 7707999888

___________/–°–∏–¥–æ—Ä–æ–≤ –°.–°./              ___________/–ö–æ–∑–ª–æ–≤ –ö.–ö./
"""

–î–ï–ú–û_–î–ê–ù–ù–´–ï = {
    "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": "–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª",
    "–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞": "2025/–¢–≠–û-001",
    "–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞": date(2025, 1, 15),
    "—Å—É–º–º–∞": 8_500_000,
}

# ============================================================================
# RAG –ê–ù–ê–õ–ò–ó–ê–¢–û–† - –°–õ–ò–ß–ï–ù–ò–ï –° –¢–ò–ü–û–í–´–ú–ò –§–û–†–ú–ê–ú–ò
# ============================================================================

class RAG–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä:
    """Retrieval-Augmented Generation –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤"""
    
    –°–¢–û–ü_–°–õ–û–í–ê = {'–∏', '–≤', '–Ω–∞', '–ø–æ', '—Å', '–∫', '–æ', '–æ—Ç', '–∏–∑', '–∑–∞', '–¥–ª—è', '–Ω–µ', '—á—Ç–æ', '–∫–∞–∫', 
                  '—ç—Ç–æ', '–≤—Å–µ', '–∏–ª–∏', '–ø—Ä–∏', '–¥–æ', '–±–µ–∑', '–∞', '–Ω–æ', '–¥–∞', '–∂–µ', '–±—ã', '–ª–∏'}
    
    @classmethod
    def –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str) -> str:
        if not —Ç–µ–∫—Å—Ç:
            return ""
        —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.lower()
        —Ç–µ–∫—Å—Ç = re.sub(r'[¬´¬ª""‚Äû‚Äü\'\"]', '', —Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'[\n\r\t]+', ' ', —Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'\s+', ' ', —Ç–µ–∫—Å—Ç)
        return —Ç–µ–∫—Å—Ç.strip()
    
    @classmethod
    def —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str) -> List[str]:
        —Ç–µ–∫—Å—Ç = cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç)
        —Ç–µ–∫—Å—Ç = re.sub(r'[^\w\s–∞-—è—ë–ê-–Ø–Å-]', ' ', —Ç–µ–∫—Å—Ç)
        —Ç–æ–∫–µ–Ω—ã = —Ç–µ–∫—Å—Ç.split()
        return [t for t in —Ç–æ–∫–µ–Ω—ã if len(t) > 2 and t not in cls.–°–¢–û–ü_–°–õ–û–í–ê]
    
    @classmethod
    def jaccard_similarity(cls, set1: set, set2: set) -> float:
        """–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ñ–∞–∫–∫–∞—Ä–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏"""
        if not set1 or not set2:
            return 0.0
        intersection = len(set1 & set2)
        union = len(set1 | set2)
        return intersection / union if union > 0 else 0.0
    
    @classmethod
    def –Ω–∞–π—Ç–∏_–º–∞—Ä–∫–µ—Ä—ã(cls, —Ç–µ–∫—Å—Ç: str, –º–∞—Ä–∫–µ—Ä—ã: List[str]) -> Tuple[float, List[str], List[str]]:
        """–ü–æ–∏—Å–∫ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ"""
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç)
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = []
        –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ = []
        
        for –º–∞—Ä–∫–µ—Ä in –º–∞—Ä–∫–µ—Ä—ã:
            if –º–∞—Ä–∫–µ—Ä.lower() in —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º:
                –Ω–∞–π–¥–µ–Ω–Ω—ã–µ.append(–º–∞—Ä–∫–µ—Ä)
            else:
                –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ.append(–º–∞—Ä–∫–µ—Ä)
        
        —Å–∫–æ—Ä = len(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ) / len(–º–∞—Ä–∫–µ—Ä—ã) if –º–∞—Ä–∫–µ—Ä—ã else 0.0
        return —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
    
    @classmethod
    def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(cls, —Ç–µ–∫—Å—Ç: str) -> Tuple[Optional[str], float, str]:
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–≥–æ–≤–æ—Ä–∞"""
        –ª—É—á—à–∏–π = None
        –ª—É—á—à–∏–π_—Å–∫–æ—Ä = 0
        –ø—Ä–∏—á–∏–Ω–∞ = ""
        
        –≤—Å–µ_—Ç—Ñ = {**–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´, **st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})}
        
        for –∫–æ–¥_—Ç—Ñ, –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ in –≤—Å–µ_—Ç—Ñ.items():
            –º–∞—Ä–∫–µ—Ä—ã = –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ.get("–º–∞—Ä–∫–µ—Ä—ã", [])
            —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ, _ = cls.–Ω–∞–π—Ç–∏_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç, –º–∞—Ä–∫–µ—Ä—ã)
            
            # –ë–æ–Ω—É—Å –∑–∞ –Ω–∞—à—É —Ä–æ–ª—å
            –Ω–∞—à–∞_—Ä–æ–ª—å = –¥–∞–Ω–Ω—ã–µ_—Ç—Ñ.get("–Ω–∞—à–∞_—Ä–æ–ª—å", "").lower()
            if –Ω–∞—à–∞_—Ä–æ–ª—å in cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç):
                —Å–∫–æ—Ä += 0.15
            
            if —Å–∫–æ—Ä > –ª—É—á—à–∏–π_—Å–∫–æ—Ä:
                –ª—É—á—à–∏–π_—Å–∫–æ—Ä = —Å–∫–æ—Ä
                –ª—É—á—à–∏–π = –∫–æ–¥_—Ç—Ñ
                –ø—Ä–∏—á–∏–Ω–∞ = f"–ù–∞–π–¥–µ–Ω–æ {len(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ)}/{len(–º–∞—Ä–∫–µ—Ä—ã)} –º–∞—Ä–∫–µ—Ä–æ–≤: {', '.join(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ[:5])}"
        
        return –ª—É—á—à–∏–π, min(–ª—É—á—à–∏–π_—Å–∫–æ—Ä, 1.0), –ø—Ä–∏—á–∏–Ω–∞
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(cls, —Ç–µ–∫—Å—Ç: str, –ø–∞—Ç—Ç–µ—Ä–Ω—ã: List[Dict]) -> List[Dict]:
        """–ü–æ–∏—Å–∫ —Ä–∏—Å–∫–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = []
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = —Ç–µ–∫—Å—Ç.lower()
        
        for –ø in –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
            try:
                match = re.search(–ø["–ø–∞—Ç—Ç–µ—Ä–Ω"], —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º, re.IGNORECASE | re.DOTALL)
                if match:
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç (80 —Å–∏–º–≤–æ–ª–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ)
                    start = max(0, match.start() - 80)
                    end = min(len(—Ç–µ–∫—Å—Ç), match.end() + 80)
                    –∫–æ–Ω—Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç[start:end].replace('\n', ' ').strip()
                    
                    # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –Ω–æ–º–µ—Ä –ø—É–Ω–∫—Ç–∞
                    –ø—É–Ω–∫—Ç_match = re.search(r'(\d+\.\d+\.?\d*)', —Ç–µ–∫—Å—Ç[max(0, match.start()-50):match.start()])
                    –Ω–æ–º–µ—Ä_–ø—É–Ω–∫—Ç–∞ = –ø—É–Ω–∫—Ç_match.group(1) if –ø—É–Ω–∫—Ç_match else "‚Äî"
                    
                    –Ω–∞–π–¥–µ–Ω–Ω—ã–µ.append({
                        "–ø—Ä–æ–±–ª–µ–º–∞": –ø["–ø—Ä–æ–±–ª–µ–º–∞"],
                        "—É—Ä–æ–≤–µ–Ω—å": –ø["—É—Ä–æ–≤–µ–Ω—å"],
                        "—ç—Ç–∞–ª–æ–Ω": –ø.get("—ç—Ç–∞–ª–æ–Ω", ""),
                        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": –ø.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞"),
                        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": f"...{–∫–æ–Ω—Ç–µ–∫—Å—Ç}...",
                        "–ø—É–Ω–∫—Ç": –Ω–æ–º–µ—Ä_–ø—É–Ω–∫—Ç–∞
                    })
            except re.error:
                continue
        
        return –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    
    @classmethod
    def –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å_—Ä–∞–∑–¥–µ–ª—ã(cls, —Ç–µ–∫—Å—Ç: str, —Ä–∞–∑–¥–µ–ª—ã: Dict) -> Dict:
        """–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–ª–∏—á–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤"""
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã = {
            "–Ω–∞–π–¥–µ–Ω–Ω—ã–µ": [],
            "—á–∞—Å—Ç–∏—á–Ω–æ": [],
            "–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ": [],
            "–æ–±—â–∏–π_—Å–∫–æ—Ä": 0,
            "–æ–±—â–∏–π_–≤–µ—Å": 0
        }
        
        for –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–∞–Ω–Ω—ã–µ in —Ä–∞–∑–¥–µ–ª—ã.items():
            –º–∞—Ä–∫–µ—Ä—ã = –¥–∞–Ω–Ω—ã–µ.get("–º–∞—Ä–∫–µ—Ä—ã", [])
            –≤–µ—Å = –¥–∞–Ω–Ω—ã–µ.get("–≤–µ—Å", 1.0)
            –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω = –¥–∞–Ω–Ω—ã–µ.get("–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω", False)
            
            —Å–∫–æ—Ä, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ = cls.–Ω–∞–π—Ç–∏_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç, –º–∞—Ä–∫–µ—Ä—ã)
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["–æ–±—â–∏–π_–≤–µ—Å"] += –≤–µ—Å
            
            if —Å–∫–æ—Ä >= 0.6:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["–Ω–∞–π–¥–µ–Ω–Ω—ã–µ"].append({
                    "–Ω–∞–∑–≤–∞–Ω–∏–µ": –Ω–∞–∑–≤–∞–Ω–∏–µ,
                    "—Å–∫–æ—Ä": —Å–∫–æ—Ä,
                    "–Ω–∞–π–¥–µ–Ω–æ": –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
                })
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["–æ–±—â–∏–π_—Å–∫–æ—Ä"] += –≤–µ—Å * —Å–∫–æ—Ä
            elif —Å–∫–æ—Ä >= 0.3:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["—á–∞—Å—Ç–∏—á–Ω–æ"].append({
                    "–Ω–∞–∑–≤–∞–Ω–∏–µ": –Ω–∞–∑–≤–∞–Ω–∏–µ,
                    "—Å–∫–æ—Ä": —Å–∫–æ—Ä,
                    "–Ω–∞–π–¥–µ–Ω–æ": –Ω–∞–π–¥–µ–Ω–Ω—ã–µ,
                    "–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç": –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
                })
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["–æ–±—â–∏–π_—Å–∫–æ—Ä"] += –≤–µ—Å * —Å–∫–æ—Ä * 0.5
            else:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"].append({
                    "–Ω–∞–∑–≤–∞–Ω–∏–µ": –Ω–∞–∑–≤–∞–Ω–∏–µ,
                    "–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω": –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω,
                    "–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç": –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
                })
        
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    
    @classmethod
    def –ø–æ–ª–Ω—ã–π_–∞–Ω–∞–ª–∏–∑(cls, —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞: str, –∫–æ–¥_—Ç—Ñ: str = None) -> Dict:
        """–ü–æ–ª–Ω—ã–π RAG-–∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞"""
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {
            "—Ç–∏–ø_–æ–ø—Ä–µ–¥–µ–ª—ë–Ω": False,
            "–∫–æ–¥_—Ç—Ñ": "",
            "–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ": "",
            "–Ω–∞—à–∞_—Ä–æ–ª—å": "",
            "—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å": 0,
            "–ø—Ä–∏—á–∏–Ω–∞_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è": "",
            
            "–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤": {},
            "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Å—Ç—Ä—É–∫—Ç—É—Ä–µ": 0,
            
            "—Ä–∏—Å–∫–∏": [],
            "–∫—Ä–∞—Å–Ω—ã—Ö": 0,
            "–∂—ë–ª—Ç—ã—Ö": 0,
            
            "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": 0,
            "—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞": False,
            
            "—Ä–µ–∑—é–º–µ": "",
            "–≤–µ—Ä–¥–∏–∫—Ç": "",
            "–¥–µ—Ç–∞–ª—å–Ω—ã–π_–æ—Ç—á—ë—Ç": []
        }
        
        –≤—Å–µ_—Ç—Ñ = {**–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´, **st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})}
        
        # 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞
        if not –∫–æ–¥_—Ç—Ñ:
            –∫–æ–¥_—Ç—Ñ, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∏—á–∏–Ω–∞ = cls.–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞)
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"] = —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞_–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"] = –ø—Ä–∏—á–∏–Ω–∞
            if —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å < 0.3:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞"
                return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
        if not –∫–æ–¥_—Ç—Ñ or –∫–æ–¥_—Ç—Ñ not in –≤—Å–µ_—Ç—Ñ:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = "‚ùå –¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
            return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
        —Ç—Ñ = –≤—Å–µ_—Ç—Ñ[–∫–æ–¥_—Ç—Ñ]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç–∏–ø_–æ–ø—Ä–µ–¥–µ–ª—ë–Ω"] = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫–æ–¥_—Ç—Ñ"] = —Ç—Ñ.get("–∫–æ–¥", –∫–æ–¥_—Ç—Ñ)
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ"] = —Ç—Ñ.get("–Ω–∞–∑–≤–∞–Ω–∏–µ", "")
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞—à–∞_—Ä–æ–ª—å"] = —Ç—Ñ.get("–Ω–∞—à–∞_—Ä–æ–ª—å", "")
        
        # 2. –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Ä–∞–∑–¥–µ–ª—ã)
        –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤ = cls.–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å_—Ä–∞–∑–¥–µ–ª—ã(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, —Ç—Ñ.get("—Ä–∞–∑–¥–µ–ª—ã", {}))
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤"] = –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤
        
        if –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ–±—â–∏–π_–≤–µ—Å"] > 0:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Å—Ç—Ä—É–∫—Ç—É—Ä–µ"] = (–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ–±—â–∏–π_—Å–∫–æ—Ä"] / –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ–±—â–∏–π_–≤–µ—Å"]) * 100
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤
        —Ä–∏—Å–∫–∏ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, —Ç—Ñ.get("—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã", []))
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–∏—Å–∫–∏"] = —Ä–∏—Å–∫–∏
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] = sum(1 for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∫—Ä–∞—Å–Ω—ã–π")
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∂—ë–ª—Ç—ã—Ö"] = sum(1 for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∂—ë–ª—Ç—ã–π")
        
        # 4. –†–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
        –±–∞–∑–æ–≤—ã–π_—Å–∫–æ—Ä = —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Å—Ç—Ä—É–∫—Ç—É—Ä–µ"]
        —à—Ç—Ä–∞—Ñ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] * 15 + —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∂—ë–ª—Ç—ã—Ö"] * 5
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] = max(0, min(100, –±–∞–∑–æ–≤—ã–π_—Å–∫–æ—Ä - —à—Ç—Ä–∞—Ñ))
        
        # 5. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: —ç—Ç–æ –¢–§ –∏–ª–∏ –Ω–µ—Ç
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞"] = (
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 70 and
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] == 0 and
            len(–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"]) <= 2
        )
        
        # 6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Ä–¥–∏–∫—Ç–∞
        if —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç–∏–ø–æ–≤–∞—è_—Ñ–æ—Ä–º–∞"]:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–≤–µ—Ä–¥–∏–∫—Ç"] = "–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚úÖ –î–æ–≥–æ–≤–æ—Ä –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–µ ¬´{—Ä–µ–∑—É–ª—å—Ç–∞—Ç['–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ']}¬ª ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%)"
        elif —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 50:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–≤–µ—Ä–¥–∏–∫—Ç"] = "–ß–ê–°–¢–ò–ß–ù–û"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%). –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Æ–î."
        else:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–≤–µ—Ä–¥–∏–∫—Ç"] = "–ù–ï_–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ùå –ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–µ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%). –¢—Ä–µ–±—É–µ—Ç—Å—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –Æ–î."
        
        # 7. –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
        if —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] > 0:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–¥–µ—Ç–∞–ª—å–Ω—ã–π_–æ—Ç—á—ë—Ç"].append(f"üî¥ –í—ã—è–≤–ª–µ–Ω–æ {—Ä–µ–∑—É–ª—å—Ç–∞—Ç['–∫—Ä–∞—Å–Ω—ã—Ö']} –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤")
        if —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∂—ë–ª—Ç—ã—Ö"] > 0:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–¥–µ—Ç–∞–ª—å–Ω—ã–π_–æ—Ç—á—ë—Ç"].append(f"üü° –í—ã—è–≤–ª–µ–Ω–æ {—Ä–µ–∑—É–ª—å—Ç–∞—Ç['–∂—ë–ª—Ç—ã—Ö']} –∑–∞–º–µ—á–∞–Ω–∏–π")
        if –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"]:
            –æ–±—è–∑ = [r["–Ω–∞–∑–≤–∞–Ω–∏–µ"] for r in –∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"] if r.get("–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω")]
            if –æ–±—è–∑:
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–¥–µ—Ç–∞–ª—å–Ω—ã–π_–æ—Ç—á—ë—Ç"].append(f"üìã –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã: {', '.join(–æ–±—è–∑)}")
        
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# ============================================================================
# AI –ö–õ–ò–ï–ù–¢ - –†–ï–ê–õ–¨–ù–´–ï –ó–ê–ü–†–û–°–´ –ö API
# ============================================================================

class AI–ö–ª–∏–µ–Ω—Ç:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å AI API"""
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ(cls, –ø—Ä–æ–≤–∞–π–¥–µ—Ä: str, –∫–ª—é—á: str, folder_id: str = "") -> Tuple[bool, str, float]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API"""
        if not REQUESTS_AVAILABLE:
            return False, "‚ùå –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ requests –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞", 0
        if not –∫–ª—é—á:
            return False, "‚ùå API-–∫–ª—é—á –Ω–µ —É–∫–∞–∑–∞–Ω", 0
        
        start = time.time()
        
        try:
            if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "openai":
                response = requests.get(
                    "https://api.openai.com/v1/models",
                    headers={"Authorization": f"Bearer {–∫–ª—é—á}"},
                    timeout=10
                )
                elapsed = (time.time() - start) * 1000
                if response.status_code == 200:
                    return True, f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ ({elapsed:.0f}–º—Å)", elapsed
                elif response.status_code == 401:
                    return False, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π API-–∫–ª—é—á", elapsed
                return False, f"‚ùå –û—à–∏–±–∫–∞ {response.status_code}", elapsed
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "anthropic":
                response = requests.post(
                    "https://api.anthropic.com/v1/messages",
                    headers={
                        "x-api-key": –∫–ª—é—á,
                        "Content-Type": "application/json",
                        "anthropic-version": "2023-06-01"
                    },
                    json={
                        "model": "claude-3-haiku-20240307",
                        "max_tokens": 10,
                        "messages": [{"role": "user", "content": "–¢–µ—Å—Ç"}]
                    },
                    timeout=15
                )
                elapsed = (time.time() - start) * 1000
                if response.status_code == 200:
                    return True, f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ ({elapsed:.0f}–º—Å)", elapsed
                elif response.status_code == 401:
                    return False, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π API-–∫–ª—é—á", elapsed
                return False, f"‚ùå –û—à–∏–±–∫–∞ {response.status_code}", elapsed
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "yandexgpt":
                if not folder_id:
                    return False, "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Folder ID", 0
                return True, "‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ", 0
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "gigachat":
                return True, "‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è OAuth", 0
            
            return False, "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä", 0
            
        except requests.exceptions.Timeout:
            return False, "‚ùå –¢–∞–π–º–∞—É—Ç", 0
        except Exception as e:
            return False, f"‚ùå {str(e)[:30]}", 0
    
    @classmethod
    def —Å–æ–∑–¥–∞—Ç—å_–ø—Ä–æ–º–ø—Ç_–∞–Ω–∞–ª–∏–∑–∞(cls, —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞: str, rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç: Dict, –æ—Ä–≥_–Ω–∞–∑–≤–∞–Ω–∏–µ: str) -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞"""
        
        —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç = ""
        for i, —Ä–∏—Å–∫ in enumerate(rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get("—Ä–∏—Å–∫–∏", [])[:10], 1):
            —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç += f"\n{i}. [{—Ä–∏—Å–∫['—É—Ä–æ–≤–µ–Ω—å'].upper()}] {—Ä–∏—Å–∫['–ø—Ä–æ–±–ª–µ–º–∞']}"
            —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç += f"\n   –ö–æ–Ω—Ç–µ–∫—Å—Ç: {—Ä–∏—Å–∫.get('–∫–æ–Ω—Ç–µ–∫—Å—Ç', '')[:150]}"
            —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç += f"\n   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {—Ä–∏—Å–∫.get('—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è', '')}"
        
        —ç—Ç–∞–ª–æ–Ω—ã = ""
        —Ç—Ñ_–∫–æ–¥ = rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get("–∫–æ–¥_—Ç—Ñ", "")
        if —Ç—Ñ_–∫–æ–¥ and —Ç—Ñ_–∫–æ–¥ in –¢–ò–ü–û–í–´–ï_–§–û–†–ú–´:
            —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ = –¢–ò–ü–û–í–´–ï_–§–û–†–ú–´[—Ç—Ñ_–∫–æ–¥].get("—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è", {})
            for –∫–ª—é—á, –∑–Ω–∞—á–µ–Ω–∏–µ in —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ.items():
                —ç—Ç–∞–ª–æ–Ω—ã += f"\n- {–∫–ª—é—á}: {–∑–Ω–∞—á–µ–Ω–∏–µ}"
        
        –ø—Ä–æ–º–ø—Ç = f"""–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —é—Ä–∏—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏ {–æ—Ä–≥_–Ω–∞–∑–≤–∞–Ω–∏–µ} (–∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä).
–ú—ã –≤—ã—Å—Ç—É–ø–∞–µ–º –≤ —Ä–æ–ª–∏: {rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç.get('–Ω–∞—à–∞_—Ä–æ–ª—å', '–ó–∞–∫–∞–∑—á–∏–∫')}.

–ó–ê–î–ê–ß–ê: –ü—Ä–æ–≤–µ—Å—Ç–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ö–°–¢ –î–û–ì–û–í–û–†–ê (—Ñ—Ä–∞–≥–º–µ–Ω—Ç):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
{—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞[:5000]}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –í–´–Ø–í–õ–ï–ù–ù–´–ï –†–ò–°–ö–ò:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
{—Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç if —Ä–∏—Å–∫–∏_—Ç–µ–∫—Å—Ç else "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã—è–≤–∏–ª —è–≤–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤."}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–≠–¢–ê–õ–û–ù–ù–´–ï –£–°–õ–û–í–ò–Ø –ù–ê–®–ï–ô –¢–ò–ü–û–í–û–ô –§–û–†–ú–´:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
{—ç—Ç–∞–ª–æ–Ω—ã if —ç—Ç–∞–ª–æ–Ω—ã else "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –¥–æ 30%, –Ω–µ—É—Å—Ç–æ–π–∫–∞ –¥–æ 0.1%/–¥–µ–Ω—å, –ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å - –ê–° –ú–æ—Å–∫–≤—ã"}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–†–ï–ë–£–ï–¢–°–Ø:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. –†–ï–ó–Æ–ú–ï (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è): –ö—Ä–∞—Ç–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞

2. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–£–ù–ö–¢–´: –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –¥–æ–≥–æ–≤–æ—Ä–∞ (—Å –Ω–æ–º–µ—Ä–∞–º–∏), –∫–æ—Ç–æ—Ä—ã–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å

3. –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ü–†–ê–í–ö–ò: –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∑–∞–º–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

4. –ò–¢–û–ì–û–í–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: 
   - –°–û–ì–õ–ê–°–û–í–ê–¢–¨ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - –°–û–ì–õ–ê–°–û–í–ê–¢–¨ –° –ó–ê–ú–ï–ß–ê–ù–ò–Ø–ú–ò (–º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å –ø–æ—Å–ª–µ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫)
   - –î–û–†–ê–ë–û–¢–ê–¢–¨ (—Ç—Ä–µ–±—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
   - –û–¢–ö–õ–û–ù–ò–¢–¨ (–Ω–µ–ø—Ä–∏–µ–º–ª–µ–º—ã–µ —É—Å–ª–æ–≤–∏—è)

–û—Ç–≤–µ—á–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ, –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É. –£–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –ø—É–Ω–∫—Ç–æ–≤."""

        return –ø—Ä–æ–º–ø—Ç
    
    @classmethod
    def –≤—ã–∑–≤–∞—Ç—å_api(cls, –ø—Ä–æ–≤–∞–π–¥–µ—Ä: str, –ø—Ä–æ–º–ø—Ç: str, –∫–ª—é—á: str, folder_id: str = "") -> Tuple[bool, str]:
        """–í—ã–∑–æ–≤ AI API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"""
        if not REQUESTS_AVAILABLE:
            return False, "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ requests –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
        
        try:
            if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "openai":
                response = requests.post(
                    "https://api.openai.com/v1/chat/completions",
                    headers={
                        "Authorization": f"Bearer {–∫–ª—é—á}",
                        "Content-Type": "application/json"
                    },
                    json={
                        "model": "gpt-4o-mini",
                        "messages": [
                            {
                                "role": "system",
                                "content": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —é—Ä–∏—Å—Ç. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–≥–æ–≤–æ—Ä—ã –¥–µ—Ç–∞–ª—å–Ω–æ, —É–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."
                            },
                            {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                        ],
                        "max_tokens": 4000,
                        "temperature": 0.3
                    },
                    timeout=120
                )
                if response.status_code == 200:
                    return True, response.json()["choices"][0]["message"]["content"]
                return False, f"–û—à–∏–±–∫–∞ API: {response.status_code} - {response.text[:200]}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "anthropic":
                response = requests.post(
                    "https://api.anthropic.com/v1/messages",
                    headers={
                        "x-api-key": –∫–ª—é—á,
                        "Content-Type": "application/json",
                        "anthropic-version": "2023-06-01"
                    },
                    json={
                        "model": "claude-3-haiku-20240307",
                        "max_tokens": 4000,
                        "messages": [{"role": "user", "content": –ø—Ä–æ–º–ø—Ç}]
                    },
                    timeout=120
                )
                if response.status_code == 200:
                    return True, response.json()["content"][0]["text"]
                return False, f"–û—à–∏–±–∫–∞ API: {response.status_code}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "yandexgpt":
                if not folder_id:
                    return False, "–¢—Ä–µ–±—É–µ—Ç—Å—è Folder ID"
                response = requests.post(
                    "https://llm.api.cloud.yandex.net/foundationModels/v1/completion",
                    headers={
                        "Authorization": f"Api-Key {–∫–ª—é—á}",
                        "Content-Type": "application/json"
                    },
                    json={
                        "modelUri": f"gpt://{folder_id}/yandexgpt-lite",
                        "completionOptions": {
                            "stream": False,
                            "maxTokens": 4000,
                            "temperature": 0.3
                        },
                        "messages": [{"role": "user", "text": –ø—Ä–æ–º–ø—Ç}]
                    },
                    timeout=120
                )
                if response.status_code == 200:
                    return True, response.json()["result"]["alternatives"][0]["message"]["text"]
                return False, f"–û—à–∏–±–∫–∞ API: {response.status_code}"
            
            elif –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "gigachat":
                # GigaChat —Ç—Ä–µ–±—É–µ—Ç OAuth - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
                return False, "GigaChat —Ç—Ä–µ–±—É–µ—Ç OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä."
            
            return False, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä"
            
        except requests.exceptions.Timeout:
            return False, "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (120 —Å–µ–∫). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        except Exception as e:
            return False, f"–û—à–∏–±–∫–∞: {str(e)}"
    
    @classmethod
    def –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞: str, rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç: Dict) -> Tuple[bool, str]:
        """–ü–æ–ª–Ω—ã–π AI-–∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞"""
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        api_–∫–ª—é—á–∏ = st.session_state.get("api_–∫–ª—é—á–∏", {})
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
        
        # –ò—â–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å –∫–ª—é—á–æ–º
        –ø—Ä–æ–≤–∞–π–¥–µ—Ä = None
        –∫–ª—é—á = ""
        for pid in ["openai", "anthropic", "yandexgpt", "gigachat"]:
            if api_–∫–ª—é—á–∏.get(pid):
                –ø—Ä–æ–≤–∞–π–¥–µ—Ä = pid
                –∫–ª—é—á = api_–∫–ª—é—á–∏[pid]
                break
        
        if not –ø—Ä–æ–≤–∞–π–¥–µ—Ä:
            return False, "–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∏ –æ–¥–∏–Ω AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä. –î–æ–±–∞–≤—å—Ç–µ API-–∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö."
        
        # –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–º–ø—Ç
        –ø—Ä–æ–º–ø—Ç = cls.—Å–æ–∑–¥–∞—Ç—å_–ø—Ä–æ–º–ø—Ç_–∞–Ω–∞–ª–∏–∑–∞(—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, rag_—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—Ä–≥.get("short_name", "–ê–û ¬´–°–ü–ö¬ª"))
        
        # –í—ã–∑—ã–≤–∞–µ–º API
        folder_id = st.session_state.get("yandex_folder", "") if –ø—Ä–æ–≤–∞–π–¥–µ—Ä == "yandexgpt" else ""
        return cls.–≤—ã–∑–≤–∞—Ç—å_api(–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –ø—Ä–æ–º–ø—Ç, –∫–ª—é—á, folder_id)

# ============================================================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ============================================================================

def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(uploaded_file) -> Tuple[bool, str]:
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞"""
    if not uploaded_file:
        return False, ""
    try:
        content = uploaded_file.read()
        name = uploaded_file.name.lower()
        
        if name.endswith('.txt'):
            for enc in ['utf-8', 'cp1251', 'cp866', 'koi8-r']:
                try:
                    return True, content.decode(enc)
                except:
                    pass
            return True, content.decode('utf-8', errors='replace')
        
        elif name.endswith('.docx') and DOCX_AVAILABLE:
            doc = DocxDocument(io.BytesIO(content))
            text = '\n'.join([p.text for p in doc.paragraphs if p.text.strip()])
            return (True, text) if text else (False, "–î–æ–∫—É–º–µ–Ω—Ç –ø—É—Å—Ç–æ–π")
        
        elif name.endswith('.pdf') and PDF_AVAILABLE:
            reader = PdfReader(io.BytesIO(content))
            text = '\n'.join([p.extract_text() or '' for p in reader.pages])
            return (True, text) if text.strip() else (False, "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç")
        
        return False, "–§–æ—Ä–º–∞—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .docx, .pdf –∏–ª–∏ .txt"
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞: {str(e)}"


def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(—Å—É–º–º–∞: float, —Ñ–æ—Ä–º–∞: str, —Ç–∏–ø_—Å–¥–µ–ª–∫–∏: str, –ø–æ—Ä–æ–≥–∏: Dict = None) -> Dict:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω—ã —Ä–∏—Å–∫–∞ –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É"""
    if –ø–æ—Ä–æ–≥–∏ is None:
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
    
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {"–∑–æ–Ω–∞": "–∑–µ–ª—ë–Ω–∞—è", "–ø—Ä–∏—á–∏–Ω–∞": "", "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": False, "—Å—Ä–æ–∫": 0, "–º–∞—Ä—à—Ä—É—Ç": []}
    
    # –ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê
    if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê:
        return {
            "–∑–æ–Ω–∞": "–∫—Ä–∞—Å–Ω–∞—è",
            "–ø—Ä–∏—á–∏–Ω–∞": f"–¢–∏–ø —Å–¥–µ–ª–∫–∏ ¬´{—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}¬ª —Ç—Ä–µ–±—É–µ—Ç —É—á–∞—Å—Ç–∏—è –Æ–î",
            "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": True,
            "—Å—Ä–æ–∫": 10,
            "–º–∞—Ä—à—Ä—É—Ç": ["–Æ–î (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)", "–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        }
    
    if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5_000_000):
        return {
            "–∑–æ–Ω–∞": "–∫—Ä–∞—Å–Ω–∞—è",
            "–ø—Ä–∏—á–∏–Ω–∞": f"–°—É–º–º–∞ {—Å—É–º–º–∞:,.0f}‚ÇΩ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ {–ø–æ—Ä–æ–≥–∏['–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å']:,}‚ÇΩ",
            "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": True,
            "—Å—Ä–æ–∫": 10,
            "–º–∞—Ä—à—Ä—É—Ç": ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–Æ–î (—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞)", "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        }
    
    # –ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê
    –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã = []
    
    if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´:
        –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–¢–∏–ø: {—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}")
    
    if —Ñ–æ—Ä–º–∞ == "–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–¢–§)":
        if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100_000):
            –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–¢–§ > {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ")
    else:
        if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50_000):
            –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã.append(f"–ù–µ—Ç–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ > {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ")
    
    if –∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã:
        return {
            "–∑–æ–Ω–∞": "–∂—ë–ª—Ç–∞—è",
            "–ø—Ä–∏—á–∏–Ω–∞": "; ".join(–∂—ë–ª—Ç—ã–µ_–ø—Ä–∏—á–∏–Ω—ã),
            "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": True,
            "—Å—Ä–æ–∫": 5,
            "–º–∞—Ä—à—Ä—É—Ç": ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–°–≠–î", "–Æ–î (—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞)", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
        }
    
    # –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê
    return {
        "–∑–æ–Ω–∞": "–∑–µ–ª—ë–Ω–∞—è",
        "–ø—Ä–∏—á–∏–Ω–∞": "–ó–µ–ª—ë–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä (–ø. 4.1 –†–µ–≥–ª–∞–º–µ–Ω—Ç–∞)",
        "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": False,
        "—Å—Ä–æ–∫": 0,
        "–º–∞—Ä—à—Ä—É—Ç": ["–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä", "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ"]
    }


def –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é(–¥–∞–Ω–Ω—ã–µ: Dict):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é"""
    if "–∏—Å—Ç–æ—Ä–∏—è" not in st.session_state:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
    
    –∑–∞–ø–∏—Å—å = {
        "–¥–∞—Ç–∞": datetime.now().strftime('%d.%m.%Y %H:%M'),
        "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –¥–∞–Ω–Ω—ã–µ.get("–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç", ""),
        "–Ω–æ–º–µ—Ä": –¥–∞–Ω–Ω—ã–µ.get("–Ω–æ–º–µ—Ä", ""),
        "—Å—É–º–º–∞": –¥–∞–Ω–Ω—ã–µ.get("—Å—É–º–º–∞", 0),
        "–∑–æ–Ω–∞": –¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", ""),
        "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": –¥–∞–Ω–Ω—ã–µ.get("—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ", 0),
        "–∫—Ä–∞—Å–Ω—ã—Ö": –¥–∞–Ω–Ω—ã–µ.get("–∫—Ä–∞—Å–Ω—ã—Ö", 0),
        "–∂—ë–ª—Ç—ã—Ö": –¥–∞–Ω–Ω—ã–µ.get("–∂—ë–ª—Ç—ã—Ö", 0),
    }
    st.session_state.–∏—Å—Ç–æ—Ä–∏—è.insert(0, –∑–∞–ø–∏—Å—å)
    if len(st.session_state.–∏—Å—Ç–æ—Ä–∏—è) > 50:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = st.session_state.–∏—Å—Ç–æ—Ä–∏—è[:50]


def —ç—Ç–æ_–∞–¥–º–∏–Ω() -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    return st.session_state.get("—Ä–æ–ª—å", "") == –†–û–õ–¨_–ê–î–ú–ò–ù


# ============================================================================
# –°–¢–ò–õ–ò CSS
# ============================================================================

def –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏():
    st.markdown("""<style>
.main-header { background:linear-gradient(135deg,#1e3a5f,#2d5a87); padding:1.5rem; border-radius:12px; margin-bottom:1.5rem; color:white; }
.traffic-light { display:flex; gap:8px; margin-bottom:0.5rem; }
.traffic-light span { width:14px; height:14px; border-radius:50%; box-shadow:0 0 6px currentColor; }
.tl-red { background:#dc3545; color:#dc3545; }
.tl-yellow { background:#f0ad4e; color:#f0ad4e; }
.tl-green { background:#28a745; color:#28a745; }
.zone-card { border-radius:10px; padding:1.2rem; margin:1rem 0; border-left:5px solid; }
.zone-card.–∑–µ–ª—ë–Ω–∞—è { background:linear-gradient(135deg,#e8f5e9,#c8e6c9); border-left-color:#28a745; }
.zone-card.–∂—ë–ª—Ç–∞—è { background:linear-gradient(135deg,#fff8e1,#ffecb3); border-left-color:#f0ad4e; }
.zone-card.–∫—Ä–∞—Å–Ω–∞—è { background:linear-gradient(135deg,#ffebee,#ffcdd2); border-left-color:#dc3545; }
.admin-badge { background:#7b1fa2; color:white; padding:3px 10px; border-radius:12px; font-size:0.75rem; font-weight:bold; }
.user-badge { background:#1976d2; color:white; padding:3px 10px; border-radius:12px; font-size:0.75rem; font-weight:bold; }
.risk-card { border-radius:8px; padding:12px; margin:8px 0; border-left:4px solid; }
.risk-card.red { background:linear-gradient(90deg,#fff5f5,white); border-left-color:#dc3545; }
.risk-card.yellow { background:linear-gradient(90deg,#fffcf0,white); border-left-color:#f0ad4e; }
.metric-box { background:#f8f9fa; border-radius:8px; padding:15px; text-align:center; border:1px solid #e9ecef; }
.metric-value { font-size:1.8rem; font-weight:700; color:#1e3a5f; }
.metric-label { font-size:0.85rem; color:#6c757d; }
.ai-result { background:#e3f2fd; border:1px solid #90caf9; border-radius:8px; padding:15px; margin-top:15px; }
.api-link { background:#f5f5f5; padding:8px 12px; border-radius:6px; margin:5px 0; display:block; }
.api-link a { color:#1976d2; text-decoration:none; }
.connection-ok { color:#28a745; font-weight:bold; }
.connection-fail { color:#dc3545; font-weight:bold; }
</style>""", unsafe_allow_html=True)


# ============================================================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ============================================================================

def –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è():
    defaults = {
        "–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω": False,
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": None,
        "—Ä–æ–ª—å": –†–û–õ–¨_–Æ–ó–ï–†,
        "–¥–µ–º–æ": False,
        "—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞": "",
        "—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω": False,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã": None,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag": None,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_ai": "",
        "–∏—Å—Ç–æ—Ä–∏—è": [],
        "–æ—Ä–≥": DEFAULT_ORG_CONFIG.copy(),
        "–ø–æ—Ä–æ–≥–∏": DEFAULT_THRESHOLDS.copy(),
        "—Å—Ä–æ–∫–∏": DEFAULT_DEADLINES.copy(),
        "api_–∫–ª—é—á–∏": {p: "" for p in AI_–ü–†–û–í–ê–ô–î–ï–†–´},
        "yandex_folder": "",
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ": {},
        "—Å—Ç–∞—Ç—É—Å_api": {},
    }
    for k, v in defaults.items():
        if k not in st.session_state:
            st.session_state[k] = v

# ============================================================================
# –°–¢–†–ê–ù–ò–¶–ê –í–•–û–î–ê
# ============================================================================

def —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–≤—Ö–æ–¥–∞():
    st.markdown('''<div style="text-align:center;padding:2rem;">
<div class="traffic-light" style="justify-content:center;margin-bottom:1rem;">
    <span class="tl-red"></span><span class="tl-yellow"></span><span class="tl-green"></span>
</div>
<h1 style="color:#1e3a5f;margin-bottom:0.5rem;">üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä</h1>
<p style="color:#666;">–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ v7.5<br>
<strong>–ê–û ¬´–°–ü–ö¬ª</strong> ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</p>
</div>''', unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns([1, 2, 1])
    
    with col2:
        tab1, tab2 = st.tabs(["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"])
        
        with tab1:
            with st.form("user_form"):
                –∏–º—è = st.text_input("–§–ò–û *", placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á")
                –¥–æ–ª–∂–Ω–æ—Å—Ç—å = st.selectbox("–î–æ–ª–∂–Ω–æ—Å—Ç—å *", ["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –î–û–õ–ñ–ù–û–°–¢–ò)
                –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ = st.selectbox("–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ *", ["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø)
                
                c1, c2 = st.columns(2)
                with c1:
                    btn_user = st.form_submit_button("üöÄ –í–æ–π—Ç–∏", use_container_width=True)
                with c2:
                    btn_demo = st.form_submit_button("üìã –î–µ–º–æ", use_container_width=True)
                
                if btn_user:
                    if –∏–º—è and len(–∏–º—è) >= 3 and –¥–æ–ª–∂–Ω–æ—Å—Ç—å != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî" and –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî":
                        st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                        st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": –∏–º—è, "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": –¥–æ–ª–∂–Ω–æ—Å—Ç—å, "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ}
                        st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–Æ–ó–ï–†
                        st.session_state.–¥–µ–º–æ = False
                        st.rerun()
                    else:
                        st.error("‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è")
                
                if btn_demo:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"}
                    st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–Æ–ó–ï–†
                    st.session_state.–¥–µ–º–æ = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.rerun()
        
        with tab2:
            with st.form("admin_form"):
                –ª–æ–≥–∏–Ω = st.text_input("–õ–æ–≥–∏–Ω", placeholder="admin")
                –ø–∞—Ä–æ–ª—å = st.text_input("–ü–∞—Ä–æ–ª—å", type="password")
                
                c1, c2 = st.columns(2)
                with c1:
                    btn_admin = st.form_submit_button("üîê –í–æ–π—Ç–∏", use_container_width=True)
                with c2:
                    btn_demo_admin = st.form_submit_button("üìã –î–µ–º–æ-–∞–¥–º–∏–Ω", use_container_width=True)
                
                if btn_admin:
                    if –ª–æ–≥–∏–Ω in –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:
                        user = –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò[–ª–æ–≥–∏–Ω]
                        if user["–ø–∞—Ä–æ–ª—å_—Ö–µ—à"] == hashlib.sha256(–ø–∞—Ä–æ–ª—å.encode()).hexdigest():
                            st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                            st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": user["–∏–º—è"], "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": user["–¥–æ–ª–∂–Ω–æ—Å—Ç—å"], "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": user["–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ"]}
                            st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–ê–î–ú–ò–ù
                            st.session_state.–¥–µ–º–æ = False
                            st.rerun()
                        else:
                            st.error("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å")
                    else:
                        st.error("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
                
                if btn_demo_admin:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"}
                    st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–ê–î–ú–ò–ù
                    st.session_state.–¥–µ–º–æ = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.rerun()
            
            st.caption("üí° –£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏: admin/admin123 –∏–ª–∏ legal/legal123")


# ============================================================================
# –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨
# ============================================================================

def –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å():
    with st.sidebar:
        user = st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        is_admin = —ç—Ç–æ_–∞–¥–º–∏–Ω()
        
        badge = "admin-badge" if is_admin else "user-badge"
        badge_text = "–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†" if is_admin else "–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨"
        
        st.markdown(f'''
        <div style="background:#f8f9fa;padding:12px;border-radius:10px;margin-bottom:15px;">
            <strong>{user["–∏–º—è"]}</strong><br>
            <small style="color:#666;">{user["–¥–æ–ª–∂–Ω–æ—Å—Ç—å"]}</small><br>
            <span class="{badge}">{badge_text}</span>
        </div>
        ''', unsafe_allow_html=True)
        
        if st.button("üö™ –í—ã–π—Ç–∏", use_container_width=True):
            for k in list(st.session_state.keys()):
                del st.session_state[k]
            st.rerun()
        
        st.markdown("---")
        
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
        st.markdown(f"**{–æ—Ä–≥.get('short_name', '–ê–û ¬´–°–ü–ö¬ª')}**")
        st.caption(f"–ò–ù–ù: {–æ—Ä–≥.get('inn', '')}")
        
        st.markdown("---")
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        st.markdown(f"""
**–ü–æ—Ä–æ–≥–∏ –∑–æ–Ω:**
- üü¢ –¢–§ ‚â§ {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ
- üü¢ –ò–Ω—ã–µ ‚â§ {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ
- üü° –¥–æ {–ø–æ—Ä–æ–≥–∏['–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å']:,}‚ÇΩ
- üî¥ > {–ø–æ—Ä–æ–≥–∏['–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å']:,}‚ÇΩ
        """)
        
        # –°—Ç–∞—Ç—É—Å AI
        api_–∫–ª—é—á–∏ = st.session_state.get("api_–∫–ª—é—á–∏", {})
        –∞–∫—Ç–∏–≤–Ω—ã–µ = [p for p, k in api_–∫–ª—é—á–∏.items() if k]
        
        st.markdown("---")
        if –∞–∫—Ç–∏–≤–Ω—ã–µ:
            st.success(f"ü§ñ AI: {', '.join([AI_–ü–†–û–í–ê–ô–î–ï–†–´[p]['–Ω–∞–∑–≤–∞–Ω–∏–µ'].split()[0] for p in –∞–∫—Ç–∏–≤–Ω—ã–µ])}")
        else:
            st.warning("ü§ñ AI –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω")
            if is_admin:
                st.caption("–î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
        
        if is_admin:
            st.markdown("---")
            st.info("üîì –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ê–ù–ê–õ–ò–ó–ê (–ì–õ–ê–í–ù–ê–Ø)
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞():
    –¥–µ–º–æ = st.session_state.–¥–µ–º–æ
    
    st.markdown("### üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–≥–æ–≤–æ—Ä–∞")
    
    c1, c2 = st.columns(2)
    with c1:
        –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç = st.text_input("–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç *", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç"] if –¥–µ–º–æ else "", placeholder="–û–û–û ¬´–ù–∞–∑–≤–∞–Ω–∏–µ¬ª")
        –Ω–æ–º–µ—Ä = st.text_input("–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞"] if –¥–µ–º–æ else "", placeholder="2025/001")
        –¥–∞—Ç–∞ = st.date_input("–î–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞"] if –¥–µ–º–æ else date.today())
    
    with c2:
        —Å—É–º–º–∞_default = f"{–î–ï–ú–û_–î–ê–ù–ù–´–ï['—Å—É–º–º–∞']:,}".replace(",", " ") if –¥–µ–º–æ else ""
        —Å—É–º–º–∞_str = st.text_input("–°—É–º–º–∞ (‚ÇΩ)", value=—Å—É–º–º–∞_default, placeholder="1 500 000")
        —Å—É–º–º–∞ = 0
        if —Å—É–º–º–∞_str:
            try:
                —Å—É–º–º–∞ = float(re.sub(r'[^\d.]', '', —Å—É–º–º–∞_str.replace(',', '.').replace(' ', '')))
            except:
                pass
        
        —Ñ–æ—Ä–º–∞ = st.selectbox("–§–æ—Ä–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞", –§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê)
        —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = st.selectbox("–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø —Å–¥–µ–ª–∫–∏", ["‚Äî –û–±—ã—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä ‚Äî"] + –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê + –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´)
        if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ == "‚Äî –û–±—ã—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä ‚Äî":
            —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = ""
    
    # –ö–Ω–æ–ø–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã
    col_btn1, col_btn2, col_btn3 = st.columns(3)
    with col_btn1:
        if st.button("üö¶ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–æ–Ω—É", type="primary", use_container_width=True):
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(—Å—É–º–º–∞, —Ñ–æ—Ä–º–∞, —Ç–∏–ø_—Å–¥–µ–ª–∫–∏)
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            st.session_state.—Ç–µ–∫—É—â–∏–µ_–¥–∞–Ω–Ω—ã–µ = {"–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, "–Ω–æ–º–µ—Ä": –Ω–æ–º–µ—Ä, "—Å—É–º–º–∞": —Å—É–º–º–∞}
            st.rerun()
    
    with col_btn2:
        if st.button("üìù –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ", use_container_width=True):
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    with col_btn3:
        if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë", use_container_width=True):
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã = None
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag = None
            st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_ai = ""
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = ""
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    # –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–æ–Ω—ã
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã:
        —Ä–µ–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã
        –∑–æ–Ω–∞ = —Ä–µ–∑["–∑–æ–Ω–∞"]
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–æ–Ω–∞, "‚ö™")
        –Ω–∞–∑–≤–∞–Ω–∏–µ = {"–∑–µ–ª—ë–Ω–∞—è": "–ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê", "–∂—ë–ª—Ç–∞—è": "–ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê", "–∫—Ä–∞—Å–Ω–∞—è": "–ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê"}.get(–∑–æ–Ω–∞, "")
        
        st.markdown(f'''<div class="zone-card {–∑–æ–Ω–∞}">
            <h3 style="margin:0;">{emoji} {–Ω–∞–∑–≤–∞–Ω–∏–µ}</h3>
            <p style="margin:8px 0;">{—Ä–µ–∑["–ø—Ä–∏—á–∏–Ω–∞"]}</p>
            <p style="margin:0;">
                <strong>–¢—Ä–µ–±—É–µ—Ç—Å—è –Æ–î:</strong> {"–î–∞" if —Ä–µ–∑["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] else "–ù–µ—Ç"} | 
                <strong>–°—Ä–æ–∫:</strong> {—Ä–µ–∑["—Å—Ä–æ–∫"]} –¥–Ω.
            </p>
        </div>''', unsafe_allow_html=True)
        
        if —Ä–µ–∑.get("–º–∞—Ä—à—Ä—É—Ç"):
            st.info("üìç –ú–∞—Ä—à—Ä—É—Ç: " + " ‚Üí ".join(—Ä–µ–∑["–º–∞—Ä—à—Ä—É—Ç"]))
    
    st.markdown("---")
    
    # ========== –ó–ê–ì–†–£–ó–ö–ê –¢–ï–ö–°–¢–ê –î–û–ì–û–í–û–†–ê ==========
    st.markdown("### üìÑ –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
    st.info("üí° –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª **–ò–õ–ò** –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é")
    
    —Ñ–∞–π–ª = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (DOCX, PDF, TXT)", type=["txt", "docx", "pdf"], key="file_uploader")
    
    if —Ñ–∞–π–ª:
        ok, —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(—Ñ–∞–π–ª)
        if ok:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç[:300000]
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = True
            st.success(f"‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: {len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞):,} —Å–∏–º–≤–æ–ª–æ–≤")
        else:
            st.error(f"‚ùå {—Ä–µ–∑—É–ª—å—Ç–∞—Ç}")
    
    if not st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω:
        —Ç–µ–∫—Å—Ç = st.text_area(
            "–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞:",
            value=st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞,
            height=200,
            placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤)..."
        )
        if —Ç–µ–∫—Å—Ç != st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ç–µ–∫—Å—Ç
    else:
        st.info(f"üìÑ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª ({len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞):,} —Å–∏–º–≤–æ–ª–æ–≤)")
        if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª"):
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = ""
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    # ========== –í–´–ë–û–† –¢–ò–ü–û–í–û–ô –§–û–†–ú–´ ==========
    –≤—Å–µ_—Ç—Ñ = {**–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´, **st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})}
    
    # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞
    –∞–≤—Ç–æ_—Ç—Ñ = None
    –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å = 0
    if st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ and len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) > 100:
        –∞–≤—Ç–æ_—Ç—Ñ, –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∏—á–∏–Ω–∞ = RAG–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø_–¥–æ–≥–æ–≤–æ—Ä–∞(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞)
        if –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å >= 0.4 and –∞–≤—Ç–æ_—Ç—Ñ:
            st.success(f"üîç –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: **{–≤—Å–µ_—Ç—Ñ[–∞–≤—Ç–æ_—Ç—Ñ]['–Ω–∞–∑–≤–∞–Ω–∏–µ']}** (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å {–∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å*100:.0f}%)")
    
    –æ–ø—Ü–∏–∏ = [("‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É ‚Äî", None)]
    for –∫–æ–¥, —Ç—Ñ in –≤—Å–µ_—Ç—Ñ.items():
        –æ–ø—Ü–∏–∏.append((f"{—Ç—Ñ['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({—Ç—Ñ['–∫–æ–¥']})", –∫–æ–¥))
    
    # –ü—Ä–µ–¥–≤—ã–±–æ—Ä –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã
    idx = 0
    if –∞–≤—Ç–æ_—Ç—Ñ and –∞–≤—Ç–æ_—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å >= 0.4:
        for i, (_, –∫–æ–¥) in enumerate(–æ–ø—Ü–∏–∏):
            if –∫–æ–¥ == –∞–≤—Ç–æ_—Ç—Ñ:
                idx = i
                break
    
    –≤—ã–±–æ—Ä = st.selectbox("–°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–æ–π:", –æ–ø—Ü–∏–∏, format_func=lambda x: x[0], index=idx)
    –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ = –≤—ã–±–æ—Ä[1] if –≤—ã–±–æ—Ä else None
    
    st.markdown("---")
    
    # ========== –ö–ù–û–ü–ö–ò –ê–ù–ê–õ–ò–ó–ê: RAG –ò AI ==========
    st.markdown("### üîç –ê–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞")
    
    api_–∫–ª—é—á–∏ = st.session_state.get("api_–∫–ª—é—á–∏", {})
    –µ—Å—Ç—å_–∫–ª—é—á = any(api_–∫–ª—é—á–∏.get(p) for p in AI_–ü–†–û–í–ê–ô–î–ï–†–´)
    
    col_a1, col_a2 = st.columns(2)
    
    with col_a1:
        st.markdown("#### üìä RAG-—Å–ª–∏—á–µ–Ω–∏–µ —Å –¢–§")
        st.caption("–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–æ–π, –ø–æ–∏—Å–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –∏ —Ä–∏—Å–∫–æ–≤")
        
        btn_rag = st.button("üîç –°–ª–∏—á–∏—Ç—å —Å —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–æ–π", type="primary", use_container_width=True)
    
    with col_a2:
        st.markdown("#### ü§ñ AI-—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞")
        st.caption("–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏")
        
        if –µ—Å—Ç—å_–∫–ª—é—á:
            btn_ai = st.button("ü§ñ –ó–∞–ø—É—Å—Ç–∏—Ç—å AI-–∞–Ω–∞–ª–∏–∑", type="primary", use_container_width=True)
        else:
            st.button("ü§ñ AI-–∞–Ω–∞–ª–∏–∑ (–Ω–µ—Ç –∫–ª—é—á–∞)", disabled=True, use_container_width=True)
            st.warning("‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ API-–∫–ª—é—á –≤ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
            btn_ai = False
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ RAG
    if btn_rag:
        if len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) < 100:
            st.error("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤)")
        elif not –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ:
            st.error("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è")
        else:
            with st.spinner("üîÑ RAG-–∞–Ω–∞–ª–∏–∑... –°–ª–∏—á–µ–Ω–∏–µ —Å —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º–æ–π..."):
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç = RAG–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.–ø–æ–ª–Ω—ã–π_–∞–Ω–∞–ª–∏–∑(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ)
                st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            st.rerun()
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ AI
    if btn_ai and –µ—Å—Ç—å_–∫–ª—é—á:
        if len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) < 100:
            st.error("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞")
        elif not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag:
            st.warning("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ RAG-—Å–ª–∏—á–µ–Ω–∏–µ —Å –¢–§")
        else:
            –∞–∫—Ç–∏–≤–Ω—ã–π = next((p for p in AI_–ü–†–û–í–ê–ô–î–ï–†–´ if api_–∫–ª—é—á–∏.get(p)), None)
            with st.spinner(f"ü§ñ AI-–∞–Ω–∞–ª–∏–∑ ({AI_–ü–†–û–í–ê–ô–î–ï–†–´[–∞–∫—Ç–∏–≤–Ω—ã–π]['–Ω–∞–∑–≤–∞–Ω–∏–µ']})... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥..."):
                ok, —Ä–µ–∑—É–ª—å—Ç–∞—Ç = AI–ö–ª–∏–µ–Ω—Ç.–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag)
                if ok:
                    st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_ai = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                else:
                    st.error(f"‚ùå {—Ä–µ–∑—É–ª—å—Ç–∞—Ç}")
            st.rerun()
    
    # ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í RAG ==========
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag:
        –ø–æ–∫–∞–∑–∞—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_rag(st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag)
    
    # ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í AI ==========
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_ai:
        st.markdown("---")
        st.markdown("### ü§ñ –≠–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ AI")
        st.markdown(f'<div class="ai-result"><pre style="white-space:pre-wrap;font-family:inherit;">{st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_ai}</pre></div>', unsafe_allow_html=True)


def –ø–æ–∫–∞–∑–∞—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_rag(—Ä–µ–∑: Dict):
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ RAG-–∞–Ω–∞–ª–∏–∑–∞"""
    st.markdown("---")
    st.markdown(f"### üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–ª–∏—á–µ–Ω–∏—è: {—Ä–µ–∑.get('–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ', '')}")
    
    # –ú–µ—Ç—Ä–∏–∫–∏
    col1, col2, col3, col4 = st.columns(4)
    
    —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ = —Ä–µ–∑.get("—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ", 0)
    —Ü–≤–µ—Ç = "#28a745" if —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ >= 70 else ("#f0ad4e" if —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ >= 50 else "#dc3545")
    
    with col1:
        st.markdown(f'''<div class="metric-box">
            <div class="metric-value" style="color:{—Ü–≤–µ—Ç};">{—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:.0f}%</div>
            <div class="metric-label">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§</div>
        </div>''', unsafe_allow_html=True)
    
    with col2:
        st.markdown(f'''<div class="metric-box">
            <div class="metric-value" style="color:#dc3545;">{—Ä–µ–∑.get("–∫—Ä–∞—Å–Ω—ã—Ö", 0)}</div>
            <div class="metric-label">üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö</div>
        </div>''', unsafe_allow_html=True)
    
    with col3:
        st.markdown(f'''<div class="metric-box">
            <div class="metric-value" style="color:#f0ad4e;">{—Ä–µ–∑.get("–∂—ë–ª—Ç—ã—Ö", 0)}</div>
            <div class="metric-label">üü° –ó–∞–º–µ—á–∞–Ω–∏–π</div>
        </div>''', unsafe_allow_html=True)
    
    with col4:
        –Ω–∞–π–¥–µ–Ω–æ = len(—Ä–µ–∑.get("–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤", {}).get("–Ω–∞–π–¥–µ–Ω–Ω—ã–µ", []))
        st.markdown(f'''<div class="metric-box">
            <div class="metric-value" style="color:#28a745;">{–Ω–∞–π–¥–µ–Ω–æ}</div>
            <div class="metric-label">‚úÖ –†–∞–∑–¥–µ–ª–æ–≤</div>
        </div>''', unsafe_allow_html=True)
    
    # –†–µ–∑—é–º–µ
    st.markdown(f"**{—Ä–µ–∑.get('—Ä–µ–∑—é–º–µ', '')}**")
    
    # –†–∏—Å–∫–∏
    —Ä–∏—Å–∫–∏ = —Ä–µ–∑.get("—Ä–∏—Å–∫–∏", [])
    –∫—Ä–∞—Å–Ω—ã–µ = [r for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∫—Ä–∞—Å–Ω—ã–π"]
    –∂—ë–ª—Ç—ã–µ = [r for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∂—ë–ª—Ç—ã–π"]
    
    if –∫—Ä–∞—Å–Ω—ã–µ:
        with st.expander(f"üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò ({len(–∫—Ä–∞—Å–Ω—ã–µ)})", expanded=True):
            for —Ä in –∫—Ä–∞—Å–Ω—ã–µ:
                st.markdown(f'''<div class="risk-card red">
                    <strong>‚ö†Ô∏è {—Ä["–ø—Ä–æ–±–ª–µ–º–∞"]}</strong>
                    {f'<br><small>–ü—É–Ω–∫—Ç: {—Ä["–ø—É–Ω–∫—Ç"]}</small>' if —Ä.get("–ø—É–Ω–∫—Ç") and —Ä["–ø—É–Ω–∫—Ç"] != "‚Äî" else ""}
                    <br><small style="color:#666;">–ö–æ–Ω—Ç–µ–∫—Å—Ç: {—Ä.get("–∫–æ–Ω—Ç–µ–∫—Å—Ç", "")[:200]}</small>
                    <br><br><strong>üìã –≠—Ç–∞–ª–æ–Ω:</strong> {—Ä.get("—ç—Ç–∞–ª–æ–Ω", "‚Äî")}
                    <br><strong>‚û°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> {—Ä.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "")}
                </div>''', unsafe_allow_html=True)
    
    if –∂—ë–ª—Ç—ã–µ:
        with st.expander(f"üü° –ó–ê–ú–ï–ß–ê–ù–ò–Ø ({len(–∂—ë–ª—Ç—ã–µ)})"):
            for —Ä in –∂—ë–ª—Ç—ã–µ:
                st.markdown(f'''<div class="risk-card yellow">
                    <strong>‚ö° {—Ä["–ø—Ä–æ–±–ª–µ–º–∞"]}</strong>
                    <br><strong>üìã –≠—Ç–∞–ª–æ–Ω:</strong> {—Ä.get("—ç—Ç–∞–ª–æ–Ω", "‚Äî")}
                    <br><strong>‚û°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> {—Ä.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "")}
                </div>''', unsafe_allow_html=True)
    
    # –°—Ç—Ä—É–∫—Ç—É—Ä–∞
    –∞–Ω–∞–ª–∏–∑ = —Ä–µ–∑.get("–∞–Ω–∞–ª–∏–∑_—Ä–∞–∑–¥–µ–ª–æ–≤", {})
    if –∞–Ω–∞–ª–∏–∑.get("–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"):
        with st.expander("üìã –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã"):
            for —Ä in –∞–Ω–∞–ª–∏–∑["–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ"]:
                —Å—Ç–∞—Ç—É—Å = "‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô" if —Ä.get("–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω") else "‚ÑπÔ∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π"
                st.markdown(f"- {—Å—Ç–∞—Ç—É—Å}: **{—Ä['–Ω–∞–∑–≤–∞–Ω–∏–µ']}**")

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –û–¢–ß–Å–¢–û–í
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤():
    st.markdown("### üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤")
    
    if not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã and not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag:
        st.info("‚ÑπÔ∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ê–Ω–∞–ª–∏–∑¬ª")
        return
    
    –¥–∞–Ω–Ω—ã–µ = st.session_state.get("—Ç–µ–∫—É—â–∏–µ_–¥–∞–Ω–Ω—ã–µ", {})
    –∑–æ–Ω–∞ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã or {}
    rag = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_rag or {}
    
    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"""
**–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:** {–¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ù–µ —É–∫–∞–∑–∞–Ω')}  
**–ù–æ–º–µ—Ä:** {–¥–∞–Ω–Ω—ã–µ.get('–Ω–æ–º–µ—Ä', '–ù–µ —É–∫–∞–∑–∞–Ω')}  
**–°—É–º–º–∞:** {–¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0):,.0f} ‚ÇΩ
        """)
    with col2:
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–æ–Ω–∞.get('–∑–æ–Ω–∞', ''), "‚ö™")
        st.markdown(f"""
**–ó–æ–Ω–∞:** {emoji} {–∑–æ–Ω–∞.get('–∑–æ–Ω–∞', '–ù/–î').upper()}  
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§:** {rag.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.0f}%  
**–†–∏—Å–∫–æ–≤:** üî¥ {rag.get('–∫—Ä–∞—Å–Ω—ã—Ö', 0)} / üü° {rag.get('–∂—ë–ª—Ç—ã—Ö', 0)}
        """)
    
    st.markdown("---")
    
    if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é", use_container_width=True):
        –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é({
            "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', ''),
            "–Ω–æ–º–µ—Ä": –¥–∞–Ω–Ω—ã–µ.get('–Ω–æ–º–µ—Ä', ''),
            "—Å—É–º–º–∞": –¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0),
            "–∑–æ–Ω–∞": –∑–æ–Ω–∞.get('–∑–æ–Ω–∞', ''),
            "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": rag.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0),
            "–∫—Ä–∞—Å–Ω—ã—Ö": rag.get('–∫—Ä–∞—Å–Ω—ã—Ö', 0),
            "–∂—ë–ª—Ç—ã—Ö": rag.get('–∂—ë–ª—Ç—ã—Ö', 0),
        })
        st.success("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏—é!")


# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ò–°–¢–û–†–ò–ò
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏():
    st.markdown("### üìú –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫")
    
    –∏—Å—Ç–æ—Ä–∏—è = st.session_state.get("–∏—Å—Ç–æ—Ä–∏—è", [])
    
    if not –∏—Å—Ç–æ—Ä–∏—è:
        st.info("‚ÑπÔ∏è –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.")
        return
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    col1, col2, col3, col4 = st.columns(4)
    col1.metric("üìä –í—Å–µ–≥–æ", len(–∏—Å—Ç–æ—Ä–∏—è))
    col2.metric("üü¢ –ó–µ–ª—ë–Ω—ã—Ö", sum(1 for h in –∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∑–µ–ª—ë–Ω–∞—è'))
    col3.metric("üü° –ñ—ë–ª—Ç—ã—Ö", sum(1 for h in –∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∂—ë–ª—Ç–∞—è'))
    col4.metric("üî¥ –ö—Ä–∞—Å–Ω—ã—Ö", sum(1 for h in –∏—Å—Ç–æ—Ä–∏—è if h.get('–∑–æ–Ω–∞') == '–∫—Ä–∞—Å–Ω–∞—è'))
    
    st.markdown("---")
    
    for –∑ in –∏—Å—Ç–æ—Ä–∏—è:
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑.get("–∑–æ–Ω–∞", ""), "‚ö™")
        with st.expander(f"{emoji} {–∑.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ù/–î')} | {–∑.get('–¥–∞—Ç–∞', '')}"):
            st.markdown(f"""
**–ù–æ–º–µ—Ä:** {–∑.get('–Ω–æ–º–µ—Ä', '–ù/–î')}  
**–°—É–º–º–∞:** {–∑.get('—Å—É–º–º–∞', 0):,.0f} ‚ÇΩ  
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§:** {–∑.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.0f}%  
**–†–∏—Å–∫–æ–≤:** üî¥ {–∑.get('–∫—Ä–∞—Å–Ω—ã—Ö', 0)} / üü° {–∑.get('–∂—ë–ª—Ç—ã—Ö', 0)}
            """)
    
    st.markdown("---")
    if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"):
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
        st.rerun()

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ù–ê–°–¢–†–û–ï–ö (–¢–û–õ–¨–ö–û –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†)
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫():
    st.markdown("### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã")
    st.success("üîì –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
    
    tabs = st.tabs(["üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "üìä –ü–æ—Ä–æ–≥–∏", "üîë API-–∫–ª—é—á–∏", "üìÇ –¢–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã"])
    
    # ========== –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø ==========
    with tabs[0]:
        st.markdown("#### üè¢ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏")
        
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
        
        c1, c2 = st.columns(2)
        with c1:
            new_full = st.text_input("–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("full_name", ""))
            new_short = st.text_input("–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("short_name", ""))
            new_inn = st.text_input("–ò–ù–ù", value=–æ—Ä–≥.get("inn", ""))
        with c2:
            new_kpp = st.text_input("–ö–ü–ü", value=–æ—Ä–≥.get("kpp", ""))
            new_dir = st.text_input("–§–ò–û –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞", value=–æ—Ä–≥.get("director_name", ""))
            new_pos = st.text_input("–î–æ–ª–∂–Ω–æ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞", value=–æ—Ä–≥.get("director_position", ""))
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã", key="save_org"):
            st.session_state.–æ—Ä–≥ = {
                "full_name": new_full, "short_name": new_short,
                "inn": new_inn, "kpp": new_kpp,
                "director_name": new_dir, "director_position": new_pos
            }
            st.success("‚úÖ –†–µ–∫–≤–∏–∑–∏—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
    
    # ========== –ü–û–†–û–ì–ò ==========
    with tabs[1]:
        st.markdown("#### üìä –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞")
        st.info("‚ÑπÔ∏è –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∑–æ–Ω—ã —Ä–∏—Å–∫–∞")
        
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        
        st.markdown("##### üü¢ –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê")
        c1, c2 = st.columns(2)
        with c1:
            new_tf = st.number_input("–ú–∞–∫—Å. —Å—É–º–º–∞ –¢–§ (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100000), step=10000)
        with c2:
            new_ntf = st.number_input("–ú–∞–∫—Å. —Å—É–º–º–∞ –Ω–µ—Ç–∏–ø–æ–≤–æ–π (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50000), step=10000)
        
        st.markdown("##### üü° –ñ–Å–õ–¢–ê–Ø ‚Üí üî¥ –ö–†–ê–°–ù–ê–Ø")
        new_yellow = st.number_input("–ü–æ—Ä–æ–≥ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω—ã (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5000000), step=100000)
        
        c3, c4 = st.columns(2)
        with c3:
            new_tender = st.number_input("–¢–µ–Ω–¥–µ—Ä ‚Üí –∫—Ä–∞—Å–Ω–∞—è –æ—Ç (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è", 3000000), step=100000)
        with c4:
            new_single = st.number_input("–ï–¥–∏–Ω—Å—Ç–≤. –ø–æ—Å—Ç–∞–≤—â–∏–∫ ‚Üí –∂—ë–ª—Ç–∞—è –æ—Ç (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫", 100000), step=10000)
        
        st.markdown("##### ‚è±Ô∏è –°—Ä–æ–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (–¥–Ω–µ–π)")
        —Å—Ä–æ–∫–∏ = st.session_state.get("—Å—Ä–æ–∫–∏", DEFAULT_DEADLINES)
        c5, c6, c7 = st.columns(3)
        with c5:
            new_std = st.number_input("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", 5), min_value=1)
        with c6:
            new_ext = st.number_input("–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", 10), min_value=1)
        with c7:
            new_urg = st.number_input("–°—Ä–æ—á–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ä–æ—á–Ω—ã–π", 1), min_value=1)
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏", key="save_thresholds"):
            st.session_state.–ø–æ—Ä–æ–≥–∏ = {
                "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": new_tf, "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": new_ntf,
                "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": new_yellow, "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": new_tender,
                "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": new_single
            }
            st.session_state.—Å—Ä–æ–∫–∏ = {"—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": new_std, "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": new_ext, "—Å—Ä–æ—á–Ω—ã–π": new_urg}
            st.success("‚úÖ –ü–æ—Ä–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
    
    # ========== API-–ö–õ–Æ–ß–ò ==========
    with tabs[2]:
        st.markdown("#### üîë API-–∫–ª—é—á–∏ –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤")
        st.info("‚ÑπÔ∏è –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã AI-–∞–Ω–∞–ª–∏–∑–∞")
        
        api = st.session_state.get("api_–∫–ª—é—á–∏", {})
        
        for pid, info in AI_–ü–†–û–í–ê–ô–î–ï–†–´.items():
            st.markdown(f"##### {info['–Ω–∞–∑–≤–∞–Ω–∏–µ']}")
            
            # –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞
            st.markdown(f'''<div class="api-link">
                üîó <a href="{info['url_keys']}" target="_blank">{info['url_keys']}</a><br>
                <small>{info['–æ–ø–∏—Å–∞–Ω–∏–µ']}</small><br>
                <small>üí∞ {info['—Ü–µ–Ω–∞']}</small>
            </div>''', unsafe_allow_html=True)
            
            c1, c2 = st.columns([4, 1])
            with c1:
                —Ç–µ–∫—É—â–∏–π = api.get(pid, "")
                –Ω–æ–≤—ã–π = st.text_input(
                    f"API-–∫–ª—é—á {pid}",
                    type="password",
                    value=—Ç–µ–∫—É—â–∏–π,
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á...",
                    key=f"api_{pid}",
                    label_visibility="collapsed"
                )
                if –Ω–æ–≤—ã–π != —Ç–µ–∫—É—â–∏–π:
                    st.session_state.api_–∫–ª—é—á–∏[pid] = –Ω–æ–≤—ã–π
            
            with c2:
                if api.get(pid):
                    if st.button("üîç", key=f"test_{pid}", help="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"):
                        with st.spinner("..."):
                            folder = st.session_state.get("yandex_folder", "") if pid == "yandexgpt" else ""
                            ok, msg, _ = AI–ö–ª–∏–µ–Ω—Ç.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ(pid, api[pid], folder)
                            st.session_state.—Å—Ç–∞—Ç—É—Å_api[pid] = {"ok": ok, "msg": msg}
                        st.rerun()
            
            # –°—Ç–∞—Ç—É—Å
            —Å—Ç–∞—Ç—É—Å = st.session_state.get("—Å—Ç–∞—Ç—É—Å_api", {}).get(pid, {})
            if —Å—Ç–∞—Ç—É—Å:
                if —Å—Ç–∞—Ç—É—Å.get("ok"):
                    st.markdown(f'<span class="connection-ok">{—Å—Ç–∞—Ç—É—Å["msg"]}</span>', unsafe_allow_html=True)
                else:
                    st.markdown(f'<span class="connection-fail">{—Å—Ç–∞—Ç—É—Å["msg"]}</span>', unsafe_allow_html=True)
            
            st.markdown("---")
        
        # YandexGPT Folder ID
        st.markdown("##### YandexGPT Folder ID")
        st.caption("–ü–æ–ª—É—á–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞ ‚Üí –ö–∞—Ç–∞–ª–æ–≥–∏")
        new_folder = st.text_input("Folder ID", value=st.session_state.get("yandex_folder", ""), placeholder="b1g...")
        if new_folder != st.session_state.get("yandex_folder", ""):
            st.session_state.yandex_folder = new_folder
        
        st.markdown("---")
        if st.button("üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", use_container_width=True):
            with st.spinner("–ü—Ä–æ–≤–µ—Ä–∫–∞..."):
                for pid in AI_–ü–†–û–í–ê–ô–î–ï–†–´:
                    key = st.session_state.api_–∫–ª—é—á–∏.get(pid, "")
                    if key:
                        folder = st.session_state.get("yandex_folder", "") if pid == "yandexgpt" else ""
                        ok, msg, _ = AI–ö–ª–∏–µ–Ω—Ç.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ(pid, key, folder)
                        st.session_state.—Å—Ç–∞—Ç—É—Å_api[pid] = {"ok": ok, "msg": msg}
            st.rerun()
    
    # ========== –¢–ò–ü–û–í–´–ï –§–û–†–ú–´ ==========
    with tabs[3]:
        st.markdown("#### üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏")
        
        st.markdown("##### üìã –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã")
        for –∫–æ–¥, —Ç—Ñ in –¢–ò–ü–û–í–´–ï_–§–û–†–ú–´.items():
            with st.expander(f"‚ö™ {—Ç—Ñ['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({—Ç—Ñ['–∫–æ–¥']})"):
                st.markdown(f"""
**–í–µ—Ä—Å–∏—è:** {—Ç—Ñ.get('–≤–µ—Ä—Å–∏—è', '')}  
**–ù–∞—à–∞ —Ä–æ–ª—å:** {—Ç—Ñ.get('–Ω–∞—à–∞_—Ä–æ–ª—å', '')}  
**–û–ø–∏—Å–∞–Ω–∏–µ:** {—Ç—Ñ.get('–æ–ø–∏—Å–∞–Ω–∏–µ', '')}  
**–†–∞–∑–¥–µ–ª–æ–≤:** {len(—Ç—Ñ.get('—Ä–∞–∑–¥–µ–ª—ã', {}))}  
**–†–∏—Å–∫–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:** {len(—Ç—Ñ.get('—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã', []))}
                """)
                
                if —Ç—Ñ.get("—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è"):
                    st.markdown("**–≠—Ç–∞–ª–æ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:**")
                    for k, v in —Ç—Ñ["—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è"].items():
                        st.markdown(f"- {k}: {v}")
        
        st.markdown("---")
        st.markdown("##### üîµ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ—Ä–º—ã")
        
        user_tf = st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})
        if user_tf:
            for –∫–æ–¥, —Ç—Ñ in list(user_tf.items()):
                c1, c2 = st.columns([4, 1])
                with c1:
                    st.markdown(f"üîµ **{—Ç—Ñ.get('–Ω–∞–∑–≤–∞–Ω–∏–µ', –∫–æ–¥)}** ({—Ç—Ñ.get('–∫–æ–¥', '')})")
                with c2:
                    if st.button("üóëÔ∏è", key=f"del_tf_{–∫–æ–¥}"):
                        del st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[–∫–æ–¥]
                        st.rerun()
        else:
            st.info("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ—Ä–º—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã")
        
        st.markdown("---")
        st.markdown("##### ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É")
        
        with st.expander("üìù –°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é"):
            new_code = st.text_input("–ö–æ–¥ —Ñ–æ—Ä–º—ã", placeholder="–º–æ—è_—Ñ–æ—Ä–º–∞")
            new_name = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ", placeholder="–î–æ–≥–æ–≤–æ—Ä...")
            new_role = st.selectbox("–ù–∞—à–∞ —Ä–æ–ª—å", ["–ó–∞–∫–∞–∑—á–∏–∫", "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å", "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–ü—Ä–æ–¥–∞–≤–µ—Ü", "–ü–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å"])
            new_markers = st.text_input("–ú–∞—Ä–∫–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)", placeholder="–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –∑–∞–∫–∞–∑—á–∏–∫, —É—Å–ª—É–≥–∏")
            
            if st.button("‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É"):
                if new_code and new_name:
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[new_code] = {
                        "–Ω–∞–∑–≤–∞–Ω–∏–µ": new_name,
                        "–∫–æ–¥": f"–¢–§-–°–ü–ö-{new_code.upper()}",
                        "–≤–µ—Ä—Å–∏—è": "2025.1",
                        "–Ω–∞—à–∞_—Ä–æ–ª—å": new_role,
                        "–º–∞—Ä–∫–µ—Ä—ã": [m.strip() for m in new_markers.split(",") if m.strip()],
                        "—Ä–∞–∑–¥–µ–ª—ã": {},
                        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [],
                        "—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ_—É—Å–ª–æ–≤–∏—è": {}
                    }
                    st.success(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {new_name}")
                    st.rerun()
                else:
                    st.error("–£–∫–∞–∂–∏—Ç–µ –∫–æ–¥ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ")
        
        with st.expander("üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON"):
            json_file = st.file_uploader("JSON-—Ñ–∞–π–ª", type=["json"], key="tf_json")
            if json_file:
                try:
                    data = json.loads(json_file.read().decode())
                    st.json(data)
                    if st.button("‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å"):
                        key = data.get("–∫–æ–¥", "–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è").lower().replace("-", "_").replace(" ", "_")
                        st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[key] = data
                        st.success("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ!")
                        st.rerun()
                except:
                    st.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON")

# ============================================================================
# –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# ============================================================================

def –≥–ª–∞–≤–Ω–∞—è():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
    is_admin = —ç—Ç–æ_–∞–¥–º–∏–Ω()
    
    st.markdown(f'''
    <div class="main-header">
        <div class="traffic-light">
            <span class="tl-red"></span>
            <span class="tl-yellow"></span>
            <span class="tl-green"></span>
        </div>
        <h2 style="margin:0;">üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä <small style="opacity:0.7;">v7.5</small></h2>
        <div style="opacity:0.9;margin-top:5px;">{–æ—Ä–≥.get("short_name", "–ê–û ¬´–°–ü–ö¬ª")} ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</div>
    </div>
    ''', unsafe_allow_html=True)
    
    –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å()
    
    # –í–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    if is_admin:
        tabs = st.tabs(["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è", "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"])
        
        with tabs[0]:
            –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞()
        with tabs[1]:
            –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤()
        with tabs[2]:
            –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏()
        with tabs[3]:
            –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫()
    else:
        tabs = st.tabs(["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è"])
        
        with tabs[0]:
            –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞()
        with tabs[1]:
            –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤()
        with tabs[2]:
            –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏()


# ============================================================================
# MAIN
# ============================================================================

def main():
    –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏()
    –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è()
    
    if not st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
        —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–≤—Ö–æ–¥–∞()
    else:
        –≥–ª–∞–≤–Ω–∞—è()


if __name__ == "__main__":
    main()
