"""
–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.4
–ê–û ¬´–°–ü–ö¬ª ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤

–ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
"""

import streamlit as st
import re, json, hashlib, io, time
from datetime import datetime, date
from typing import Dict, List, Tuple, Optional, Any
from dataclasses import dataclass, field
from enum import Enum

# ============================================================================
# –ë–ò–ë–õ–ò–û–¢–ï–ö–ò
# ============================================================================

DOCX_AVAILABLE = False
PDF_AVAILABLE = False
REQUESTS_AVAILABLE = False

try:
    from docx import Document as DocxDocument
    DOCX_AVAILABLE = True
except ImportError:
    pass

try:
    from PyPDF2 import PdfReader
    PDF_AVAILABLE = True
except ImportError:
    pass

try:
    import requests
    REQUESTS_AVAILABLE = True
except ImportError:
    pass

# ============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò
# ============================================================================

st.set_page_config(
    page_title="–†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä v7.4 | –°–ü–ö",
    page_icon="üö¶",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================================
# –ö–û–ù–°–¢–ê–ù–¢–´
# ============================================================================

DEFAULT_ORG_CONFIG = {
    "full_name": '–ê–∫—Ü–∏–æ–Ω–µ—Ä–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ ¬´–°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª',
    "short_name": '–ê–û ¬´–°–ü–ö¬ª',
    "inn": "7701234567",
    "kpp": "770101001",
    "director_name": "–°–∏–¥–æ—Ä–æ–≤ –°–µ—Ä–≥–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á",
    "director_position": "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",
}

DEFAULT_THRESHOLDS = {
    "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": 100_000,
    "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": 50_000,
    "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": 5_000_000,
    "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": 3_000_000,
    "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": 100_000
}

DEFAULT_DEADLINES = {"—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": 5, "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": 10, "—Å—Ä–æ—á–Ω—ã–π": 1}

# –†–û–õ–ò - –°–¢–†–û–ö–ê–ú–ò –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
–†–û–õ–¨_–ê–î–ú–ò–ù = "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
–†–û–õ–¨_–Æ–ó–ï–† = "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"

# ============================================================================
# –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò
# ============================================================================

–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò = {
    "admin": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("admin123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–û–õ–¨_–ê–î–ú–ò–ù,
        "–∏–º—è": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    },
    "legal": {
        "–ø–∞—Ä–æ–ª—å_—Ö–µ—à": hashlib.sha256("legal123".encode()).hexdigest(),
        "—Ä–æ–ª—å": –†–û–õ–¨_–ê–î–ú–ò–ù,
        "–∏–º—è": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Æ–î",
        "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
        "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç"
    }
}

# ============================================================================
# –°–ü–†–ê–í–û–ß–ù–ò–ö–ò
# ============================================================================

–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø = [
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–∑–æ–∫",
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ–¥–≤–∏–∂–Ω–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞",
    "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑–∞–∫—É–ø–æ–∫", "–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
    "–ò–¢-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç", "–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤", "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è",
]

–î–û–õ–ñ–ù–û–°–¢–ò = [
    "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–í–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞", "–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
    "–ù–∞—á–∞–ª—å–Ω–∏–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
]

–ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê = [
    "–ê—Ä–µ–Ω–¥–∞ –≤–∞–≥–æ–Ω–æ–≤", "–õ–∏–∑–∏–Ω–≥ –≤–∞–≥–æ–Ω–æ–≤", "–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –≤–∞–≥–æ–Ω–æ–≤",
    "–ê—Ä–µ–Ω–¥–∞ –ª–æ–∫–æ–º–æ—Ç–∏–≤–æ–≤", "–î–æ–≥–æ–≤–æ—Ä —Å –û–ê–û ¬´–†–ñ–î¬ª", "–í–≠–î/–í–∞–ª—é—Ç–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã",
    "–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–π–º–∞", "–î–æ–≥–æ–≤–æ—Ä –∑–∞–ª–æ–≥–∞",
    "–ê—Ä–µ–Ω–¥–∞/–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û",
]

–ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´ = [
    "–î–æ–≥–æ–≤–æ—Ä –¢–≠–û", "–†–∞–º–æ—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", "–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –≥—Ä—É–∑–∞",
    "–ó–∞–∫—É–ø–∫–∞ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
]

–¢–ò–ü–´_–î–û–ì–û–í–û–†–û–í = [
    "–î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (–¢–≠–û)", "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏", "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
    "–î–æ–≥–æ–≤–æ—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (–∞–≤—Ç–æ)", "–î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã –≤–∞–≥–æ–Ω–æ–≤", "–î–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞",
    "–ê–≥–µ–Ω—Ç—Å–∫–∏–π –¥–æ–≥–æ–≤–æ—Ä", "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "–î—Ä—É–≥–æ–π",
]

–§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê = ["–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–¢–§)", "–§–æ—Ä–º–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞", "–°–≤–æ–±–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞", "–¢–§ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏"]
–°–¢–ê–¢–£–°–´_–Æ–î = ["–ù–µ –ø–æ—Å—Ç—É–ø–∞–ª –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ", "–ü–æ—Å—Ç—É–ø–∞–ª –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ", "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω –Æ–î", "–û—Ç–∫–ª–æ–Ω—ë–Ω", "–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏"]

AI_–ü–†–û–í–ê–ô–î–ï–†–´ = {
    "openai": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "OpenAI GPT-4", "–º–æ–¥–µ–ª—å": "gpt-4o-mini"},
    "anthropic": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Anthropic Claude", "–º–æ–¥–µ–ª—å": "claude-3-haiku-20240307"},
    "gigachat": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "GigaChat (–°–±–µ—Ä)", "–º–æ–¥–µ–ª—å": "GigaChat"},
    "yandexgpt": {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "YandexGPT", "–º–æ–¥–µ–ª—å": "yandexgpt-lite"},
}

# ============================================================================
# –¢–ò–ü–û–í–´–ï –§–û–†–ú–´
# ============================================================================

–í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´ = {
    "–ø–æ—Å—Ç–∞–≤–∫–∞": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–ü–û–°-001",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å", "—Ç–æ–≤–∞—Ä", "–ø–æ—Å—Ç–∞–≤–∫–∞"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢": {"–º–∞—Ä–∫–µ—Ä—ã": ["–ø–æ—Å—Ç–∞–≤—â–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è", "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å"], "–≤–µ—Å": 2.0},
            "–¶–ï–ù–ê": {"–º–∞—Ä–∫–µ—Ä—ã": ["—Ü–µ–Ω–∞", "–æ–ø–ª–∞—Ç–∞", "–Ω–¥—Å"], "–≤–µ—Å": 2.0},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–Ω–µ—É—Å—Ç–æ–π–∫–∞"], "–≤–µ—Å": 2.0},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–Ω–µ—É—Å—Ç–æ–π–∫\w*.*?–ø–æ–∫—É–ø–∞—Ç–µ–ª\w*.*?(?:0[,.]?[3-9]|[1-9])\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ù–µ—É—Å—Ç–æ–π–∫–∞ –≤—ã—à–µ 0.2%/–¥–µ–Ω—å"},
        ]
    },
    "—É—Å–ª—É–≥–∏_—Ç—ç–æ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä –¢–≠–û",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–£–°–õ-001",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ó–∞–∫–∞–∑—á–∏–∫",
        "–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏", "–≤–∞–≥–æ–Ω—ã", "—Ç—ç–æ"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢": {"–º–∞—Ä–∫–µ—Ä—ã": ["–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–∑–∞–∫–∞–∑—á–∏–∫", "—É—Å–ª—É–≥–∏"], "–≤–µ—Å": 2.0},
            "–°–¢–û–ò–ú–û–°–¢–¨": {"–º–∞—Ä–∫–µ—Ä—ã": ["—Å—Ç–æ–∏–º–æ—Å—Ç—å", "–æ–ø–ª–∞—Ç–∞", "–∞–∫—Ç"], "–≤–µ—Å": 2.0},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—à—Ç—Ä–∞—Ñ", "–Ω–µ—É—Å—Ç–æ–π–∫–∞"], "–≤–µ—Å": 2.0},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–∑–∞–∫–∞–∑—á–∏–∫.*?(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç).*?(?:–≤—Å–µ|–ª—é–±—ã–µ).*?—Ä–∏—Å–∫", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–í—Å–µ —Ä–∏—Å–∫–∏ –Ω–∞ –°–ü–ö"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–ø—Ä–µ–¥–æ–ø–ª–∞—Ç\w*.*?(?:[4-9]\d|100)\s*%", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –±–æ–ª–µ–µ 30%"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—à—Ç—Ä–∞—Ñ.*?–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç.*?(?:[5-9]|[1-9]\d)\s*(?:000\s*000|–º–ª–Ω)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–®—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å > 5 –º–ª–Ω"},
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"–æ–ø–ª–∞—Ç–∞.*?(?:1|2|3)\s*(?:—Ä–∞–±–æ—á|–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω)", "—É—Ä–æ–≤–µ–Ω—å": "–∂—ë–ª—Ç—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã < 5 –¥–Ω–µ–π"},
        ]
    },
    "—Ö—Ä–∞–Ω–µ–Ω–∏–µ": {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–î–æ–≥–æ–≤–æ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è",
        "–∫–æ–¥": "–¢–§-–°–ü–ö-–•–†–ù-001",
        "–Ω–∞—à–∞_—Ä–æ–ª—å": "–ü–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å",
        "–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å", "—Ö—Ä–∞–Ω–µ–Ω–∏–µ"],
        "—Ä–∞–∑–¥–µ–ª—ã": {
            "–ü–†–ï–î–ú–ï–¢": {"–º–∞—Ä–∫–µ—Ä—ã": ["—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å", "–ø–æ–∫–ª–∞–∂–µ–¥–∞—Ç–µ–ª—å"], "–≤–µ—Å": 2.0},
            "–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨": {"–º–∞—Ä–∫–µ—Ä—ã": ["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "—É—Ç—Ä–∞—Ç–∞"], "–≤–µ—Å": 2.0},
        },
        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": [
            {"–ø–∞—Ç—Ç–µ—Ä–Ω": r"—Ö—Ä–∞–Ω–∏—Ç–µ–ª\w+.*?–Ω–µ\s+(?:–Ω–µ—Å—ë—Ç|–æ—Ç–≤–µ—á–∞–µ—Ç)", "—É—Ä–æ–≤–µ–Ω—å": "–∫—Ä–∞—Å–Ω—ã–π", "–ø—Ä–æ–±–ª–µ–º–∞": "–•—Ä–∞–Ω–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å"},
        ]
    },
}

# ============================================================================
# –î–ï–ú–û –î–û–ì–û–í–û–†
# ============================================================================

–î–ï–ú–û_–î–û–ì–û–í–û–† = """–î–û–ì–û–í–û–† –û–ö–ê–ó–ê–ù–ò–Ø –£–°–õ–£–ì ‚Ññ 2025/–¢–≠–û-001

–≥. –ú–æ—Å–∫–≤–∞                                                     ¬´15¬ª —è–Ω–≤–∞—Ä—è 2025 –≥.

–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª (–ò–ù–ù 7707999888), –∏–º–µ–Ω—É–µ–º–æ–µ ¬´–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å¬ª, –∏
–ê–û ¬´–°–ü–ö¬ª (–ò–ù–ù 7701234567), –∏–º–µ–Ω—É–µ–º–æ–µ ¬´–ó–∞–∫–∞–∑—á–∏–∫¬ª, –∑–∞–∫–ª—é—á–∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä:

1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê
1.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∂/–¥ –≤–∞–≥–æ–Ω–æ–≤, –ó–∞–∫–∞–∑—á–∏–∫ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç.

2. –°–¢–û–ò–ú–û–°–¢–¨ –ò –†–ê–°–ß–Å–¢–´
2.1. –°—Ç–æ–∏–º–æ—Å—Ç—å: 8 500 000 —Ä—É–±–ª–µ–π.
2.2. –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50% –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è.
2.3. –û–ø–ª–∞—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ —Å—á—ë—Ç–∞.
2.4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ –∏–∑–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ—ã.

3. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨
3.1. –®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π 5000 —Ä—É–±/—Å—É—Ç–∫–∏.
3.2. –ù–µ—É—Å—Ç–æ–π–∫–∞ 0,5% –∑–∞ –¥–µ–Ω—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
3.3. –ó–∞–∫–∞–∑—á–∏–∫ –Ω–µ—Å—ë—Ç –≤—Å–µ —Ä–∏—Å–∫–∏ –ø–æ –≤–∞–≥–æ–Ω–∞–º.

4. –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨
4.1. –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 15 000 000 —Ä—É–±–ª–µ–π.

–†–ï–ö–í–ò–ó–ò–¢–´:
–ó–∞–∫–∞–∑—á–∏–∫: –ê–û ¬´–°–ü–ö¬ª, –ò–ù–ù 7701234567
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: –û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª, –ò–ù–ù 7707999888
"""

–î–ï–ú–û_–î–ê–ù–ù–´–ï = {
    "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": "–û–û–û ¬´–¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç–∏–∫¬ª",
    "–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞": "2025/–¢–≠–û-001",
    "–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞": date(2025, 1, 15),
    "—Å—É–º–º–∞": 8_500_000,
}

# ============================================================================
# –ê–ù–ê–õ–ò–ó–ê–¢–û–†
# ============================================================================

class –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä:
    @classmethod
    def –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str) -> str:
        if not —Ç–µ–∫—Å—Ç:
            return ""
        return re.sub(r'\s+', ' ', —Ç–µ–∫—Å—Ç.lower().strip())
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(cls, —Ç–µ–∫—Å—Ç: str, –º–∞—Ä–∫–µ—Ä—ã: List[str]) -> Tuple[float, List[str]]:
        if not –º–∞—Ä–∫–µ—Ä—ã:
            return 0.5, []
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = cls.–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å(—Ç–µ–∫—Å—Ç)
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = [–º for –º in –º–∞—Ä–∫–µ—Ä—ã if –º.lower() in —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º]
        return len(–Ω–∞–π–¥–µ–Ω–Ω—ã–µ) / len(–º–∞—Ä–∫–µ—Ä—ã), –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    
    @classmethod
    def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø(cls, —Ç–µ–∫—Å—Ç: str) -> Tuple[str, float]:
        –ª—É—á—à–∏–π = None
        –ª—É—á—à–∏–π_—Å–∫–æ—Ä = 0
        for –∫–æ–¥, —Ç—Ñ in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´.items():
            —Å–∫–æ—Ä, _ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç, —Ç—Ñ.get("–º–∞—Ä–∫–µ—Ä—ã", []))
            if —Å–∫–æ—Ä > –ª—É—á—à–∏–π_—Å–∫–æ—Ä:
                –ª—É—á—à–∏–π_—Å–∫–æ—Ä = —Å–∫–æ—Ä
                –ª—É—á—à–∏–π = –∫–æ–¥
        return –ª—É—á—à–∏–π, –ª—É—á—à–∏–π_—Å–∫–æ—Ä
    
    @classmethod
    def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(cls, —Ç–µ–∫—Å—Ç: str, –ø–∞—Ç—Ç–µ—Ä–Ω—ã: List[Dict]) -> List[Dict]:
        –Ω–∞–π–¥–µ–Ω–Ω—ã–µ = []
        —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º = —Ç–µ–∫—Å—Ç.lower()
        for –ø in –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
            try:
                if re.search(–ø["–ø–∞—Ç—Ç–µ—Ä–Ω"], —Ç–µ–∫—Å—Ç_–Ω–æ—Ä–º, re.IGNORECASE | re.DOTALL):
                    –Ω–∞–π–¥–µ–Ω–Ω—ã–µ.append({"–ø—Ä–æ–±–ª–µ–º–∞": –ø["–ø—Ä–æ–±–ª–µ–º–∞"], "—É—Ä–æ–≤–µ–Ω—å": –ø["—É—Ä–æ–≤–µ–Ω—å"]})
            except:
                pass
        return –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
    
    @classmethod
    def –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(cls, —Ç–µ–∫—Å—Ç: str, –∫–æ–¥_—Ç—Ñ: str = None) -> Dict:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {
            "–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ": "", "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ": 0, "—Ä–∏—Å–∫–∏": [],
            "–∫—Ä–∞—Å–Ω—ã—Ö": 0, "–∂—ë–ª—Ç—ã—Ö": 0, "—Ä–µ–∑—é–º–µ": "", "—ç—Ç–æ_—Ç—Ñ": False
        }
        
        if not –∫–æ–¥_—Ç—Ñ:
            –∫–æ–¥_—Ç—Ñ, _ = cls.–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Ç–∏–ø(—Ç–µ–∫—Å—Ç)
        
        if not –∫–æ–¥_—Ç—Ñ or –∫–æ–¥_—Ç—Ñ not in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø"
            return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
        —Ç—Ñ = –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´[–∫–æ–¥_—Ç—Ñ]
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ"] = —Ç—Ñ["–Ω–∞–∑–≤–∞–Ω–∏–µ"]
        
        # –ü–æ–¥—Å—á—ë—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
        –æ–±—â–∏–π_—Å–∫–æ—Ä = 0
        –æ–±—â–∏–π_–≤–µ—Å = 0
        for _, –¥–∞–Ω–Ω—ã–µ in —Ç—Ñ.get("—Ä–∞–∑–¥–µ–ª—ã", {}).items():
            –≤–µ—Å = –¥–∞–Ω–Ω—ã–µ.get("–≤–µ—Å", 1.0)
            —Å–∫–æ—Ä, _ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–º–∞—Ä–∫–µ—Ä—ã(—Ç–µ–∫—Å—Ç, –¥–∞–Ω–Ω—ã–µ.get("–º–∞—Ä–∫–µ—Ä—ã", []))
            –æ–±—â–∏–π_—Å–∫–æ—Ä += –≤–µ—Å * —Å–∫–æ—Ä
            –æ–±—â–∏–π_–≤–µ—Å += –≤–µ—Å
        
        # –†–∏—Å–∫–∏
        —Ä–∏—Å–∫–∏ = cls.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Ä–∏—Å–∫–∏(—Ç–µ–∫—Å—Ç, —Ç—Ñ.get("—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã", []))
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–∏—Å–∫–∏"] = —Ä–∏—Å–∫–∏
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] = sum(1 for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∫—Ä–∞—Å–Ω—ã–π")
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∂—ë–ª—Ç—ã—Ö"] = sum(1 for r in —Ä–∏—Å–∫–∏ if r["—É—Ä–æ–≤–µ–Ω—å"] == "–∂—ë–ª—Ç—ã–π")
        
        –±–∞–∑–æ–≤—ã–π = (–æ–±—â–∏–π_—Å–∫–æ—Ä / –æ–±—â–∏–π_–≤–µ—Å * 100) if –æ–±—â–∏–π_–≤–µ—Å > 0 else 0
        —à—Ç—Ä–∞—Ñ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] * 12 + —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∂—ë–ª—Ç—ã—Ö"] * 4
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] = max(0, min(100, –±–∞–∑–æ–≤—ã–π - —à—Ç—Ä–∞—Ñ))
        
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç—Ñ"] = —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 70 and —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∫—Ä–∞—Å–Ω—ã—Ö"] == 0
        
        if —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—ç—Ç–æ_—Ç—Ñ"]:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–§ ¬´{—Ä–µ–∑—É–ª—å—Ç–∞—Ç['–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ']}¬ª"
        elif —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ"] >= 50:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%)"
        else:
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ä–µ–∑—é–º–µ"] = f"‚ùå –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–§ ({—Ä–µ–∑—É–ª—å—Ç–∞—Ç['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%)"
        
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# ============================================================================
# –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ó–û–ù–´
# ============================================================================

def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(—Å—É–º–º–∞: float, —Ñ–æ—Ä–º–∞: str, —Ç–∏–ø_—Å–¥–µ–ª–∫–∏: str, –ø–æ—Ä–æ–≥–∏: Dict = None) -> Dict:
    if –ø–æ—Ä–æ–≥–∏ is None:
        –ø–æ—Ä–æ–≥–∏ = DEFAULT_THRESHOLDS
    
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {"–∑–æ–Ω–∞": "–∑–µ–ª—ë–Ω–∞—è", "–ø—Ä–∏—á–∏–Ω–∞": "", "—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥": False, "—Å—Ä–æ–∫": 0}
    
    # –ö–†–ê–°–ù–ê–Ø
    if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∑–æ–Ω–∞"] = "–∫—Ä–∞—Å–Ω–∞—è"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = f"–¢–∏–ø: {—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Ä–æ–∫"] = 10
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5_000_000):
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∑–æ–Ω–∞"] = "–∫—Ä–∞—Å–Ω–∞—è"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = f"–°—É–º–º–∞ {—Å—É–º–º–∞:,.0f}‚ÇΩ > –ø–æ—Ä–æ–≥–∞"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Ä–æ–∫"] = 10
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    # –ñ–Å–õ–¢–ê–Ø
    if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ and —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ in –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∑–æ–Ω–∞"] = "–∂—ë–ª—Ç–∞—è"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = f"–¢–∏–ø: {—Ç–∏–ø_—Å–¥–µ–ª–∫–∏}"
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] = True
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Ä–æ–∫"] = 5
        return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if —Ñ–æ—Ä–º–∞ == "–¢–∏–ø–æ–≤–∞—è —Ñ–æ—Ä–º–∞ (–¢–§)":
        if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100_000):
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∑–æ–Ω–∞"] = "–∂—ë–ª—Ç–∞—è"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = "–¢–§ > –ø–æ—Ä–æ–≥–∞"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] = True
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Ä–æ–∫"] = 5
            return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    else:
        if —Å—É–º–º–∞ > –ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50_000):
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–∑–æ–Ω–∞"] = "–∂—ë–ª—Ç–∞—è"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = "–ù–µ—Ç–∏–ø–æ–≤–∞—è > –ø–æ—Ä–æ–≥–∞"
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] = True
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Ä–æ–∫"] = 5
            return —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    # –ó–ï–õ–Å–ù–ê–Ø
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç["–ø—Ä–∏—á–∏–Ω–∞"] = "–ó–µ–ª—ë–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä"
    return —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# ============================================================================
# –ó–ê–ì–†–£–ó–ß–ò–ö –§–ê–ô–õ–û–í
# ============================================================================

def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(uploaded_file) -> Tuple[bool, str]:
    if not uploaded_file:
        return False, ""
    try:
        content = uploaded_file.read()
        name = uploaded_file.name.lower()
        
        if name.endswith('.txt'):
            for enc in ['utf-8', 'cp1251', 'cp866']:
                try:
                    return True, content.decode(enc)
                except:
                    pass
            return True, content.decode('utf-8', errors='replace')
        
        elif name.endswith('.docx') and DOCX_AVAILABLE:
            doc = DocxDocument(io.BytesIO(content))
            text = '\n'.join([p.text for p in doc.paragraphs if p.text.strip()])
            return (True, text) if text else (False, "–ü—É—Å—Ç–æ–π –¥–æ–∫—É–º–µ–Ω—Ç")
        
        elif name.endswith('.pdf') and PDF_AVAILABLE:
            reader = PdfReader(io.BytesIO(content))
            text = '\n'.join([p.extract_text() or '' for p in reader.pages])
            return (True, text) if text.strip() else (False, "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å")
        
        return False, "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç"
    except Exception as e:
        return False, str(e)

# ============================================================================
# –ò–°–¢–û–†–ò–Ø
# ============================================================================

def –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é(–¥–∞–Ω–Ω—ã–µ: Dict):
    if "–∏—Å—Ç–æ—Ä–∏—è" not in st.session_state:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
    
    –∑–∞–ø–∏—Å—å = {
        "–¥–∞—Ç–∞": datetime.now().strftime('%d.%m.%Y %H:%M'),
        "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –¥–∞–Ω–Ω—ã–µ.get("–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç", ""),
        "–Ω–æ–º–µ—Ä": –¥–∞–Ω–Ω—ã–µ.get("–Ω–æ–º–µ—Ä", ""),
        "—Å—É–º–º–∞": –¥–∞–Ω–Ω—ã–µ.get("—Å—É–º–º–∞", 0),
        "–∑–æ–Ω–∞": –¥–∞–Ω–Ω—ã–µ.get("–∑–æ–Ω–∞", ""),
    }
    st.session_state.–∏—Å—Ç–æ—Ä–∏—è.insert(0, –∑–∞–ø–∏—Å—å)
    if len(st.session_state.–∏—Å—Ç–æ—Ä–∏—è) > 50:
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = st.session_state.–∏—Å—Ç–æ—Ä–∏—è[:50]

# ============================================================================
# –°–¢–ò–õ–ò
# ============================================================================

def –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏():
    st.markdown("""<style>
.main-header { background:linear-gradient(135deg,#1e3a5f,#2d5a87); padding:1.5rem; border-radius:12px; margin-bottom:1.5rem; color:white; }
.traffic-light { display:flex; gap:8px; margin-bottom:0.5rem; }
.traffic-light span { width:14px; height:14px; border-radius:50%; }
.tl-red { background:#dc3545; }
.tl-yellow { background:#f0ad4e; }
.tl-green { background:#28a745; }
.zone-card { border-radius:10px; padding:1rem; margin:1rem 0; border-left:5px solid; }
.zone-card.–∑–µ–ª—ë–Ω–∞—è { background:#e8f5e9; border-left-color:#28a745; }
.zone-card.–∂—ë–ª—Ç–∞—è { background:#fff8e1; border-left-color:#f0ad4e; }
.zone-card.–∫—Ä–∞—Å–Ω–∞—è { background:#ffebee; border-left-color:#dc3545; }
.admin-badge { background:#7b1fa2; color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; }
.user-badge { background:#1976d2; color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; }
.risk-red { background:#ffebee; border-left:4px solid #dc3545; padding:10px; margin:5px 0; border-radius:4px; }
.risk-yellow { background:#fff8e1; border-left:4px solid #f0ad4e; padding:10px; margin:5px 0; border-radius:4px; }
</style>""", unsafe_allow_html=True)

# ============================================================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
# ============================================================================

def –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è():
    defaults = {
        "–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω": False,
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": None,
        "—Ä–æ–ª—å": –†–û–õ–¨_–Æ–ó–ï–†,  # –°–¢–†–û–ö–ê!
        "–¥–µ–º–æ": False,
        "—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞": "",
        "—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω": False,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã": None,
        "—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞": None,
        "–∏—Å—Ç–æ—Ä–∏—è": [],
        "–æ—Ä–≥": DEFAULT_ORG_CONFIG.copy(),
        "–ø–æ—Ä–æ–≥–∏": DEFAULT_THRESHOLDS.copy(),
        "—Å—Ä–æ–∫–∏": DEFAULT_DEADLINES.copy(),
        "api_–∫–ª—é—á–∏": {p: "" for p in AI_–ü–†–û–í–ê–ô–î–ï–†–´},
        "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ": {},
    }
    for k, v in defaults.items():
        if k not in st.session_state:
            st.session_state[k] = v

# ============================================================================
# –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –ê–î–ú–ò–ù–ê
# ============================================================================

def —ç—Ç–æ_–∞–¥–º–∏–Ω() -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
    —Ä–æ–ª—å = st.session_state.get("—Ä–æ–ª—å", "")
    return —Ä–æ–ª—å == –†–û–õ–¨_–ê–î–ú–ò–ù or —Ä–æ–ª—å == "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"

# ============================================================================
# –°–¢–†–ê–ù–ò–¶–ê –í–•–û–î–ê
# ============================================================================

def —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–≤—Ö–æ–¥–∞():
    st.markdown('''<div style="text-align:center;padding:2rem;">
<div class="traffic-light" style="justify-content:center;margin-bottom:1rem;"><span class="tl-red"></span><span class="tl-yellow"></span><span class="tl-green"></span></div>
<h1 style="color:#1e3a5f;">üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä</h1>
<p>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ v7.4<br><strong>–ê–û ¬´–°–ü–ö¬ª</strong> ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</p>
</div>''', unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns([1, 2, 1])
    
    with col2:
        tab1, tab2 = st.tabs(["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"])
        
        # –í–•–û–î –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        with tab1:
            with st.form("user_form"):
                –∏–º—è = st.text_input("–§–ò–û *", placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á")
                –¥–æ–ª–∂–Ω–æ—Å—Ç—å = st.selectbox("–î–æ–ª–∂–Ω–æ—Å—Ç—å *", ["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –î–û–õ–ñ–ù–û–°–¢–ò)
                –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ = st.selectbox("–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ *", ["‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî"] + –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–Ø)
                
                c1, c2 = st.columns(2)
                with c1:
                    btn_user = st.form_submit_button("üöÄ –í–æ–π—Ç–∏", use_container_width=True)
                with c2:
                    btn_demo_user = st.form_submit_button("üìã –î–µ–º–æ", use_container_width=True)
                
                if btn_user:
                    if –∏–º—è and len(–∏–º—è) >= 3 and –¥–æ–ª–∂–Ω–æ—Å—Ç—å != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî" and –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ != "‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî":
                        st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                        st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": –∏–º—è, "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": –¥–æ–ª–∂–Ω–æ—Å—Ç—å, "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ}
                        st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–Æ–ó–ï–†
                        st.session_state.–¥–µ–º–æ = False
                        st.rerun()
                    else:
                        st.error("‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è")
                
                if btn_demo_user:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–Æ–î"}
                    st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–Æ–ó–ï–†
                    st.session_state.–¥–µ–º–æ = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.rerun()
        
        # –í–•–û–î –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
        with tab2:
            with st.form("admin_form"):
                –ª–æ–≥–∏–Ω = st.text_input("–õ–æ–≥–∏–Ω", placeholder="admin")
                –ø–∞—Ä–æ–ª—å = st.text_input("–ü–∞—Ä–æ–ª—å", type="password")
                
                c1, c2 = st.columns(2)
                with c1:
                    btn_admin = st.form_submit_button("üîê –í–æ–π—Ç–∏", use_container_width=True)
                with c2:
                    btn_demo_admin = st.form_submit_button("üìã –î–µ–º–æ-–∞–¥–º–∏–Ω", use_container_width=True)
                
                if btn_admin:
                    if –ª–æ–≥–∏–Ω in –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:
                        user = –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò[–ª–æ–≥–∏–Ω]
                        if user["–ø–∞—Ä–æ–ª—å_—Ö–µ—à"] == hashlib.sha256(–ø–∞—Ä–æ–ª—å.encode()).hexdigest():
                            st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                            st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": user["–∏–º—è"], "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": user["–¥–æ–ª–∂–Ω–æ—Å—Ç—å"], "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": user["–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ"]}
                            st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–ê–î–ú–ò–ù  # –í–∞–∂–Ω–æ!
                            st.session_state.–¥–µ–º–æ = False
                            st.rerun()
                        else:
                            st.error("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å")
                    else:
                        st.error("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
                
                if btn_demo_admin:
                    st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω = True
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = {"–∏–º—è": "–î–µ–º–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–¥–æ–ª–∂–Ω–æ—Å—Ç—å": "–°–∏—Å.–∞–¥–º–∏–Ω", "–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ": "–ò–¢"}
                    st.session_state.—Ä–æ–ª—å = –†–û–õ–¨_–ê–î–ú–ò–ù  # –í–∞–∂–Ω–æ!
                    st.session_state.–¥–µ–º–æ = True
                    st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = –î–ï–ú–û_–î–û–ì–û–í–û–†
                    st.rerun()
            
            st.caption("üí° admin / admin123 –∏–ª–∏ legal / legal123")

# ============================================================================
# –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨
# ============================================================================

def –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å():
    with st.sidebar:
        user = st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        is_admin = —ç—Ç–æ_–∞–¥–º–∏–Ω()
        
        badge = "admin-badge" if is_admin else "user-badge"
        badge_text = "–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†" if is_admin else "–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨"
        
        st.markdown(f'''
        <div style="background:#f5f5f5;padding:10px;border-radius:8px;margin-bottom:10px;">
            <strong>{user["–∏–º—è"]}</strong><br>
            <small>{user["–¥–æ–ª–∂–Ω–æ—Å—Ç—å"]}</small><br>
            <span class="{badge}">{badge_text}</span>
        </div>
        ''', unsafe_allow_html=True)
        
        if st.button("üö™ –í—ã–π—Ç–∏", use_container_width=True):
            for k in list(st.session_state.keys()):
                del st.session_state[k]
            st.rerun()
        
        st.markdown("---")
        
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
        st.markdown(f"**{–æ—Ä–≥.get('short_name', '')}**")
        st.caption(f"–ò–ù–ù: {–æ—Ä–≥.get('inn', '')}")
        
        st.markdown("---")
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        st.markdown(f"""
**–ü–æ—Ä–æ–≥–∏:**
- üü¢ –¢–§ ‚â§ {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ
- üü¢ –ò–Ω—ã–µ ‚â§ {–ø–æ—Ä–æ–≥–∏['–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å']:,}‚ÇΩ
- üü° –¥–æ {–ø–æ—Ä–æ–≥–∏['–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å']:,}‚ÇΩ
- üî¥ > {–ø–æ—Ä–æ–≥–∏['–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å']:,}‚ÇΩ
        """)
        
        # –î–ª—è –∞–¥–º–∏–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
        if is_admin:
            st.markdown("---")
            st.success("üîì –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ê–ù–ê–õ–ò–ó–ê
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞():
    –¥–µ–º–æ = st.session_state.–¥–µ–º–æ
    
    st.markdown("### üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–≥–æ–≤–æ—Ä–∞")
    
    c1, c2 = st.columns(2)
    with c1:
        –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç = st.text_input("–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç *", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç"] if –¥–µ–º–æ else "")
        –Ω–æ–º–µ—Ä = st.text_input("–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–Ω–æ–º–µ—Ä_–¥–æ–≥–æ–≤–æ—Ä–∞"] if –¥–µ–º–æ else "")
        –¥–∞—Ç–∞ = st.date_input("–î–∞—Ç–∞", value=–î–ï–ú–û_–î–ê–ù–ù–´–ï["–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞"] if –¥–µ–º–æ else date.today())
    
    with c2:
        —Å—É–º–º–∞_str = st.text_input("–°—É–º–º–∞ (‚ÇΩ)", value=f"{–î–ï–ú–û_–î–ê–ù–ù–´–ï['—Å—É–º–º–∞']:,}" if –¥–µ–º–æ else "")
        —Å—É–º–º–∞ = 0
        if —Å—É–º–º–∞_str:
            try:
                —Å—É–º–º–∞ = float(re.sub(r'[^\d.]', '', —Å—É–º–º–∞_str.replace(',', '').replace(' ', '')))
            except:
                pass
        
        —Ñ–æ—Ä–º–∞ = st.selectbox("–§–æ—Ä–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞", –§–û–†–ú–´_–î–û–ö–£–ú–ï–ù–¢–ê)
        —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = st.selectbox("–¢–∏–ø —Å–¥–µ–ª–∫–∏", ["‚Äî –û–±—ã—á–Ω—ã–π ‚Äî"] + –ö–†–ê–°–ù–ê–Ø_–ó–û–ù–ê_–í–°–ï–ì–î–ê + –ñ–Å–õ–¢–ê–Ø_–ó–û–ù–ê_–¢–ò–ü–´)
        if —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ == "‚Äî –û–±—ã—á–Ω—ã–π ‚Äî":
            —Ç–∏–ø_—Å–¥–µ–ª–∫–∏ = ""
    
    # –ö–Ω–æ–ø–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã
    if st.button("üö¶ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–æ–Ω—É", type="primary"):
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_–∑–æ–Ω—É(—Å—É–º–º–∞, —Ñ–æ—Ä–º–∞, —Ç–∏–ø_—Å–¥–µ–ª–∫–∏, st.session_state.get("–ø–æ—Ä–æ–≥–∏"))
        st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        st.session_state.—Ç–µ–∫—É—â–∏–µ_–¥–∞–Ω–Ω—ã–µ = {"–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, "–Ω–æ–º–µ—Ä": –Ω–æ–º–µ—Ä, "—Å—É–º–º–∞": —Å—É–º–º–∞}
    
    # –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–æ–Ω—ã
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã:
        —Ä–µ–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã
        –∑–æ–Ω–∞ = —Ä–µ–∑["–∑–æ–Ω–∞"]
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑–æ–Ω–∞, "‚ö™")
        –Ω–∞–∑–≤–∞–Ω–∏–µ = {"–∑–µ–ª—ë–Ω–∞—è": "–ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê", "–∂—ë–ª—Ç–∞—è": "–ñ–Å–õ–¢–ê–Ø –ó–û–ù–ê", "–∫—Ä–∞—Å–Ω–∞—è": "–ö–†–ê–°–ù–ê–Ø –ó–û–ù–ê"}.get(–∑–æ–Ω–∞, "")
        
        st.markdown(f'''<div class="zone-card {–∑–æ–Ω–∞}">
            <h3>{emoji} {–Ω–∞–∑–≤–∞–Ω–∏–µ}</h3>
            <p>{—Ä–µ–∑["–ø—Ä–∏—á–∏–Ω–∞"]}</p>
            <p>–¢—Ä–µ–±—É–µ—Ç—Å—è –Æ–î: <strong>{"–î–∞" if —Ä–µ–∑["—Ç—Ä–µ–±—É–µ—Ç—Å—è_—é–¥"] else "–ù–µ—Ç"}</strong> | –°—Ä–æ–∫: <strong>{—Ä–µ–∑["—Å—Ä–æ–∫"]} –¥–Ω.</strong></p>
        </div>''', unsafe_allow_html=True)
    
    st.markdown("---")
    st.markdown("### üìÑ –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞")
    st.info("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª **–ò–õ–ò** –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç")
    
    —Ñ–∞–π–ª = st.file_uploader("–§–∞–π–ª (DOCX, PDF, TXT)", type=["txt", "docx", "pdf"])
    
    if —Ñ–∞–π–ª:
        ok, —Ç–µ–∫—Å—Ç = –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ñ–∞–π–ª(—Ñ–∞–π–ª)
        if ok:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ç–µ–∫—Å—Ç
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = True
            st.success(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {len(—Ç–µ–∫—Å—Ç):,} —Å–∏–º–≤–æ–ª–æ–≤")
        else:
            st.error(f"‚ùå {—Ç–µ–∫—Å—Ç}")
    
    if not st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω:
        —Ç–µ–∫—Å—Ç = st.text_area("–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç:", value=st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, height=150)
        if —Ç–µ–∫—Å—Ç != st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞:
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = —Ç–µ–∫—Å—Ç
    else:
        st.info(f"üìÑ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω ({len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞):,} —Å–∏–º–≤–æ–ª–æ–≤)")
        if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª"):
            st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞ = ""
            st.session_state.—Ñ–∞–π–ª_–∑–∞–≥—Ä—É–∂–µ–Ω = False
            st.rerun()
    
    # –í—ã–±–æ—Ä –¢–§
    –≤—Å–µ_—Ç—Ñ = {**–í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´, **st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})}
    –æ–ø—Ü–∏–∏ = [("‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –¢–§ ‚Äî", None)] + [(f"{v['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({v['–∫–æ–¥']})", k) for k, v in –≤—Å–µ_—Ç—Ñ.items()]
    –≤—ã–±–æ—Ä = st.selectbox("–°—Ä–∞–≤–Ω–∏—Ç—å —Å –¢–§:", –æ–ø—Ü–∏–∏, format_func=lambda x: x[0])
    –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ = –≤—ã–±–æ—Ä[1] if –≤—ã–±–æ—Ä else None
    
    # –ö–Ω–æ–ø–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
    if st.button("üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å", type="primary"):
        if len(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞) < 50:
            st.error("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞")
        elif not –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ:
            st.error("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø–æ–≤—É—é —Ñ–æ—Ä–º—É")
        else:
            with st.spinner("–ê–Ω–∞–ª–∏–∑..."):
                —Ä–µ–∑—É–ª—å—Ç–∞—Ç = –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å(st.session_state.—Ç–µ–∫—Å—Ç_–¥–æ–≥–æ–≤–æ—Ä–∞, –≤—ã–±—Ä–∞–Ω–Ω–∞—è_—Ç—Ñ)
                st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            st.rerun()
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
    if st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞:
        —Ä–µ–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞
        st.markdown("---")
        st.markdown(f"### üìã –†–µ–∑—É–ª—å—Ç–∞—Ç: {—Ä–µ–∑['–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç—Ñ']}")
        
        c1, c2, c3 = st.columns(3)
        c1.metric("–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ", f"{—Ä–µ–∑['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ']:.0f}%")
        c2.metric("üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö", —Ä–µ–∑['–∫—Ä–∞—Å–Ω—ã—Ö'])
        c3.metric("üü° –í–Ω–∏–º–∞–Ω–∏–µ", —Ä–µ–∑['–∂—ë–ª—Ç—ã—Ö'])
        
        st.markdown(f"**{—Ä–µ–∑['—Ä–µ–∑—é–º–µ']}**")
        
        if —Ä–µ–∑['—Ä–∏—Å–∫–∏']:
            st.markdown("#### –†–∏—Å–∫–∏:")
            for —Ä in —Ä–µ–∑['—Ä–∏—Å–∫–∏']:
                –∫–ª–∞—Å—Å = "risk-red" if —Ä['—É—Ä–æ–≤–µ–Ω—å'] == "–∫—Ä–∞—Å–Ω—ã–π" else "risk-yellow"
                emoji = "üî¥" if —Ä['—É—Ä–æ–≤–µ–Ω—å'] == "–∫—Ä–∞—Å–Ω—ã–π" else "üü°"
                st.markdown(f'<div class="{–∫–ª–∞—Å—Å}">{emoji} {—Ä["–ø—Ä–æ–±–ª–µ–º–∞"]}</div>', unsafe_allow_html=True)

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –û–¢–ß–Å–¢–û–í
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤():
    st.markdown("### üìä –û—Ç—á—ë—Ç—ã")
    
    if not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã and not st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞:
        st.info("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑")
        return
    
    –¥–∞–Ω–Ω—ã–µ = st.session_state.get("—Ç–µ–∫—É—â–∏–µ_–¥–∞–Ω–Ω—ã–µ", {})
    –∑–æ–Ω–∞ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∑–æ–Ω—ã
    –∞–Ω–∞–ª–∏–∑ = st.session_state.—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–∞–Ω–∞–ª–∏–∑–∞ or {}
    
    st.markdown(f"""
**–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:** {–¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ù/–î')}  
**–ù–æ–º–µ—Ä:** {–¥–∞–Ω–Ω—ã–µ.get('–Ω–æ–º–µ—Ä', '–ù/–î')}  
**–°—É–º–º–∞:** {–¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0):,.0f}‚ÇΩ  
**–ó–æ–Ω–∞:** {–∑–æ–Ω–∞['–∑–æ–Ω–∞'].upper() if –∑–æ–Ω–∞ else '–ù/–î'}  
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–§:** {–∞–Ω–∞–ª–∏–∑.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—Ç—Ñ', 0):.0f}%
    """)
    
    if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é"):
        –¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏—Å—Ç–æ—Ä–∏—é({
            "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç": –¥–∞–Ω–Ω—ã–µ.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', ''),
            "–Ω–æ–º–µ—Ä": –¥–∞–Ω–Ω—ã–µ.get('–Ω–æ–º–µ—Ä', ''),
            "—Å—É–º–º–∞": –¥–∞–Ω–Ω—ã–µ.get('—Å—É–º–º–∞', 0),
            "–∑–æ–Ω–∞": –∑–æ–Ω–∞['–∑–æ–Ω–∞'] if –∑–æ–Ω–∞ else '',
        })
        st.success("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!")

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ò–°–¢–û–†–ò–ò
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏():
    st.markdown("### üìú –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫")
    
    –∏—Å—Ç–æ—Ä–∏—è = st.session_state.get("–∏—Å—Ç–æ—Ä–∏—è", [])
    
    if not –∏—Å—Ç–æ—Ä–∏—è:
        st.info("–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞")
        return
    
    for –∑ in –∏—Å—Ç–æ—Ä–∏—è:
        emoji = {"–∑–µ–ª—ë–Ω–∞—è": "üü¢", "–∂—ë–ª—Ç–∞—è": "üü°", "–∫—Ä–∞—Å–Ω–∞—è": "üî¥"}.get(–∑.get("–∑–æ–Ω–∞", ""), "‚ö™")
        st.markdown(f"{emoji} **{–∑.get('–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '')}** | ‚Ññ {–∑.get('–Ω–æ–º–µ—Ä', '')} | {–∑.get('—Å—É–º–º–∞', 0):,.0f}‚ÇΩ | {–∑.get('–¥–∞—Ç–∞', '')}")
    
    if st.button("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å"):
        st.session_state.–∏—Å—Ç–æ—Ä–∏—è = []
        st.rerun()

# ============================================================================
# –í–ö–õ–ê–î–ö–ê –ù–ê–°–¢–†–û–ï–ö (–¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ê!)
# ============================================================================

def –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    
    st.markdown("### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã")
    st.success("üîì –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
    
    tabs = st.tabs(["üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "üìä –ü–æ—Ä–æ–≥–∏", "üîë API-–∫–ª—é—á–∏", "üìÇ –¢–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã"])
    
    # ======== –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø ========
    with tabs[0]:
        st.markdown("#### üè¢ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏")
        
        –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
        
        c1, c2 = st.columns(2)
        with c1:
            new_full = st.text_input("–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("full_name", ""))
            new_short = st.text_input("–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", value=–æ—Ä–≥.get("short_name", ""))
            new_inn = st.text_input("–ò–ù–ù", value=–æ—Ä–≥.get("inn", ""))
        with c2:
            new_kpp = st.text_input("–ö–ü–ü", value=–æ—Ä–≥.get("kpp", ""))
            new_dir = st.text_input("–î–∏—Ä–µ–∫—Ç–æ—Ä", value=–æ—Ä–≥.get("director_name", ""))
            new_pos = st.text_input("–î–æ–ª–∂–Ω–æ—Å—Ç—å", value=–æ—Ä–≥.get("director_position", ""))
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã"):
            st.session_state.–æ—Ä–≥ = {
                "full_name": new_full, "short_name": new_short,
                "inn": new_inn, "kpp": new_kpp,
                "director_name": new_dir, "director_position": new_pos
            }
            st.success("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!")
    
    # ======== –ü–û–†–û–ì–ò ========
    with tabs[1]:
        st.markdown("#### üìä –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞")
        st.info("–ò–∑–º–µ–Ω–∏—Ç–µ —Å—É–º–º—ã –µ—Å–ª–∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è")
        
        –ø–æ—Ä–æ–≥–∏ = st.session_state.get("–ø–æ—Ä–æ–≥–∏", DEFAULT_THRESHOLDS)
        
        st.markdown("##### üü¢ –ó–ï–õ–Å–ù–ê–Ø –ó–û–ù–ê")
        c1, c2 = st.columns(2)
        with c1:
            new_tf = st.number_input("–ú–∞–∫—Å. —Å—É–º–º–∞ –¢–§ (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å", 100000), step=10000)
        with c2:
            new_ntf = st.number_input("–ú–∞–∫—Å. —Å—É–º–º–∞ –Ω–µ—Ç–∏–ø–æ–≤–æ–π (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å", 50000), step=10000)
        
        st.markdown("##### üü° –ñ–Å–õ–¢–ê–Ø ‚Üí üî¥ –ö–†–ê–°–ù–ê–Ø")
        new_yellow = st.number_input("–ü–æ—Ä–æ–≥ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω—ã (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å", 5000000), step=100000)
        
        c3, c4 = st.columns(2)
        with c3:
            new_tender = st.number_input("–¢–µ–Ω–¥–µ—Ä ‚Üí –∫—Ä–∞—Å–Ω–∞—è –æ—Ç (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è", 3000000), step=100000)
        with c4:
            new_single = st.number_input("–ï–¥–∏–Ω—Å—Ç–≤. –ø–æ—Å—Ç–∞–≤—â–∏–∫ ‚Üí –∂—ë–ª—Ç–∞—è –æ—Ç (‚ÇΩ)", value=–ø–æ—Ä–æ–≥–∏.get("–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫", 100000), step=10000)
        
        st.markdown("##### ‚è±Ô∏è –°—Ä–æ–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (–¥–Ω–µ–π)")
        —Å—Ä–æ–∫–∏ = st.session_state.get("—Å—Ä–æ–∫–∏", DEFAULT_DEADLINES)
        c5, c6, c7 = st.columns(3)
        with c5:
            new_std = st.number_input("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", 5), min_value=1)
        with c6:
            new_ext = st.number_input("–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π", 10), min_value=1)
        with c7:
            new_urg = st.number_input("–°—Ä–æ—á–Ω—ã–π", value=—Å—Ä–æ–∫–∏.get("—Å—Ä–æ—á–Ω—ã–π", 1), min_value=1)
        
        if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏"):
            st.session_state.–ø–æ—Ä–æ–≥–∏ = {
                "–∑–µ–ª—ë–Ω–∞—è_—Ç—Ñ_–º–∞–∫—Å": new_tf, "–∑–µ–ª—ë–Ω–∞—è_–Ω–µ—Ç—Ñ_–º–∞–∫—Å": new_ntf,
                "–∂—ë–ª—Ç–∞—è_–º–∞–∫—Å": new_yellow, "—Ç–µ–Ω–¥–µ—Ä_–∫—Ä–∞—Å–Ω–∞—è": new_tender,
                "–µ–¥–∏–Ω—Å—Ç–≤_–ø–æ—Å—Ç–∞–≤—â–∏–∫": new_single
            }
            st.session_state.—Å—Ä–æ–∫–∏ = {"—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π": new_std, "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π": new_ext, "—Å—Ä–æ—á–Ω—ã–π": new_urg}
            st.success("‚úÖ –ü–æ—Ä–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
    
    # ======== API-–ö–õ–Æ–ß–ò ========
    with tabs[2]:
        st.markdown("#### üîë API-–∫–ª—é—á–∏ –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞")
        st.info("–î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞")
        
        api = st.session_state.get("api_–∫–ª—é—á–∏", {})
        
        for pid, info in AI_–ü–†–û–í–ê–ô–î–ï–†–´.items():
            st.markdown(f"**{info['–Ω–∞–∑–≤–∞–Ω–∏–µ']}**")
            c1, c2 = st.columns([4, 1])
            with c1:
                new_key = st.text_input(f"–ö–ª—é—á {pid}", type="password", value=api.get(pid, ""), key=f"api_{pid}", label_visibility="collapsed")
                if new_key != api.get(pid, ""):
                    st.session_state.api_–∫–ª—é—á–∏[pid] = new_key
            with c2:
                if api.get(pid):
                    st.caption("‚úÖ")
                else:
                    st.caption("‚Äî")
            st.markdown("---")
        
        st.text_input("YandexGPT Folder ID", value=st.session_state.get("yandex_folder", ""), key="yandex_folder_input")
    
    # ======== –¢–ò–ü–û–í–´–ï –§–û–†–ú–´ ========
    with tabs[3]:
        st.markdown("#### üìÇ –¢–∏–ø–æ–≤—ã–µ —Ñ–æ—Ä–º—ã")
        
        st.markdown("**–°–∏—Å—Ç–µ–º–Ω—ã–µ:**")
        for –∫–æ–¥, —Ç—Ñ in –í–°–¢–†–û–ï–ù–ù–´–ï_–¢–ò–ü–û–í–´–ï_–§–û–†–ú–´.items():
            st.markdown(f"- ‚ö™ {—Ç—Ñ['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ({—Ç—Ñ['–∫–æ–¥']})")
        
        st.markdown("---")
        st.markdown("**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ:**")
        
        user_tf = st.session_state.get("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ", {})
        if user_tf:
            for –∫–æ–¥, —Ç—Ñ in list(user_tf.items()):
                c1, c2 = st.columns([4, 1])
                with c1:
                    st.markdown(f"- üîµ {—Ç—Ñ.get('–Ω–∞–∑–≤–∞–Ω–∏–µ', –∫–æ–¥)}")
                with c2:
                    if st.button("üóëÔ∏è", key=f"del_tf_{–∫–æ–¥}"):
                        del st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[–∫–æ–¥]
                        st.rerun()
        else:
            st.info("–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–æ—Ä–º")
        
        st.markdown("---")
        st.markdown("**‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É:**")
        
        with st.expander("–°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é"):
            new_code = st.text_input("–ö–æ–¥", placeholder="–º–æ—è_—Ñ–æ—Ä–º–∞")
            new_name = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ", placeholder="–î–æ–≥–æ–≤–æ—Ä...")
            new_role = st.selectbox("–ù–∞—à–∞ —Ä–æ–ª—å", ["–ó–∞–∫–∞–∑—á–∏–∫", "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å", "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", "–ü—Ä–æ–¥–∞–≤–µ—Ü"])
            new_markers = st.text_input("–ú–∞—Ä–∫–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)", placeholder="–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –∑–∞–∫–∞–∑—á–∏–∫")
            
            if st.button("‚ûï –î–æ–±–∞–≤–∏—Ç—å"):
                if new_code and new_name:
                    st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[new_code] = {
                        "–Ω–∞–∑–≤–∞–Ω–∏–µ": new_name,
                        "–∫–æ–¥": f"–¢–§-–°–ü–ö-{new_code.upper()}",
                        "–Ω–∞—à–∞_—Ä–æ–ª—å": new_role,
                        "–º–∞—Ä–∫–µ—Ä—ã": [m.strip() for m in new_markers.split(",") if m.strip()],
                        "—Ä–∞–∑–¥–µ–ª—ã": {},
                        "—Ä–∏—Å–∫_–ø–∞—Ç—Ç–µ—Ä–Ω—ã": []
                    }
                    st.success(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {new_name}")
                    st.rerun()
                else:
                    st.error("–£–∫–∞–∂–∏—Ç–µ –∫–æ–¥ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ")
        
        with st.expander("–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON"):
            json_file = st.file_uploader("JSON-—Ñ–∞–π–ª", type=["json"])
            if json_file:
                try:
                    data = json.loads(json_file.read().decode())
                    st.json(data)
                    if st.button("‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å"):
                        key = data.get("–∫–æ–¥", "–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è").lower().replace("-", "_")
                        st.session_state.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ_—Ç—Ñ[key] = data
                        st.success("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ!")
                        st.rerun()
                except:
                    st.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON")

# ============================================================================
# –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# ============================================================================

def –≥–ª–∞–≤–Ω–∞—è():
    –æ—Ä–≥ = st.session_state.get("–æ—Ä–≥", DEFAULT_ORG_CONFIG)
    is_admin = —ç—Ç–æ_–∞–¥–º–∏–Ω()
    
    st.markdown(f'''
    <div class="main-header">
        <div class="traffic-light"><span class="tl-red"></span><span class="tl-yellow"></span><span class="tl-green"></span></div>
        <h2>üö¶ –†–µ–≥–ª–∞–º–µ–Ω—Ç –°–≤–µ—Ç–æ—Ñ–æ—Ä <small style="opacity:0.7">v7.4</small></h2>
        <div style="opacity:0.9;">{–æ—Ä–≥.get("short_name", "–ê–û ¬´–°–ü–ö¬ª")} ‚Äî –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</div>
    </div>
    ''', unsafe_allow_html=True)
    
    –±–æ–∫–æ–≤–∞—è_–ø–∞–Ω–µ–ª—å()
    
    # –í–ê–ñ–ù–û: –†–∞–∑–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
    if is_admin:
        # –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† - 4 –≤–∫–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–∞—è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        tabs = st.tabs(["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è", "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"])
        
        with tabs[0]:
            –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞()
        with tabs[1]:
            –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤()
        with tabs[2]:
            –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏()
        with tabs[3]:
            –≤–∫–ª–∞–¥–∫–∞_–Ω–∞—Å—Ç—Ä–æ–µ–∫()
    else:
        # –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ - —Ç–æ–ª—å–∫–æ 3 –≤–∫–ª–∞–¥–∫–∏
        tabs = st.tabs(["üìù –ê–Ω–∞–ª–∏–∑", "üìä –û—Ç—á—ë—Ç—ã", "üìú –ò—Å—Ç–æ—Ä–∏—è"])
        
        with tabs[0]:
            –≤–∫–ª–∞–¥–∫–∞_–∞–Ω–∞–ª–∏–∑–∞()
        with tabs[1]:
            –≤–∫–ª–∞–¥–∫–∞_–æ—Ç—á—ë—Ç–æ–≤()
        with tabs[2]:
            –≤–∫–ª–∞–¥–∫–∞_–∏—Å—Ç–æ—Ä–∏–∏()

# ============================================================================
# MAIN
# ============================================================================

def main():
    –ø—Ä–∏–º–µ–Ω–∏—Ç—å_—Å—Ç–∏–ª–∏()
    –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è()
    
    if not st.session_state.–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
        —Å—Ç—Ä–∞–Ω–∏—Ü–∞_–≤—Ö–æ–¥–∞()
    else:
        –≥–ª–∞–≤–Ω–∞—è()

if __name__ == "__main__":
    main()
